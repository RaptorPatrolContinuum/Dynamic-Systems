<?xml version="1.0"?>
<!DOCTYPE TranscendenceExtension
	[
	;2000- Ares
	;2A00- CW
	;2B00- Ranx
	
	;2C00- Retaliation
	;2D00- Retaliationpatrolbase
	;2E00- Miningbase
	
	<!ENTITY unidDynamicSystems						"0xE1282000">
	<!--Ares-->
	<!ENTITY stAresHQ								"0xE1282001">
	<!--CW-->
	<!ENTITY stCWHQ									"0xE1282A00">
	<!ENTITY scCSCHQ								"0xE1282A01">
			;From Mayfly Sundance Vanilla Override
		<!ENTITY itLAM									"0xE1281014">
	<!ENTITY scDSAquilaCruiser						"0xE1282A02">
	<!ENTITY scCWEarthzone							"0xE1282A03">
	<!ENTITY scPirateEarthzone						"0xE1282A04">
	<!ENTITY stAquilaEncounter						"0xE1282A05">
	<!--Ranx-->	
		;From Dynamic Systems V4 Vanilla Override
	<!ENTITY svRanxEmpire							"0xE1281B00">
		
	<!ENTITY stRanxHQ								"0xE1282B00">
	
	<!--Retaliation-->	
	<!ENTITY stRetaliationControllerSpawner			"0xE1282C00">
	<!ENTITY stRetaliationController				"0xE1282C01">
	<!ENTITY stPiracySupportController				"0xE1282C02">
	;Xeno spam- requested by Djohaal
	<!ENTITY evXenoSpamEventHandler					"0xE1282C03">
	<!ENTITY stXenoJump								"0xE1282C04">
	<!ENTITY rsXenoJump								"0xE1282C05">
	<!ENTITY itXenoJumpEffectsmall					"0xE1282C06">
	<!ENTITY itXenoJumpEffectmedium					"0xE1282C07">
	<!ENTITY itXenoJumpEffectlarge					"0xE1282C08">
	
	<!ENTITY stVirtualRespawnStation				"0xE1282C09">
	<!--Retaliation ships-->
	<!ENTITY scCentauriBaseShip						"0xE1282C10">
	<!ENTITY scCorporateExplorer					"0xE1282C11">
	<!ENTITY scScarabRespawnFreighter				"0xE1282C12">
	<!ENTITY itYoroiS250							"0xE1282C13">
	<!ENTITY scTechSlaver							"0xE1282C14">
	<!--Retaliation stations-->
	<!--Event handlers-->
	<!ENTITY evRetaliationEventHandler				"0xE1282D00">
	<!ENTITY evRespawnerEventHandler				"0xE1282D01">
		<!ENTITY stRespawnstation						"0xE1282D02">
		;from Baddies [rewritten here]
	<!ENTITY evStealCargoEventHandler				"0xE1282D03">
	<!ENTITY vtCargoSteal							"0xE1282D04">
	<!ENTITY ovCargoStolen							"0xE1282D05">

	<!ENTITY itCollision							"0xE1282D10">
	<!ENTITY itCargoStealAmmo						"0xE1282D11">
	
	
	<!ENTITY evMining								"0xE1282E00">
	<!ENTITY evEscapeEarthzone						"0xE1282E01">
	<!ENTITY evMiningStation						"0xE1282E02">
	
	<!ENTITY dsSovereignRelation					"0xE1282E03">
	
	<!--Resources-->
	<!ENTITY rsCentauriBaseShip						"0xE1282F00">
	<!ENTITY rsCentauriBaseShip2					"0xE1282F01">
	<!ENTITY snDrill								"0xE1282F02">
	<!ENTITY snBoink								"0xE1282F03">
	<!ENTITY rsDrill								"0xE1282F04">	
	<!ENTITY rsSmallReconstructionStation			"0xE1282F05">	
	<!ENTITY rsSungReconstructionStation			"0xE1282F06">	
	<!ENTITY rsSungReconstructionStation2			"0xE1282F07">	
	<!ENTITY rsReconStationPart1					"0xE1282F08">
	<!ENTITY rsReconStationPart2					"0xE1282F09">
	<!ENTITY rsReconStationPart3					"0xE1282F10">
	<!ENTITY rsReconStationPart4					"0xE1282F11">
	<!ENTITY rsReconStationPart5					"0xE1282F12">
	<!ENTITY stReconStation							"0xE1282F13">
	<!ENTITY scDySysFreighter						"0xE1282F14">
	<!ENTITY scDySysSapphire						"0xE1282F15">
	<!ENTITY scDySysWolfen							"0xE1282F16">
	
]>
<TranscendenceExtension UNID="&unidDynamicSystems;" version="1.0" name="Dynamic Systems Stuff" credits="RPC, Hatsya-Centauri Base Ship, Patupi-Reconstruction Station">
<Image UNID="&rsCentauriBaseShip;" 	bitmap="DySys Resources\CentauriBaseShipFull.jpg" backColor="0x00000000"/>
<!--Credits to Hatsya for the Centauri Base Ship design and graphic. Thanks!-->
<Image UNID="&rsCentauriBaseShip2;" bitmap="DySys Resources\Centauri Base Ship Test.jpg" backColor="0x00000000"/>

<Sound UNID="&snDrill;"		filename="DySys Resources\Drill.wav"/>
<Sound UNID="&snBoink;"		filename="DySys Resources\Boink.wav"/>
<image UNID="&rsDrill;"		bitmap="DySys Resources\Drill.jpg"			bitmask="DySys Resources\DrillMask.bmp"						loadOnUse="true"/>
<image UNID="&rsXenoJump;"	bitmap="DySys Resources\XenoJumpPoint.jpg" 	bitmask="DySys Resources\XenoJumpPointMask.bmp"				loadOnUse="true"/>
<!--Credits to Patupi for the Reconstruction Station designs and graphic. Thanks!-->
<image UNID="&rsSmallReconstructionStation;"	bitmap="DySys Resources\ConstructionStationSmall.jpg" 	bitmask="DySys Resources\ConstructionStationSmallMask.bmp"				loadOnUse="true"/>
<image UNID="&rsSungReconstructionStation;"	bitmap="DySys Resources\SungDSConstruction.jpg" 	bitmask="DySys Resources\SungDSConstructionMask.bmp"				loadOnUse="true"/>
<image UNID="&rsSungReconstructionStation2;"	bitmap="DySys Resources\SungDS2Construction.jpg" 	bitmask="DySys Resources\SungDS2ConstructionMask.bmp"				loadOnUse="true"/>
<image UNID="&rsReconStationPart1;"	bitmap="DySys Resources\Scaffold1.jpg" 	bitmask="DySys Resources\Scaffold1Mask.bmp"				loadOnUse="true"/>
<image UNID="&rsReconStationPart2;"	bitmap="DySys Resources\Scaffold2.jpg" 	bitmask="DySys Resources\Scaffold2Mask.bmp"				loadOnUse="true"/>
<image UNID="&rsReconStationPart3;"	bitmap="DySys Resources\Scaffold3.jpg" 	bitmask="DySys Resources\Scaffold3Mask.bmp"				loadOnUse="true"/>
<image UNID="&rsReconStationPart4;"	bitmap="DySys Resources\Scaffold4.jpg" 	bitmask="DySys Resources\Scaffold4Mask.bmp"				loadOnUse="true"/>
<image UNID="&rsReconStationPart5;"	bitmap="DySys Resources\Scaffold5.jpg" 	bitmask="DySys Resources\Scaffold5Mask.bmp"				loadOnUse="true"/>
<Globals>
	(block Nil
		;rewriting the CW Crime codes b/c destroying a destroyed station is o.o
		(setq intCommonwealthCrime (lambda (severity description)
			(if (gr severity (int (objGetData gPlayerShip "commonCrimeSeverity")))
				(block Nil
					(objSetData gPlayerShip "commonCrimeSeverity" severity)
					(objSetData gPlayerShip "commonCrime" description)
					)
				)
			))

		(setq intCommonwealthOnDestroy (lambda Nil
			(block Nil
				;(Plymessage gPlayer (Cat "Check is "(ls (ObjGetData gSource "Destroyed") 1)"!" ))
				(switch
					(ls (ObjGetData gSource "Destroyed") 1)
						(block Nil
							; Destroy items on the station
							(intDestroyItems gSource)

							; Add to the player's record
							(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
								(intCommonwealthCrime 3 (cat "the destruction of " (objGetName gSource 4)))
								)
							;set data that it was destroyed already
							(ObjSetData gSource "Destroyed" 1)
							;(Plymessage gPlayer (Cat "Data is "(ObjGetData gSource "Destroyed")"!" ))
							)
					)
				;check if aWreckObj is different the first time around
				)
			))
		;END rewrites
		(setq RPCFindAngle (lambda (Object1 Object2)
			(block (Lobject1 Lobject2)
				(if
					(gr (ObjGetDistance Object1 Nil) (ObjGetDistance Object2 Nil))
						(block Nil
							(setq greater Object1)
							(setq lesser Object2)
							)
						(block Nil
							(setq greater Object2)
							(setq lesser Object1)
							)
					)
				(sysVectorAngle (sysVectorSubtract (ObjGetPos greater) (ObjGetPos lesser)))
				)
			))
		(setq RPC-Within (lambda (SetA SetB) (block (Result)
				;check if any element from SetA is within Set B
				;this means that I have to run the match equal to the amount of elements in Set A and to use Item so that I get the right list element
				
				(enum SetA itmA (block nil
					(if (find setB itmA)
						(setq Result "True")
						(setq Result "Nil")
					)
				))
				result
			)))
		;take out 
			;name and Retaliationname
			;if lambda dies
		(setq RPCCreateSovereignAtkFleet (lambda (SovTest Retaliatelevel target shipOrder name Retaliationname)
			;Shiporder
				;(Retaliationshiptype escorttype pos sov theLeader cnt name level sovTest test ship Retaliationname metacnt)
			(block Nil
				;this is the start of the defining part....
				(setq level Retaliatelevel)
				;default metacnt to nil
				(setq metacnt Nil)
				(switch
					<!--
					(eq sovTest &svFerianMiners;)
						(block Nil
							(switch
								;retaliationlevel
									;scFerianMiner
									;scFerianWarrior
								(leq level 9)
									(block Nil
										(setq Retaliationshiptype &scFerianMiner;)
										(setq cnt (random 3 6))
										)
									(block Nil
										(setq Retaliationshiptype &scFerianWarrior;)
										(setq cnt (Divide (objGetData gSource "RPCFerianRetaliate") 2))
										)
										)
								
							(setq escorttype Retaliationshiptype)
							)-->
					; For Korolov freighters
					(eq sovTest &svIndependent;)
						(block Nil
							(switch
								;retaliationlevel
									;scWolfen
									;scRoninB
									;scRoninCharonBuster
									;scEI200CharonBuster
									;scRoninA
								(leq level 9)
									(block Nil
										(setq Retaliationshiptype &scEI200CharonBuster;)
										(setq cnt (random 3 6))
										)
								(and (geq level 10) (leq level 13))
									(block Nil
										(setq Retaliationshiptype &scRoninCharonBuster;)
										(setq cnt (random 4 8))
										)
								(and (geq level 14) (leq level 20))
									(block Nil
										(setq Retaliationshiptype &scRoninA;)
										(setq cnt (random 6 10))
										)
								(and (geq level 21) (leq level 25))
									(block Nil
										(setq Retaliationshiptype &scRoninB;)
										(setq cnt (random 6 10))
										)
								;If none of the above apply,
									(block Nil
										(setq Retaliationshiptype &scWolfen;)
										(setq cnt (random 6 10))
										)
								)
							(setq escorttype (random '(&scRoninA; &scRoninA; &scRoninA; &scRoninB; &scRoninB; &scWolfen;)))
							)
					; For CW
					;and it's a station [since I also register freighters now to add some loot]
					(eq &svcommonwealth; sovTest)
						;in the next block, we will define the local vars for ships and fleetcounts
						(block Nil
							;I set the local variables to Nil because local variables carry over to blocks within blocks
								
								(switch
									;syslevel first
									(leq (sysGetLevel) 4)
										;retaliationlevel
										(switch
											(leq level 9)
												(block Nil
													(setq Retaliationshiptype &scRoninC;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 10) (leq level 13))
												(block Nil
													(setq Retaliationshiptype &scIAVMedium;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 14) (leq level 20))
												(block Nil
													(setq Retaliationshiptype &scIAVHeavy;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 21) (leq level 25))
												(block Nil
													(setq Retaliationshiptype &scManticore;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											;If none of the above apply,
												(block Nil
													(setq Retaliationshiptype &scBritannia;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											)
									(geq (sysGetLevel) 5)
										(switch
											(leq level 5)
												(block Nil
													(setq Retaliationshiptype &scCenturion;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 6) (leq level 9))
												(block Nil
													(setq Retaliationshiptype &scCenturionX;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 10) (leq level 17))
												(block Nil
													(setq Retaliationshiptype &scBritannia;)
													(setq cnt 5)
													(setq metacnt Nil)
													)
											(and (geq level 18) (leq level 24))
												(block Nil
													(setq Retaliationshiptype &scAquilaCruiser;)
													(setq cnt 2)
													(setq metacnt Nil)
													)
											<!--
											;NOTE: IMPLEMENT BELOW!!
											;if CSC was sent, don't send another one--
											
											;If none of the above apply,
											(block Nil
												(setq Retaliationshiptype &scCSCHQ;)
												(setq cnt 1)
												)
												-->
												(block Nil
													(setq Retaliationshiptype &scAquilaCruiser;)
													(setq cnt (divide level 10))
													(setq metacnt Nil)
													)
											)
									)
									
							;this is an ad-hoc solution for how to deal with escorttype
							(setq escorttype Retaliationshiptype)
							)
					; For Ares
					(eq sovTest &svAres;)
						(block Nil
							(switch
								;retaliationlevel
								(leq level 9)
									(block Nil
										(setq Retaliationshiptype &scTundra;)
										(setq cnt (random 6 9))
										)
								(and (geq level 10) (leq level 13))
									(block Nil
										(setq Retaliationshiptype &scTundra;)
										(setq cnt (random 6 12))
										)
								(and (geq level 14) (leq level 20))
									(block Nil
										(setq Retaliationshiptype &scChasm;)
										(setq cnt (random 6 10))
										)
								(and (geq level 21) (leq level 25))
									(block Nil
										(setq Retaliationshiptype &scDeimos;)
										(setq cnt 3)
										)
								;If none of the above apply,
									(block Nil
										(setq Retaliationshiptype &scPhobos;)
										(setq cnt 2)
										)
								)
							(setq escorttype Retaliationshiptype)
							)

					; For Ranx
						(eq &svRanxEmpire; sovTest)
							(block Nil
								(switch
									;retaliationlevel- how to vary?
									;scRanxGunship
									;scRanxDreadnought
									<!--
									;New Ranx ship list:
									Ranx Gunship---			Done
									Heavy Gunship
									Cruiser---				ish
									DN---					Done
									Destroyer
									-->
									(and 
										(geq level 1) 
										(leq level 10)
										)
										(setq Retaliationshiptype &scRanxGunship;)
									;if none apply then-
										(setq Retaliationshiptype &scRanxDreadnought;)
									)
								;set cnt according to retaliationlevel
								(switch
									(and 
										(geq level 1) 
										(leq level 10)
										)
										(setq cnt 5)
									(and
										(geq level 11)
										(leq level 15)
										)
										(setq cnt 2)
									(and
										(geq level 16)
										(leq level 20)
										)
										(setq cnt 3)
									; if none of the above apply, 
									(setq cnt 4)
									)
									(setq escorttype Retaliationshiptype)
								)
					;Sung
						(eq &svSung; sovTest)
							(block Nil
								; set Retaliationshiptype and cnt at the same time
								(switch
									<!--
									Sung:
									scDragonSlaver Slaver				40
									scCarrierEarthSlaver				26-39???it has special scripting.. will it still work? 
									scEarthSlaver 						15-25 [the number increases by 2 for every 5]
									scSteelSlaver 						6-15
									scWindSlaver						1-5
									-->
									(and 
										(geq level 1) 
										(leq level 5)
										)
										(block Nil
											(setq Retaliationshiptype &scWindSlaver;)
											(setq cnt (random 5 8))
											)
									(and 
										(geq level 6) 
										(leq level 15)
										)
										(block Nil
											(setq Retaliationshiptype &scSteelSlaver;)
											(setq cnt (random 3 6))
											)
									(and 
										(geq level 15) 
										(leq level 25)
										)
										(block Nil
											(setq Retaliationshiptype &scEarthSlaver;)
											(switch	
												(and 
													(geq level 15) 
													(leq level 20)
													)
													(block Nil
														(setq cnt (random 3 5))
														)
												(and 
													(geq level 20) 
													(leq level 25)
													)
													(block Nil
														(setq cnt (random 6 8))
														)
												)
											)
									(and 
										(geq level 26) 
										(leq level 39)
										)
										(block Nil
											(setq Retaliationshiptype &scCarrierEarthSlaver;)
											(setq cnt (random 3 6))
											)
									;if none apply then-
										(block Nil
											;(setq Retaliationshiptype &scDragonSlaver;)
											(setq Retaliationshiptype &scTechSlaver;)
											(setq cnt (random 2 3))
											)
									)
									(setq escorttype Retaliationshiptype)
									)
					;Dwarg
						(eq &svDwargRaiders; sovTest)
								(block Nil
									; set Retaliationshiptype, escorttype and cnt at the same time
									(switch
										<!--
										scDwargMaster
										Dwarg:
										1-10
										scDwargRaider (5-8)
										11-15
										master+raider (x2)
										16-20
										master+raider (x3)
										21-25
										master+ 2 behemoths
										26-30
										master+ 2 behemoths (x2)
										scDwargBehemoth
										-->
										(and 
											(geq level 1) 
											(leq level 5)
											)
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargRaider;)
												(setq cnt (random 5 8))
												(setq metacnt 2)
												)
										(and 
											(geq level 6) 
											(leq level 15)
											)
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargRaider;)
												(setq cnt (random 10 16))
												(setq metacnt 2)
												)
										(and 
											(geq level 16) 
											(leq level 20)
											)
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargMaster;)
												(setq cnt (random 3 4))
												(setq metacnt 2)
												)
										(and 
											(geq level 21) 
											(leq level 25)
											)
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargBehemoth;)
												(setq cnt (random 3 4))
												(setq metacnt 2)
												)
										(and 
											(geq level 21) 
											(leq level 25)
											)
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargBehemoth;)
												(setq cnt (random 4 8))
												(setq metacnt 3)
												)
										
										;if none apply then-
											(block Nil
												(setq Retaliationshiptype &scDwargMaster;)
												(setq escorttype &scDwargBehemoth;)
												;(setq cnt (multiply 2 (divide level 5)))
												;(setq metacnt (divide level 5))
												(setq cnt (random 8 12))
												(setq metacnt 2)
												)
										)
									)
					;Huari
						(eq &svHuariEmpire; sovTest)
							(block Nil
								; set Retaliationshiptype and cnt at the same time
								(setq Retaliationshiptype &scHurinDestroyer;)
									(switch
										<!--
										Huari:
										scHurinDestroyer
										just increase cnt
										-->
										(and 
											(geq level 1) 
											(leq level 5)
											)
											(block Nil
												(setq cnt (random 1 3))
												)
										(and 
											(geq level 6) 
											(leq level 10)
											)
											(block Nil
												(setq cnt (random 3 5))
												)
										(and 
											(geq level 11) 
											(leq level 15)
											)
											(block Nil
												(setq cnt (random 5 8))
												)
										(and 
											(geq level 16) 
											(leq level 20)
											)
											(block Nil
												(setq cnt (random 8 12))
												)
										;if nothing else applies:
										(setq cnt (add (divide level 5) (random (divide level 5) (multiply (divide level 5) 2))))
										)
									(setq escorttype Retaliationshiptype)
									)
					;Urak
						(eq &svUrakWarlords; sovTest)
							(block Nil
									(switch
										<!--
										Urak: [since they don't have a full fleet I'll have to improvise...]
										-->
										(and 
											(geq level 1) 
											(leq level 5)
											)
											(block Nil
												(setq Retaliationshiptype &scUrakDestroyer;)
												(setq escorttype &scUrakSentinel;)
												(setq cnt (random 2 4))
												(setq metacnt 2)
												)
										(and 
											(geq level 6) 
											(leq level 10)
											)
											(block Nil
												(setq Retaliationshiptype &scUrakDestroyer;)
												(setq escorttype &scUrakSentinel;)
												(setq cnt (random 5 8))
												(setq metacnt (random 2 4))
												)
										(and 
											(geq level 11) 
											(leq level 15)
											)
											(block Nil
												(setq Retaliationshiptype &scUrakDestroyer;)
												(setq escorttype &scUrakSentinel;)
												(setq cnt (random 5 8))
												(setq metacnt (random 2 5))
												)
										(and 
											(geq level 16) 
											(leq level 20)
											)
											(block Nil
												(setq Retaliationshiptype &scUrakDestroyer;)
												(setq escorttype &scUrakDestroyer;)
												(setq cnt (random 1 3))
												(setq metacnt 2)
												)
										;if nothing else applies:
										(setq cnt (add (divide level 5) (random (divide level 5) (multiply (divide level 5) 2))))
										)
									)
					; For Marauder
						(eq &svMarauders; sovTest)
							(block Nil
								; set Retaliationshiptype, escorttype and cnt at the same time
								(switch
									<!--
										;scDrake
										;scViking-II
										;scBarbary
										;scMarauderRaidPlatform
										;scTripoli
									-->
									(and 
										(geq level 1) 
										(leq level 5)
										)
										(block Nil
											(setq Retaliationshiptype &scViking-II;)
											(setq escorttype &scBarbary;)
											(setq cnt (random 5 8))
											)
									(and 
										(geq level 6) 
										(leq level 15)
										)
										(block Nil
											(setq Retaliationshiptype &scDrake;)
											(setq escorttype &scBarbary;)
											(setq cnt (random 10 16))
											
											)
									(and 
										(geq level 16) 
										(leq level 20)
										)
										(block Nil
											(setq Retaliationshiptype &scMarauderRaidPlatform;)
											(setq escorttype &scBarbary;)
											(setq cnt (random 3 4))
											
											)
									(and 
										(geq level 21) 
										(leq level 25)
										)
										(block Nil
											(setq Retaliationshiptype &scTripoli;)
											(setq escorttype &scViking-II;)
											(setq cnt (random 3 4))
											
											)
									(and 
										(geq level 21) 
										(leq level 25)
										)
										(block Nil
											(setq Retaliationshiptype &scTripoli;)
											(setq escorttype &scBarbary;)
											(setq cnt (random 4 8))
											
											)
									
									;if none apply then-
										(block Nil
											(setq Retaliationshiptype &scTripoli;)
											(setq escorttype &scMarauderRaidPlatform;)
											(setq cnt (multiply 2 (divide level 5)))
											)
									)
								)
					; For Heliotropes
						(eq &svHeliotropes; sovTest)
							(block Nil
								(switch
									;scHeliotropeGunship
									;scHeliotropeDestroyer
									(and 
										(geq level 1) 
										(leq level 10)
										)
										(setq Retaliationshiptype &scHeliotropeGunship;)
									;if none apply then-
										(setq Retaliationshiptype &scHeliotropeDestroyer;)
									)
								;set cnt according to retaliationlevel
								(switch
									(and 
										(geq level 1) 
										(leq level 10)
										)
										(setq cnt 5)
									(and
										(geq level 11)
										(leq level 15)
										)
										(setq cnt 3)
									(and
										(geq level 16)
										(leq level 20)
										)
										(setq cnt 4)
									; if none of the above apply, 
									(setq cnt 5)
									)
								(setq escorttype Retaliationshiptype)
								)
					; For Centauri Raiders
						(eq &svCentauriWarlords; sovTest)
							(block Nil
								(switch
									;scCentauriRaider
									;scCentauriHeavyRaider
									(and 
										(geq level 1) 
										(leq level 5)
										)
										(setq Retaliationshiptype &scCentauriRaider;)
									;if none apply then-
										(setq Retaliationshiptype &scCentauriHeavyRaider;)
									)
								;set cnt according to retaliationlevel
								(switch
									(and 
										(geq level 1) 
										(leq level 10)
										)
										(setq cnt 5)
									(and
										(geq level 11)
										(leq level 15)
										)
										(setq cnt 6)
									(and
										(geq level 16)
										(leq level 20)
										)
										(setq cnt 8)
									; if none of the above apply, 
									(setq cnt 10)
									)
								(setq escorttype Retaliationshiptype)
								)
							
					; For Charon Pirates
						(eq &svPirates; sovTest)
							(block Nil
								<!--
									;scCorsair				1-5
									;scViking				6-10
									;scCorsair-II			11-15
									;scViking-II			16-20
									;scDrake				21-25
									;scCharonFrigateRaider	26-30
									;scMarauderRaidPlatform	
								-->
								;; run the switch
								;; set both the type and the count at the same time
								(switch
									(leq level 5)
										(block nil
											(setq Retaliationshiptype &scCorsair;)
											(setq cnt 6)
										)
									(and (geq level 6) (leq level 10))
										(block nil
											(setq Retaliationshiptype &scViking;)
											(setq cnt 6)
										)
									(and (geq level 11) (leq level 15))
										(block nil
											(setq Retaliationshiptype &scCorsair-II;)
											(setq cnt 9)
										)
									(and (geq level 16) (leq level 20))
										(block nil
											(setq Retaliationshiptype &scViking-II;)
											(setq cnt 9)
										)
									(and (geq level 21) (leq level 25))
										(block nil
											(setq Retaliationshiptype &scDrake;)
											(setq cnt 3)
										)
									(and (geq level 26) (leq level 30))
										(block nil
											(setq Retaliationshiptype &scCharonFrigateRaider;)
											(setq cnt 3)
										)
									;; else
									(block nil
										(setq Retaliationshiptype &scMarauderRaidPlatform;)
										(setq cnt 2)
										)
									)
									(setq escorttype Retaliationshiptype)
									)
						)
				;action part
				<!--
				;not metacnt
				(PrintTo 'log "metacnt")
				(PrintTo 'log metacnt)
					(PrintTo 'log i)
					(PrintTo 'log "i")
				(PrintTo 'log "cnt")
				(PrintTo 'log cnt)
				-->
				
				;set an if function to find out if Retaliationshiptype is defined [so that sovs that aren't in this don't invoke this code without a Retaliationshiptype and warn the player of an error]. 
				(if (not (iserror Retaliationshiptype))
					;if so, then sort by:
					;[in the previous if, I'm assuming that if Retaliationshiptype is defined, then so is metacnt or cnt, etc]
					(block Nil
						(if metacnt
							;teams [if they use metacnt]
							(block Nil
								;; decide where the reinforcements are coming from here we use the nearest gate
								;(setq pos (sysFindObject nil "GN"))
								;filter out Huaramarca
								(setq pos 
									(random 
										(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
										)
									)
								(if 
									pos
									;true=don't do anything
									Nil
									;false= choose random gate, record it in logs
									(block Nil
										;filter out Huaramarca
								(setq pos 
									(random 
										(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
										)
									)
								(if 
									pos
									;true=don't do anything
									Nil
									;false= choose random gate, record it in logs
									(block Nil
										(setq pos (random (sysFindObject nil "G")))
										(PrintTo 'log "Pos didn't work!")
										)
									)
										(PrintTo 'log "Pos didn't work!")
										)
									)
							
								;; determine what soverign the ships will have, (here we use the sov of the destroyed station)
								(setq sov sovTest)
									(if metacnt
										(for i 1 metacnt
											(block Nil
												(setq theLeader (sysCreateShip Retaliationshiptype pos sov))
												;if you're in militia the CW relay you position of enemies
												;if player is in militia and sov is enemy w/ CW, point the player to the atk fleet.
												(if 
													(and
														(geq (objGetData gPlayerShip "militiaRank") 1)
														(objIsEnemy (random (filter (sysFindObject Nil "T +populated;") station (eq (objGetSovereign station) &svCommonwealth;))) theLeader)
														)
														(block (thechance)
															(setq thechance (random 1 5))
															(if (eq thechance 1)
																(block Nil
																	(objSetShowAsDestination theLeader)
																	(Plymessage gPlayer "Militia intel indicate the location of the enemy fleet.")
																	)
																)
															)
													)
												;here is the inserted code to get fleets
													;give retaliation ship this event
													(objSetEventHandler theLeader &evRetaliationEventHandler;)
													(sysAddObjRecurringTimerEvent 450 theLeader "SquadronTactics")
														;set the teamLeader status
														(objSetData theLeader "teamLeader" true)
														;get ShipOrders from previous leader
															;ObjSetData- what?
																;order
																(objsetdata theLeader "shipOrder" shipOrder)
																;target
																(objSetData theLeader "orderTarget" (setq test (objGetID target)))
																
													;order the leader to wait so the squad forms up-- taken from evStdConvoyEncounterBehavior
													(shpOrder theLeader 'wait 10)
												
												;have the order be specific to what it is
												;keep this in synch with the metacnt version!
												(switch
													(eq shipOrder 'attack)
														;; order the leader to attack the destroyer then gate out
														(shpOrder theLeader shipOrder target)
													(eq shipOrder 'guard)
														(shpOrder theLeader shipOrder target)
													(eq shipOrder 'loot)
														(shpOrder theLeader shipOrder target)
													)
												(shpOrder theLeader 'gate)
												
												;; spawn to get the squad
												;If leader dies, then choose another leader- HOW DO I DO THAT?
												(if cnt
													(for i 1 cnt
														(block (ship)
															(setq ship (sysCreateShip escorttype pos sov))
																;here is the inserted code to get fleets
																	(objSetEventHandler ship &evRetaliationEventHandler;)
																(shpOrder ship 'escort theLeader)
																(shpOrder ship 'wander)
															
															)
														)
													)
												)
											)
										)
								)
							;non-teams [no metacnt]
							(block Nil
								
								;; decide where the reinforcements are coming from- here we use the nearest gate
								;(setq pos (sysFindObject nil "GN"))
								;Not anymore!
								;filter out Huaramarca
								(setq pos 
									(random 
										(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
										)
									)
								(if 
									pos
									;true=don't do anything
									Nil
									;false= choose random gate, record it in logs
									(block Nil
										(setq pos (random (sysFindObject nil "G")))
										(PrintTo 'log "Pos didn't work!")
										)
									)
							
								;; determine what soverign the ships will have, (here we use the sov of the destroyed station)
								(setq sov sovTest)
							
								(setq theLeader (sysCreateShip Retaliationshiptype pos sov))
								;if you're in militia the CW relay you position of enemies
								;if player is in militia and sov is enemy w/ CW, point the player to the atk fleet.
								(if 
									(and
										(geq (objGetData gPlayerShip "militiaRank") 1)
										(objIsEnemy (random (filter (sysFindObject Nil "T +populated;") station (eq (objGetSovereign station) &svCommonwealth;))) theLeader)
										)
										(block (thechance)
											(setq thechance (random 1 5))
											(if (eq thechance 1)
												(block Nil
													(objSetShowAsDestination theLeader)
													(Plymessage gPlayer "Militia intel indicate the location of the enemy fleet.")
													)
												)
											)
									)
								;XXXXX-fleets
								;here is the inserted code to get fleets
									;give retaliation ship this event
									(objSetEventHandler theLeader &evRetaliationEventHandler;)
										(sysAddObjRecurringTimerEvent 450 theLeader "SquadronTactics")
										;set the teamLeader status
										(objSetData theLeader "teamLeader" true)
										;get ShipOrders from previous leader
											;ObjSetData- what?
												;order
												(objsetdata theLeader "shipOrder" shipOrder)
												;target
												(objSetData theLeader "orderTarget" (setq test (objGetID target)))
									
									;order the leader to wait so the squad forms up-- taken from evStdConvoyEncounterBehavior
									(shpOrder theLeader 'wait 10)
											
											;have the order be specific to what it is
												(switch
													(eq shipOrder 'attack)
														;; order the leader to attack the destroyer then gate out
														(shpOrder theLeader shipOrder target)
													(eq shipOrder 'guard)
														(shpOrder theLeader shipOrder target)
													(eq shipOrder 'loot)
														(shpOrder theLeader shipOrder target)
													)
											(shpOrder theLeader 'gate)
								;XXXXX-squadron
											;; in case the single ship is not enough, spawn more ships
											(if cnt
												(for i 1 cnt
													(block (ship)
														(setq ship (sysCreateShip escorttype pos sov))
															;here is the inserted code to get fleets
																(objSetEventHandler ship &evRetaliationEventHandler;)
															(shpOrder ship 'escort theLeader)
															(shpOrder ship 'gate)
														)
													)
												)
								)
							)
						)
					)
				;notify player
				(block (NameObj NameDestroyedObj)
					(if
						(iserror aDestroyer)
						;true=nothing
						nil
						;false=
						(block Nil
							(setq NameObj(ObjGetName (objGetType aDestroyer)))
							(PrintTo 'log "NameObj:"NameObj" ")
							)
						)
					(if
						(iserror aObjDestroyed)
						;true=nothing
						nil
						;false=
						(block Nil
							(setq NameDestroyedObj(ObjGetName (objGetType aObjDestroyed)))
							(PrintTo 'log "NameDestroyedObj:"NameDestroyedObj" ")
							)
						)
					(block Nil
						(if
							(or
								(iserror aDestroyer)
								name
								)
							Nil
							(if
								(or
									(eq (objGetSovereign aDestroyer) &svDestructiveOrder;)
									(eq (objGetSovereign aDestroyer) &svDestructiveChaos;)
									(eq (objGetSovereign aDestroyer) &svCSCAntarctica;)
									)
									(setq name (typGetDataField (objGetType aDestroyer) 'name))
									;otherwise
									(setq name (typGetDataField (objGetSovereign aDestroyer) 'name))
								)
							)
						(if
							(or
								(iserror aObjDestroyed)
								Retaliationname
								)
							Nil
							(if
								(or
									(eq (objGetSovereign aObjDestroyed) &svDestructiveOrder;)
									(eq (objGetSovereign aObjDestroyed) &svDestructiveChaos;)
									(eq (objGetSovereign aObjDestroyed) &svCSCAntarctica;)
									)
									(setq Retaliationname (typGetDataField (staGetType aObjDestroyed) 'name))
									;otherwise
									(setq Retaliationname (typGetDataField (objGetSovereign aObjDestroyed) 'name))
								)
							)
						(switch
							(eq shipOrder 'attack)
								(block (namecheck retaliatecheck)
									;Plymessage check!
									;(plyMessage gPlayer "The "name" sends a squad to attack the "Retaliationname"!")
									(PrintTo 'log "name:"name" ")
									(iserror(setq namecheck (typGetDataField (objGetType aDestroyer) 'name)))
									(PrintTo 'log "namecheck:"namecheck"")
									;(PrintTo 'log ""name"")
									(PrintTo 'log "Retaliationname:"Retaliationname"")
									(iserror(setq retaliatecheck (typGetDataField (objGetType aObjDestroyed) 'name)))
									(PrintTo 'log "retaliatecheck:"retaliatecheck"")
									;(PrintTo 'log ""Retaliationname"")
									(PrintTo 'log "The "name" send a squad to attack "Retaliationname"!")
									)
							(eq shipOrder 'guard)
								;Plymessage check!
								;(plyMessage gPlayer "The "Retaliationname" sends a squadron to guard a respawn ship.")
								Nil
							)
						)
					<!--
					01/06/2013 21:20:56	NameObj:Nil 
01/06/2013 21:20:56	NameDestroyedObj:Nil 
01/06/2013 21:20:56	NameObj:Nil 
01/06/2013 21:20:56	NameDestroyedObj:Nil 
01/06/2013 21:20:56	name:Ares Sect 
01/06/2013 21:20:56	namecheck:Xenophobe fighter
01/06/2013 21:20:56	Retaliationname:(destructive chaos)
01/06/2013 21:20:56	retaliatecheck:Ares outpost
01/06/2013 21:20:56	The Ares Sect send a squad to attack (destructive chaos)!
					-->
					<!--
					;if player is in militia and sov is enemy w/ CW, point the player to the atk fleet.
					(if 
						(and
							(geq (objGetData gPlayerShip "militiaRank") 1)
							(objIsEnemy (random (filter (sysFindObject Nil "T +populated;") station (eq (objGetSovereign station) &svCommonwealth;))) (ObjGetSovereign sovTest))
							)
							(block Nil
								(objSetShowAsDestination theLeader)
								(Plymessage gPlayer "Militia intel indicate the location of the enemy fleet.")
								)
						)
					-->
					)
				)
			
			<!--
			;change! 
			(if (match (list &svCommonwealth;) art (eq Sovereign art))
				;list of sovs for this lambda
				;proceed
				(block Nil
					Nil
					)
				;else:
				(block Nil
					(plymessage gPlayer (cat ""sovereign" is not listed in RPCCreateSovereignAtkFleet."))
					)
				)-->
			))
		)
</Globals>
<!--TODO-->
; MAKE GLOBALS!!!!
;creds:
	; dvlenk6-- awesome graphics!
;List of factions to add:
;Centauri Warlords			-svCentauriWarlords
;Charon Pirates				-svPirates
;Marauders					-svMarauders
;illegal miners--			-svSettlers
;Urak Warlords				-svUrakWarlords
;Heliotropes				-svHeliotropes
;Black Market				-svBlackMarket
;Sung Slavers				-svSung
;Dwarg Raiders				-svDwargRaiders
;Huari Empire				-svHuariEmpire
;Ventari Settlers			-N/A
;Bennin Xenophobes			-N/A
;Gaian Terraformers			-svGaianTerraformers
;Baka!- there /is/ a Ringer Sovereign!
;Ringers					-svRingers
;~Ish
;Kobol Warlords
;Order of Penitence
;Outlaws
;Outlaw Miners
;Rogue Fleet
;Syrtis Conclave????

;Salvagers
;Sapiens
;United African States

;When they get ships:
;Luminous
;Ringers Collective-- they have one: the Corp Explorer. ooooohhhh
;Teraton Host 


<!--CW-->
;Scarab w/ Britannia escourts
;attack Ares

;Retaliate
;Centurions- follow-up Centurion/X's

;increase Retaliationlevel- loss of 
	;CSC HQ
	;CSC
	;scarabs
	;CW stations
;
;

<!--Ares-->
;Communes- mining sandstorms- 
;attack CW

;Retaliate
	;sandstorm- Tundra

;increase Retaliationlevel- loss of 
	;HQ
	;Shipyards
	;Communes
	;outposts
	;Phobos and Deimos
;
;
<!--Ranx-->
;give Fortresses weapons!

;already est. outposts
	;outpost- mining DN- 

;Retaliate
	;gunship squad- 2 gunship squads

;increase Retaliationlevel- loss of 	
	;HQ
	;Fortress
	;Ranx Foundry
	;Ranx outpost
	; Ranx DN

<!--
; For CW
						(eq &svcommonwealth; sovTest)
							(objFireEvent gSource "CWRetaliate")
					; For Ares
						(eq &svAres; sovTest)
							(objFireEvent gSource "AresRetaliate")
					; For Ranx
						(eq &svRanxEmpire; sovTest)
							(objFireEvent gSource "RanxRetaliate")
					;Sung
						(eq &svSung; sovTest)
							(objFireEvent gSource "SungRetaliate")
					;Dwarg
						(eq &svDwargRaiders; sovTest)
							(objFireEvent gSource "DwargRetaliate")
					;Huari
						(eq &svHuariEmpire; sovTest)
							(objFireEvent gSource "HuariRetaliate")
					;Urak
						(eq &svUrakWarlords; sovTest)
							(objFireEvent gSource "UrakRetaliate")
					;Marauders
						(eq &svMarauders; sovTest)
							(objFireEvent gSource "MarauderRetaliate")
					; For Heliotropes
						(eq &svHeliotropes; sovTest)
							(objFireEvent gSource "HeliotropeRetaliate")
					; For Centauri Raiders
						(eq &svCentauriWarlords; sovTest)
							(objFireEvent gSource "CentauriRetaliate")
					; For Charon Pirates
						(eq &svPirates; sovTest)
							(objFireEvent gSource "CharonRetaliate")
-->

<!-- Ares HQ -->

	<StationType UNID="&stAresHQ;"
			name=				"Ares HQ"
			sovereign=			"&svAres;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockScreen=			"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itMassiveTharsisPlate;"
			maxHitPoints=		"1000"
			hitPoints=			"1000"
			explosionType=		"&vtThermoExplosion4;"
			ejectaType=			"&vtWreckEjecta;"
			repairRate=			"4"

			attributes=			"ares,aresMajor,enemy,envAir,envEarth,envFire,envWater,populated, AresHQ"
			levelFrequency=		"----- --vuu ----- ----- -----"
			locationCriteria=	"*"
			enemyExclusionRadius="100"
			>

		<Image			imageID="&rsStations9;" imageX="0" imageY="256" imageWidth="256" imageHeight="256"/>

		<Ships>
			<Ship		count="1d2"		class="&scTundra;" orders="guard"/>
			<Ship		count="1d6"		class="&scSandstorm;" orders="patrol" patrolDist="5"/>
			<Ship		count="1"		class="&scPhobos;" orders="guard"/>
			<Table>
				<Ship	chance="40"	count="1d4+2"	class="&scChasm;" orders="patrol" patrolDist="5"/>
				<Ship	chance="40" count="1d2" class="&scDeimos;" orders="patrol" patrolDist="8"/>
				<Ship	chance="10" count="4d6"	class="&scSandstorm;" orders="patrol" patrolDist="8"/>
				<Ship	chance="10" count="1"	class="&scPhobos;"	orders="guard"/>
			</Table>
			<Ship count="3d6" class="&scSandstorm;" orders="mine" controller="ferian"/>
		
		</Ships>

		<Construction constructionRate="400" maxConstruction="20">
			<Table>
				<Ship chance="15"	count="1"	class="&scSandstorm;"	 orders="mine" />
				<Ship chance="15"	count="1"	class="&scSandstorm;"	 orders="patrol" patrolDist="5"/>
				<Ship chance="20"	count="1"	class="&scChasm;"		 orders="patrol" patrolDist="5"/>
				<Ship chance="20"	count="1"	class="&scTundra;"		 orders="patrol" patrolDist="8"/>
				<Ship chance="10"	count="1"	class="&scDeimos;"		 orders="patrol" patrolDist="8"/>
				<Ship chance="10"	count="1"	class="&scDeimos;"		 orders="wander"/>
				<Ship chance="10"	count="1"	class="&scPhobos;"		 orders="patrol" patrolDist="150"/>
			</Table>
		</Construction>

		<Items>
			<Table count="1d4">
				<Lookup chance="25" count="1d3" table="&trConsumables8;"/>
				<Lookup chance="25" count="1"	table="&trConsumables9;"/>
				<Lookup chance="25" count="1"	table="&trMinorItem8;"/>
				<Lookup chance="15" count="1"	table="&trMinorItem9;"/>
				<Lookup chance="10" count="1"	table="&trMajorItem8;"/>
			</Table>
		</Items>

		<Satellites>
			<Orbitals count="2d6" distance="12" angle="equidistant">
				<Ship class="&scAresCannon;" count="1" sovereign="&svAres;" orders="hold"/>
			</Orbitals>
		</Satellites>

		<Encounters frequency="common">
			<Lookup table="&tbAresEncounters;"/>
		</Encounters>
		<Events>
			<OnCreate>
				(block Nil
					;look for CW
					(setq CW (sysFindObject gSource "TAEN +CWHQ;"))
					;kill them
					(setq AttackFleet(sysCreateShip &scPhobos; gSource &svAres;))
					(shpOrder AttackFleet 'attack CW)
					)
			</OnCreate>
		</Events>
	</StationType>
	
	<StationType UNID="&stCWHQ;"
            name=               "(CW HQ)"
            sovereign=          "&svCommonwealthFleet;"
            shipEncounter=      "true"
            scale=              "ship"			

			attributes=         "friendly, commonwealth, commonwealthFleet, commonwealthMilitary, genericClass, fleetLaw, CWHQ"
            level=              "10"
			levelFrequency=		"----- rcurr ----- ----- -----"
           
			enemyExclusionRadius="500"
            >

       <Ships>
			<Ship	count="1"	class="&scCSCHQ;" orders="hold">

				<Names definiteArticle="true">CSC HQ; CSC Agrabah; CSC Agraria; CSC Amerope; CSC Atlantica; CSC Atlantis; CSC Babahl; CSC Babar's Kingdom; CSC Bangstoff; 
				CSC Britannian Empire; CSC Cheezburgerstan; CSC Cobra Island; CSC Cornada; CSC Dalmasca; CSC Dinotopia; CSC East African Protectorate; 
				CSC Federated Union of Earth; CSC Fiore; CSC Franistan; CSC Ganubia; CSC Gavel Republic; CSC Ghalea; CSC Granbretan; CSC Hyrule; CSC Isla Cruces; 
				CSC Isla de Muerta; CSC Kanto; CSC Kasnia; CSC Latveria; CSC Lyrobia; CSC Midgar; CSC Monica; CSC Monkey Island; CSC Mushroom Kingdom; 
				CSC Oceania; CSC Orb Union; CSC Oriense; CSC Oz; CSC Pelegostos; CSC Pepperland; CSC Phatt Island; CSC Plunder Island; CSC Vanutu; 
				CSC Vulgaria; CSC Yangdon; CSC Zarcovia;  </Names>

				<InitialData>
					<CSC>"HQ"</CSC>
				</InitialData>

				<Escorts>
					<Ship     count="3"		class="&scDSAquilaCruiser;"	orders="patrol" patrolDist="50"/>
					<Ship     count="2d2"	class="&scCenturion;"		orders="patrol" patrolDist="15"/>
					<Ship 	  count="2d2"	class="&scCenturionX;"		orders="patrol" patrolDist="15"/>
					<Ship     count="2d2"	class="&scBritannia;"		orders="patrol" patrolDist="15"/>
				</Escorts>
			</Ship>
		</Ships>		
    </StationType>
	<ShipClass UNID="&scCSCHQ;"
			manufacturer=		"HQ"
			class=				"Commonwealth Star Carrier"
			type=				""
			score=				"2330"

			mass=				"50000"
			cargoSpace=			"5000"
			thrust=				"10000"
			maneuver=			"24"
			maxSpeed=			"2"

			cyberDefenseLevel=	"8"
			explosionType=		"&vtThermoExplosion4;"
			leavesWreck=		"100"

			attributes=			"commonwealth, commonwealthFleet, commonwealthMilitary, genericClass, fleetLaw, CWHQ"

			dockScreen=			"Main"
			defaultBackgroundID="&rsCSCBkgnd;"
			
			inherit=			"&baCSCBase;"
			>
		
		<Names definiteArticle="true">CSC HQ; CSC Agrabah; CSC Agraria; CSC Amerope; CSC Atlantica; CSC Atlantis; CSC Babahl; CSC Babar's Kingdom; CSC Bangstoff; 
				CSC Britannian Empire; CSC Cheezburgerstan; CSC Cobra Island; CSC Cornada; CSC Dalmasca; CSC Dinotopia; CSC East African Protectorate; 
				CSC Federated Union of Earth; CSC Fiore; CSC Franistan; CSC Ganubia; CSC Gavel Republic; CSC Ghalea; CSC Granbretan; CSC Hyrule; CSC Isla Cruces; 
				CSC Isla de Muerta; CSC Kanto; CSC Kasnia; CSC Latveria; CSC Lyrobia; CSC Midgar; CSC Monica; CSC Monkey Island; CSC Mushroom Kingdom; 
				CSC Oceania; CSC Orb Union; CSC Oriense; CSC Oz; CSC Pelegostos; CSC Pepperland; CSC Phatt Island; CSC Plunder Island; CSC Vanutu; 
				CSC Vulgaria; CSC Yangdon; CSC Zarcovia;  </Names>
		
		<Armor>
			<ArmorSection start="350" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="340" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="330" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="320" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="310" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="300" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="290" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="280" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="270" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="260" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="250" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="240" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />

			<ArmorSection start="230" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="220" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="210" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="200" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="190" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="180" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="170" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="160" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="150" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="140" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="130" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="120" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />

			<ArmorSection start="110" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="100" span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="90"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="80"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="70"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="60"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="50"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="40"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="30"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="20"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="10"  span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
			<ArmorSection start="0"   span="10" armorID="&itP1000HexphaseArmor;" areaSet="7,13" />
		</Armor>

		<Devices>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="270" maxFireArc="90"  posAngle="0" posRadius="64"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="90"  maxFireArc="270" posAngle="180" posRadius="64"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" omnidirectional="true" posAngle="90" posRadius="44"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" omnidirectional="true" posAngle="270" posRadius="44"/>
			<Device deviceID="&itLAM;" omnidirectional="true" posAngle="270" posRadius="44"/>
			
			<Device deviceID="&itMissileDefense;" omnidirectional="true" />
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&vtDamageControlParty;"/>
		</Devices>

		<Items>
			<Item				count="6d12"	item="&itPteracniumFuelRod;"/>
		</Items>

		<Image imageID="&rsLargeShips2;" imageX="0" imageY="0" imageWidth="256" imageHeight="256" />

		<AISettings
			aggressor=			"true"
			fireRateAdj=		"10"
			fireAccuracy=		"95"
			perception=			"100"
			/>
			
		<StaticData>
			<!--
			The first code block must return a string describing the
			mission (or Nil, if a mission could not be found).

			The code should also place any data about the mission in global variable
			that can be accessed by the second code block.

			The second code block initiates the mission from global variables
			set by the first code block. It should permanently store the mission
			as object data.

			The third code block returns a string describing the success of
			the mission (or Nil, if the mission is in progress)
			-->

			<!-- Level 1 Missions -->

			<Missions1>
				(
					; Recon mission
					("mission1a"
						; Code to describe mission
						(lambda Nil
							(block (stationList)
								; Look for a major Ares station in the system
								(setq stationList (sysFindObject gSource "T:aresMajor;A"))

								; If we found at least one, then pick a random one
								(setq gTarget (random stationList))

								(switch
									; If we have no target, then no mission
									(not gTarget)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"We need you to do a recon mission on " (objGetName gTarget 4) " in this system. All you have to do is fly past it and make visual contact. We'll enter the coordinates to your computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (timer)
								; Remember what we're supposed to recon
								(objSetObjRefData gSource "Target" gTarget)

								; Set the recon target in the player ship's computer
								(shpOrderEscort gPlayerShip gTarget)
								(objSetIdentified gTarget)

								; Prepare the station to be reconned
								(staClearReconned gTarget)
								(staSetFireReconEvent gTarget)

								; Get events for the station
								(objRegisterForEvents gSource gTarget)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block (damage)
								(setq damage (objGetVisibleDamage gPlayerShip))

								; Set description
								(switch
									(gr damage 75)
										(scrSetDesc gScreen "\"Outstanding mission! You better report to Docking Services to have all that damage repaired!\"")

									(gr damage 25)
										(scrSetDesc gScreen "\"Outstanding mission! Looks like you got a little banged up out there.\"")

									(scrSetDesc gScreen "\"Outstanding mission! You made it look easy.\"")
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Fleet Delivery mission
					("mission1b"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Look for a major commonwealth station in the system that is at least
								; 300 light-seconds from here.
								(setq stationList (sysFindObject gSource "T:fleetDelivery; A R:300;"))

								; If we found at least one, then pick a random one
								(setq gTarget (random stationList))

								(switch
									; If we have no target, then no mission
									(or (not gTarget) (objGetData gTarget "fleetMissionCargo"))
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"We need you to take much needed supplies to " (objGetName gTarget 4) " in this system. We'll empty your cargo hold so that we can fit as much cargo as possible (but don't worry, you'll get all your stuff back). We'll program the delivery coordinates into your flight computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (allItems count neededItem roll enemyAmbush)
								; Remember the mission (so that we will know when we reach
								; our destination)
								(objSetObjRefData gPlayerShip "fleetMission" gSource)

								; Remember where we're supposed to deliver this stuff
								(objSetObjRefData gSource "Target" gTarget)

								; Set the target in the player ship's computer
								(shpOrderEscort gPlayerShip gTarget)
								(objSetIdentified gTarget)

								; Remove all uninstalled items from the player's ship (except missiles/ammo or IDs)
								(objSetData gSource "fleetMissionSavedCargo" (setq allItems (objGetItems gPlayerShip "*U~m -ID;")))
								(enum allItems thisItem
									(objRemoveItem gPlayerShip thisItem)
									)

								; Pick a random item
								(setq neededItem (random '(&itGradeAGrains; &itWaterIce; &itMedicalSupplies; &itSalmonite;)))

								; Figure out how many barrels of grain we can take
								(setq count (divide (objGetCargoSpaceLeft gPlayerShip) (itmGetMass (itmCreate neededItem 1))))
								(if (eq count 0)
									(setq count 1)
									)

								; Add the items to the player ship (and remember)
								(objAddItem gPlayerShip (itmCreate neededItem count))
								(objSetData gTarget "fleetMissionCargo" (objGetItems gPlayerShip "*U~m -ID;"))

								; Figure out what kind of enemy will attack the player
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq enemyAmbush &etKobolAmbush1;)

									(leq roll 90)
										(setq enemyAmbush &etRogueAmbush1;)

									(setq enemyAmbush &etAresAmbush2;)
									)

								; On timer, enemies attack player
								(sysAddEncounterEventAtDist 
									(add 300 (random 0 150)) 
									gPlayerShip 
									enemyAmbush 
									(random 120 200)
									)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Nice work! Those supplies will do some good.\"")

								; Restore the items that we took from the player
								(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
									(objAddItem gPlayerShip thisItem)
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(block (target)
								; Remove the supplies (if the player has any)
								(setq target (objGetObjRefData gSource "Target"))
								(setq items (objGetData target "fleetMissionCargo"))

								(enum items thisItem
									(objRemoveItem gPlayerShip thisItem)
									)
									
								; Restore the items that we took from the player
								(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
									(objAddItem gPlayerShip thisItem)
									)

								(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
								)
							)
						)

					; Juan Carlos mission
					("mission1c"
						; Code to describe mission
						(lambda Nil
							(switch
								; If we've already done this mission, then don't bother
								(typGetGlobalData &scEI500JuanCarlos; "deliverROM")
									(block Nil
										(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
										Nil
										)

								; Otherwise, OK
								(cat "\"We need you to rendezvous and dock with a freighter a few light-minutes away. Pick up a data ROM and bring it back here safely. Understood?\"")
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (ship)
								; Create the Juan Carlos some place relatively safe
								(setq ship 
									(sysCreateShip 
										&scEI500JuanCarlos; 
										(sysVectorRandom gSource (random 240 400) 60 "Ts")
										&svCommonwealth;
										)
									)
								(shpOrderHold ship)

								; Set the player to go there
								(shpOrderDock gPlayerShip ship)
								(objSetIdentified ship)
								(objSetObjRefData gPlayerShip "MissionSource" gSource)

								; Track the player
								(objRegisterForEvents gSource gPlayerShip)

								; Sometimes the freighter is under attack
								(if (leq (random 1 100) 50)
									(sysAddEncounterEventAtDist 0 ship &etAresAmbush1; (objGetDistance gSource ship))
									)

								; Can't get this mission again
								(typSetGlobalData &scEI500JuanCarlos; "deliverROM" True)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Nice work! The data on this ROM is very important for the admiral and the Fleet.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Intercept Ares patrol
					("mission1d"
						; Code to describe mission
						(lambda Nil
							"\"There's an Ares patrol inbound that wants to take a peek at us. Your mission is to intercept and destroy the entire flight before it can gate out of the system and report our location. Understood?\""
							)

						; Code to initiate mission
						(lambda Nil
							(block (squadronCount startPos)
								; Remember how many we need to kill
								(setq squadronCount 8)
								(objSetData gSource "TargetCount" squadronCount)
								(objSetData gSource "TargetsLeft" squadronCount)

								(setq startPos (sysVectorRandom gSource (random 100 120) 60))

								; Create the squadron a certain distance away and send them 
								; to the carrier.
								(for i 0 (subtract squadronCount 1)
									(block (ship)
										(setq ship
											(sysCreateShip 
												&scSandstorm; 
												(sysVectorPolarOffset startPos (random 0 359) (random 1 6))
												&svAres;
												)
											)

										; Order the ship to patrol near the CSC
										(shpOrderPatrol ship gSource 3)

										; Remember the ship
										(objSetObjRefData gSource (cat "Target" i) ship)
										(objRegisterForEvents gSource ship)
										)
									)

								; Set the target
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip (objGetObjRefData gSource "Target0"))
								(objSetIdentified (objGetObjRefData gSource "Target0"))

								; We create a timer to check on the position of the ships
								(sysAddObjRecurringTimerEvent 30 gSource "OnAresPatrolCheck")
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding, pilot! That's the way to do it!\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions1>

			<Missions2>
				(
					; Destroy Ares freighter
					("mission2a"
						; Code to describe mission
						(lambda Nil
							(block (gate stationList)
								; Get the list of all Ares bases
								(setq stationList (sysFindObject gSource "T:ares;A"))
								(setq gEnd Nil)

								; For each stargate, see if we can travel to an Ares base
								; stop looking when we find a destination
								(enumwhile
									(sysFindObject gSource "G -uncharted;")
									(not gEnd)
									gate

									(block (bestDist testDest)
										; Pick a stargate
										(setq gStart gate)

										; Find the nearest base to the stargate that is at least
										; 300 light-seconds away from the stargate
										(setq bestDist 1200)
										(enum stationList testDest
											(if (and 
													(gr (objGetDistance gStart testDest) 300)
													(ls (objGetDistance gStart testDest) bestDist))
												(block Nil
													(setq bestDist (objGetDistance gStart testDest))
													(setq gEnd testDest)
													)
												)
											)
										)
									)

								; If we found a station, then compose the mission text
								(if gEnd
									(cat "\"An Ares freighter is delivering supplies to " (objGetName gEnd 4) " in this system. Your orders are to intercept and destroy the freighter. Any questions?\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (ship)
								; create the transport
								(setq ship (sysCreateShip &scPolar; gStart &svAres;))
								(shpOrderDock ship gEnd)
								(shpOrderGate ship)

								; create the escorts
								(for i 1 5
									(block (escort)
										(setq escort (sysCreateShip &scSandstorm; gStart &svAres;))
										(shpOrderEscort escort ship)
										)
									)

								; Add some items to the transport
								(objAddItem ship (itmCreate &itPteracniumOre; (random 10 30)))
								(objAddRandomItems ship &trConsumables6; (random 1 4))
								(objAddRandomItems ship &trMinorItem6; 1)

								; register so we know when the main ship is destroyed
								(objRegisterForEvents gSource ship)
								(objSetObjRefData gSource "Target" ship)

								; orders
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip ship)
								(objSetIdentified ship)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! That's one less supply ship for the Martians&#x97;just a matter of time before this war is over.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 150)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Defend superfreighter
					("mission2b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								; Find a stargate more than 300 light-seconds away
								(setq gateList (sysFindObject gSource "GR:300; -uncharted;"))

								; See if we meet all requirements
								(switch
									; If there are no gates near by, there is no mission
									(not gateList)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
											Nil
											)

									; Otherwise, we compose the mission text
									(block Nil
										(setq gStart (random gateList))
										(cat "\"A superfreighter carrying pteracnium ore will enter the system at " (objGetName gStart 0) " and rendezvous with us here. Your mission is to escort it safely from the gate to our location. Clear?\"")
										)
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (obstacle roll)
								; Choose a random obstacle for the mission
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq obstacle 'aresAttack)

									(leq roll 90)
										(setq obstacle 'rogueAmbush)

									(setq obstacle 'suicideRun)
									)

								(objSetData gSource "MissionVariant" obstacle)

								; Remember the start point
								(objSetObjRefData gSource "StartGate" gStart)

								; Create a timer for the creation of the freighter
								(sysAddObjTimerEvent (multiply (objGetDistance gPlayerShip gStart) 3) gSource "OnTimerFreighterAppears2B")

								; point the player to the stargate
								(shpCancelOrders gPlayerShip)
								(shpOrderDock gPlayerShip gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(if (eq (objGetData gSource "MissionVariant") 'suicideRun)
									(scrSetDesc gScreen "\"Excellent mission! Your quick reaction probably saved hundreds of lives on this ship!\"")
									(scrSetDesc gScreen "\"Excellent mission! That pteracnium fuel is desperately needed!\"")
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 150)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions2>

			<MissionRescueScientists>
				(
					("mission3rescue"
						; Code to describe mission
						(lambda Nil
							(cat "\"OK, this is a high-profile rescue mission, so I don't want any screw-ups!\n\n"
								"\"Two of our weapons designers have been kidnapped by rogue fleet elements. "
								"We're sending an Aurochs transport with an extraction team to rescue our Einsteins. "
								"All you've got to do is protect the transport to the rogue base and back. Clear?\""
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (base ship)
								; Create the rogue base. The base position must be at least 120 light-seconds
								; away from anything else.

								(setq base (sysCreateStation &stRogueBaseRescue; (sysVectorRandom gSource (random 400 600) 120 "t")))
								(objSetObjRefData gSource "Target" base)

								; Create the rescue ship

								(setq ship (sysCreateShip &scAurochs; gSource &svCommonwealthFleet;))
								(shpOrderDock ship base)
								(shpOrderWait ship (random 10 20))
								(shpOrderDock ship gSource)
								(shpOrderWait ship 5)
								(shpOrderGate ship)

								(objSetObjRefData gSource "Ship" ship)
								(objRegisterForEvents gSource ship)

								; orders
								(shpOrderEscort gPlayerShip ship)
								(objSetIdentified ship)
								(objRegisterForEvents gSource gPlayerShip)

								; Encounter
								(if (leq (random 1 100) 60)
									(sysAddEncounterEventAtDist (add 500 (random 0 100)) ship &etRogueAmbush1; (random 120 200))
									)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Now we can put those Einsteins back to work!\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 350)

								(typSetGlobalData &scCSCTerra; "p262scientists" "rescued")
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								(scrSetDesc gScreen "\"That's what I get for counting on you!\n\n\"You're demoted back to Privateer! Now get out of my sight!\"")
								(objSetData gPlayerShip "fleetXP" 400)
								(objSetData gPlayerShip "fleetLevel" 2)

								(typSetGlobalData &scCSCTerra; "p262scientists" "failed")
								)
							)
						)
					)
			</MissionRescueScientists>

			<Missions3>
				(
					; Defend supply ship
					("mission3a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Find a random stargate more than 400 light-seconds from us
								(setq gStart (random (sysFindObject gSource "G R:400; -uncharted;")))

								; Describe the mission
								(if gStart
									(cat "\"A supply ship is arriving at the " (objGetName gStart) ". Your orders are to escort it back to " (objGetName gSource 4) " and defend it against all enemies. Carry On!\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Set a timer to give the player a chance to get to the stargate
								(objSetObjRefData gSource "Target" gStart)
								(setq timer (add (multiply 5 (objGetDistance gSource gStart)) (random 0 200)))
								(sysAddObjTimerEvent timer gSource "OnTimerConvoyAppears3A")

								; Add some enemy ships patrolling around the stargate
								(for i 1 (random 4 6)
									(block (patrol)
										(setq patrol (sysCreateShip &scSandstorm; gStart &svAres;))
										(shpOrderPatrol patrol gStart 20)
										)
									)

								; orders
								(shpOrderEscort gPlayerShip gStart)
								(objSetIdentified gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Those supplies are desperately needed here.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 250)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Defend Refugee Convoy
					("mission3b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								(setq gStart Nil)

								; Get the list of gates in the system
								(setq gateList (sysFindObject gSource "G -uncharted;"))

								; Make sure there are at least 2 gates
								(if (geq (count gateList) 2)
									(block Nil
										(setq gStart (item gateList 0))
										(setq gEnd (item gateList 1))

										; The two gates better be at least 150 light-seconds
										; away from each other
										(if (ls (objGetDistance gStart gEnd) 150)
											(setq gStart Nil)
											)
										)
									)

								; Describe mission
								(switch
									; If system is not configured correctly
									(not gStart)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
											Nil
											)

									; Otherwise
									(cat "\"A refugee convoy is passing through the system. Your mission is to lead a small squadron and escort the convoy safely through the system. Any questions?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Create some ships off-screen and bring them in
								(intFleetCreateWingmen gSource 6 &scCenturion;)

								; Set a timer to give the player a chance to get to the stargate
								(setq timer (add (multiply 5 (objGetDistance gSource gStart)) (random 0 200)))
								(sysAddObjTimerEvent timer gSource "OnTimerConvoyAppears3B")

								(objSetObjRefData gSource "StartGate" gStart)
								(objSetObjRefData gSource "EndGate" gEnd)

								; orders
								(shpOrderEscort gPlayerShip gStart)
								(objSetIdentified gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Those refugees have a chance to start a new life away from the war zone.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 250)
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
								)
							)
						)
					)
			</Missions3>

			<Missions4>
				(
					; Destroy Ares station
					("mission4a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Pick a random Ares station in the system
								(setq gTarget (random (sysFindObject gSource "T:aresMajor;A")))

								; Compose description
								(if gTarget
									(cat "\"This mission is straight from Admiral Decker himself. We want you to lead a flight of Britannias to destroy " (objGetName gTarget 4) " in this system. Any questions?\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scBritannia;)

								; Point-out the station to destroy
								(objSetObjRefData gSource "Target" gTarget)
								(objRegisterForEvents gSource gTarget)
								(shpOrderAttack gPlayerShip gTarget)
								(objSetIdentified gTarget)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								; Set description
								(switch
									(eq shipsLeft 0)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(eq shipsLeft 1)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only one of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeft " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" (add 250 (multiply shipsLeft 100)))
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Destroy Ares convoy
					("mission4b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								(setq gStart Nil)

								; Get the list of gates in the system
								(setq gateList (sysFindObject gSource "G -uncharted;"))

								; Make sure there are at least 2 gates
								(if (geq (count gateList) 2)
									(block Nil
										(setq gStart (item gateList 0))
										(setq gEnd (item gateList 1))

										; The two gates better be at least 200 light-seconds
										; away from each other
										(if (ls (objGetDistance gStart gEnd) 200)
											(setq gStart Nil)
											)
										)
									)

								; Set text
								(switch
									; If we have no target, then no mission
									(not gStart)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"A large Ares convoy will enter the system at " (objGetName gStart 0) ". Take a flight of Centurions and destroy as many freighters as you can before they leave the system. Any questions?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (variant)
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scCenturion;)

								; Choose mission variant
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq variant 'chasmEscort)

									(leq roll 90)
										(setq variant 'advancedPolar)

									(setq variant 'deimosEscort)
									)

								(objSetData gSource "MissionVariant" variant)

								; Remember the start and end point
								(objSetObjRefData gSource "StartGate" gStart)
								(objSetObjRefData gSource "EndGate" gEnd)

								; Init counters
								(objSetData gSource "FreightersEscaped" 0)
								(objSetData gSource "TargetsDestroyed" 0)
								(objSetData gSource "WingmenDestroyed" 0)

								; Create a timer for the creation of the freighter
								(sysAddObjTimerEvent (multiply (objGetDistance gPlayerShip gStart) 1) gSource "OnTimerConvoyAppears4B")

								; point the player to the stargate
								(shpCancelOrders gPlayerShip)
								(shpOrderDock gPlayerShip gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft shipsLeftText)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))
								(setq shipsLeftText (item (list 'zero 'one 'two 'three 'four 'five 'six) shipsLeft))

								; Set description
								(switch
									(leq shipsLeft 2)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(leq shipsLeft 4)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only " shipsLeftText " of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeftText " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" (multiply (objGetData gSource "TargetsDestroyed") 100))
								(objIncData gPlayerShip "fleetXP" (multiply shipsLeft 50))
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								(switch
									(eq (objGetData gSource "WingmenDestroyed") 6)
										(scrSetDesc gScreen "\"What kind of a leader loses all %his% wingmen and dares to return alive! Next time do us all a favor and kill yourself!\"")

									(gr (objGetData gSource "WingmenDestroyed") (objGetData gSource "TargetsDestroyed"))
										(scrSetDesc gScreen "\"You lost more wingmen against those freighters than most people do against an Ares dreadnought! Your leadership skills are pathetic. Get out of my sight!\"")

									(eq (objGetData gSource "TargetsDestroyed") 0)
										(scrSetDesc gScreen "\"You didn't even destroy a single freighter! That wing of Centurions is wasted on you!\"")

									(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
									)
								)
							)
						)
					)
			</Missions4>

			<Missions5>
				(
					; Destroy Target
					("mission5a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								(switch
									; Otherwise, OK
									(cat "\"Your orders are to lead a flight of Britannias and intercept and destroy an unknown hostile. We'll enter the coordinates to your computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (targetPos roll)
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scBritannia;)

								; Pick a random location for the target
								(setq targetPos (sysVectorRandom gSource (random 300 600) 250))

								; Create targets
								(setq roll (random 1 100))
								(switch
									; Target is Phobos dreadnought
									(leq roll 60)
										(block (theShip)
											(setq theShip (sysCreateShip &scPhobos; targetPos &svAres;))
											(shpOrder theShip 'waitForTarget gPlayerShip)
											(shpOrder theShip 'attack gPlayerShip)
											(shpOrder theShip 'attack gSource)

											(objSetObjRefData gSource "Target1" theShip)
											(objRegisterForEvents gSource theShip)

											(objSetData gSource "TargetCount" 1)
											)

									; Target is wing of Sandstorms
									(leq roll 90)
										(block (shipCount theLeader)
											(setq shipCount 35)
											(objSetData gSource "TargetCount" shipCount)

											(for i 1 shipCount
												(block (theShip)
													(setq theShip 
														(sysCreateShip &scSandstorm;
															(sysVectorPolarOffset
																targetPos
																(random 0 359)
																(add (random 1 12) (random 0 12))
																)
															&svAres;
															)
														)
														
													(if (not theLeader)
														(block Nil
															(shpOrder theShip 'waitForTarget gPlayerShip)
															(shpOrder theShip 'attack gPlayerShip)
															(shpOrder theShip 'attack gSource)
															(setq theLeader theShip)
															)
														(shpOrder theShip 'escort theLeader)
														)

													(objSetObjRefData gSource (cat "Target" i) theShip)
													(objRegisterForEvents gSource theShip)
													)
												)
											)

									; Target is flight of Deimos destroyers
									(block (shipCount theLeader)
										(setq shipCount 3)
										(objSetData gSource "TargetCount" shipCount)

										(for i 1 shipCount
											(block (theShip)
												(setq theShip 
													(sysCreateShip &scDeimos;
														(sysVectorPolarOffset
															targetPos
															(random 0 359)
															(add (random 1 12) (random 0 12))
															)
														&svAres;
														)
													)
													
												(if (not theLeader)
													(block Nil
														(shpOrder theShip 'waitForTarget gPlayerShip)
														(shpOrder theShip 'attack gPlayerShip)
														(shpOrder theShip 'attack gSource)
														(setq theLeader theShip)
														)
													(shpOrder theShip 'escort theLeader)
													)

												(objSetObjRefData gSource (cat "Target" i) theShip)
												(objRegisterForEvents gSource theShip)
												)
											)
										)
									)

								(objSetData gSource "TargetsDestroyed" 0)

								; Point player at target
								(shpCancelOrders gPlayerShip)
								(shpOrder gPlayerShip 'attack (objGetObjRefData gSource "Target1"))
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft shipsLeftText)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))
								(setq shipsLeftText (item (list 'zero 'one 'two 'three 'four 'five 'six) shipsLeft))

								; Set description
								(switch
									(leq shipsLeft 2)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(leq shipsLeft 4)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only " shipsLeftText " of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeftText " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 1000)
								(objIncData gPlayerShip "fleetXP" (multiply shipsLeft 100))
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions5>
		</StaticData>

		<Events>
			<OnAttackedByPlayer>
				(block Nil
					(if (not (eq (shpGetOrder gSource) 'attackHold))
						(shpOrderImmediate gSource 'attackHold gPlayerShip 10)
						)
					)
			</OnAttackedByPlayer>
			
			<OnCreate>
				(block (enemyObj)
					; Are we in a good spot? If not, then we give orders to move
					(fltOrderCheckPosition gSource)
					;start reinforcements event-- I can't use construction and constructionrate if the station is a ship
					(sysAddObjRecurringTimerEvent 1500 gSource "Reinforcements")
					;set created-- NOTE You have to Set the Data before changing[inc/dec] it.
					(objSetData gSource "Created" 0)
					;test
					(objFireEvent gSource "Reinforcements")
					)
			</OnCreate>
			
			<Reinforcements>
				;created
		;shipOrders
		;extra block
		;objSetData
			(block (roll Created)
					(setq roll (random 0 3))
					(setq Created (objGetData gSource "Created"))
					;plyMessage gPlayer "What is "Created"?"
					;plyMessage gPlayer "Construction"					
					;use Pos for Aquila, and gSource for gunships!
					(switch
						;check to see if we have max # of ships already
						(leq Created 12)					
						(block (pos)
							;(setq pos (sysFindObject nil "GN"))
							;filter out Huaramarca
								(setq pos 
									(random 
										(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
										)
									)
								(if 
									pos
									;true=don't do anything
									Nil
									;false= choose random gate, record it in logs
									(block Nil
										(setq pos (random (sysFindObject nil "G")))
										(PrintTo 'log "Pos didn't work!")
										)
									)
							(switch
								(eq roll 0)
									(block (Reinf)
										(setq Reinf (sysCreateShip &scAquilaCruiser; pos (objGetSovereign gSource)))
										(shpOrder Reinf 'patrol gSource 75)
										(objIncData gSource "Created")
										(objRegisterForEvents gSource Reinf)
										)
								(eq roll 1)
									(block (Reinf)
										(setq Reinf (sysCreateShip &scDSAquilaCruiser; pos (objGetSovereign gSource)))
										(shpOrder Reinf 'patrol gSource 150)
										(objIncData gSource "Created")
										(objRegisterForEvents gSource Reinf)
										)
								(eq roll 2)
									(block (Reinf)
										(setq Reinf (sysCreateShip &scDSAquilaCruiser; pos (objGetSovereign gSource)))
										(shpOrder Reinf 'wander)
										(objIncData gSource "Created")
										(objRegisterForEvents gSource Reinf)
										)
								(eq roll 3)
								;either mining or sending an attack fleet here!
									(block (Reinf)
										(setq Reinf (sysCreateShip &scDSAquilaCruiser; pos (objGetSovereign gSource)))
										(shpOrder Reinf 'wander)
										(objIncData gSource "Created")
										(objRegisterForEvents gSource Reinf)
										)
								<!--
									(block (Reinf)
										(setq Reinf (sysCreateShip &scBorer; gSource (objGetSovereign gSource)))
										(shpOrderMine Reinf gSource)
										(objIncData gSource "Created")
										(objRegisterForEvents gSource Reinf)
										)
									-->
								)
							)
						)
					)
				
					;DSAquila- patrol 75
					;DSAquila- patrol 150
					;DSAquila - mine
					;borer
			</Reinforcements>
			<OnDestroy>
				(block Nil
					(intCommonwealthOnDestroy)

					; Military will execute the player

					(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
						(intFleetCrime 3 (cat "the destruction of " (objGetName gSource 4)))
						)

					; If we're in the middle of the delivery mission, then put the player's
					; stuff on the ship

					(if (and (eq (objGetData gSource "MissionStatus") "inprogress")
							(eq (objGetData gSource "MissionID") "mission1b")
							)
						(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
							(objAddItem gSource thisItem)
							)
						)
						
					; have some escape pods escape
					(block Nil					
						(setq store (random 5 30))
						(for i 0 store
							(block (Escape)
								(setq Escape (sysCreateShip &scCWEarthzone; aWreckObj (objGetSovereign gSource)))
								(shpOrder Escape 'gate)							
								)
							)
						; if the player is close enough, they hear radio chatter
						(if 
							(leq (objGetDistance gPlayerShip aWreckObj) 150)
							(block (warning)
								(setq warning (random 0 5))
								(switch
									(eq warning 0)
										(plyMessage gPlayer "Mayday! Mayday! Mayday!")
									(eq warning 1)
										(plyMessage gPlayer "Don't shoot! We are unarmed!")
									(eq warning 2)
										(plyMessage gPlayer "CSC down! I repeat, CSC down!")
									(eq warning 3)
										(plyMessage gPlayer "Don't shoot! We are leaving the battlefield.")
									(eq warning 4)
										(plyMessage gPlayer "SOS! SOS!")
									(eq warning 5)
										(plyMessage gPlayer "Warning to all civilians in the area! Evacuate immediately!")
									)
								)
							)
						)
					;send another CSCHQ to replace
					(objFireEvent gSource "RespawnCSC")
					)
					
			</OnDestroy>
			<RespawnCSC>
				(block (theCSCShipThingy marker)
					(setq theCSCShipThingy (sysCreateShip &scCSCHQ; (sysVectorPolarOffset (sysFindObject nil "GN") (random 0 360) (random 16 20)) &svCommonwealthFleet;))
					;(setq marker (sysCreateMarker "Artemis" (sysFindObject nil "GN")  &svCommonwealth;))
					(setq marker (sysCreateMarker "Artemis" (ObjGetPos aWreckObj)  &svCommonwealth;))
					(shpOrder theCSCShipThingy 'goto marker)
					)
			</RespawnCSC>
			<OnObjDestroyed>
			(block Nil
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							; If the player was destroyed, stop the mission
							(eq aObjDestroyed gPlayerShip)
								(block Nil
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)

									; Disperse wingmen
									(intFleetDisperseWingmen gSource 10)
									)
									
							(and (eq missionID "mission1a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDestroyed)
									(shpCancelOrders gPlayerShip)
									)
									
							(eq missionID "mission1d")
								(block (targetSet)
									(for i 0 (subtract (objGetData gSource "TargetCount") 1)
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(objIncData gSource "TargetsLeft" -1)
											(if (and (not targetSet) (objGetObjRefData gSource (cat "Target" i)))
												(block Nil
													(shpCancelOrders gPlayerShip)
													(shpOrderAttack gPlayerShip (objGetObjRefData gSource (cat "Target" i)))
													(objSetIdentified (objGetObjRefData gSource (cat "Target" i)))
													(setq targetSet True)
													)
												)
											)
										)

									(if (eq (objGetData gSource "TargetsLeft") 0)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											(sysCancelTimerEvent gSource "OnAresPatrolCheck")
											)
										(if (eq (objGetData gSource "TargetsLeft") 1)
											(plyMessage gPlayer "1 target left!")
											(plyMessage gPlayer (objGetData gSource "TargetsLeft") " targets left")
											)
										)
									)

							(and (eq missionID "mission2a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission2b") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(if (and 
										(eq (objGetData gSource "MissionVariant") 'suicideRun)
										(objGetData aObjDestroyed "Armed")
										)
									(block Nil
										(sysCreateWeaponFire &itM5Missile; Nil (objGetPos aObjDestroyed) 0 0 gSource True)
										(plyMessage gPlayer "Mission complete!")
										(objSetData gSource "MissionStatus" "success")
										(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
										(shpCancelOrders gPlayerShip)
										)
									(block Nil
										(plyMessage gPlayer "Mission failed")
										(objSetData gSource "MissionStatus" "failure")
										(typIncGlobalData &scCSCTaskForce; "missionsFailed")
										(shpCancelOrders gPlayerShip)
										)
									)

							(and (eq missionID "mission3rescue") (eq aObjDestroyed (objGetObjRefData gSource "Ship")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission3a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)
									)

							(eq missionID "mission3b")
								(block (shipClass)
									(setq shipClass (objGetType aObjDestroyed))
									(switch
										(eq shipClass &scScarabFreighter;)
											(objIncData gSource "SuperfreightersDestroyed")

										(eq shipClass &scEI100;)
											(objIncData gSource "FreightersDestroyed")
										)

									; Tell the player

									(plyMessage gPlayer (objGetName aObjDestroyed 1) " destroyed")

									; If more than 1 superfreighter has been destroyed or if
									; more than 4 freighters have been destroyed, then the player cannot win

									(if (or (gr (objGetData gSource "SuperfreightersDestroyed") 1)
											(gr (objGetData gSource "FreightersDestroyed") 4)
											)
										(block Nil
											(plyMessage gPlayer "Mission failed")
											(objSetData gSource "MissionStatus" "failure")
											(typIncGlobalData &scCSCTaskForce; "missionsFailed")
											(shpCancelOrders gPlayerShip)
											)
										)
									)

							(and (eq missionID "mission4a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(shpCancelOrders gPlayerShip)
									)

							(eq missionID "mission4b")
								(block Nil
									(for i 0 4
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(block (escaped destroyed lost)
												(setq escaped (objGetData gSource "FreightersEscaped"))
												(setq destroyed (add (objGetData gSource "TargetsDestroyed") 1))
												(objSetData gSource "TargetsDestroyed" destroyed)
												(setq lost (objGetData gSource "WingmenDestroyed"))

												(if (eq (add escaped destroyed) 5)
													(block Nil
														(if	(or (eq destroyed 0) (gr lost destroyed))
															(block Nil
																(plyMessage gPlayer "Mission failed")
																(objSetData gSource "MissionStatus" "failure")
																(typIncGlobalData &scCSCTaskForce; "missionsFailed")
																)
															(block Nil
																(plyMessage gPlayer "Mission complete!")
																(objSetData gSource "MissionStatus" "success")
																(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
																)
															)

														(objUnregisterForEvents gSource gPlayerShip)
														(shpCancelOrders gPlayerShip)
														)
													)
												)
											)
										)

									(for i 0 5
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Wingman" i)))
											(objIncData gSource "WingmenDestroyed")
											)
										)
									)

							(eq missionID "mission5a")
								(block Nil
									(for i 1 (objGetData gSource "TargetCount")
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(block Nil
												(objIncData gSource "TargetsDestroyed")
												(objSetObjRefData gSource (cat "Target" i) Nil)

												; If we destroyed all targets, then we're done. Otherwise
												; we point the player at a new target

												(if (eq (objGetData gSource "TargetCount") (objGetData gSource "TargetsDestroyed"))
													(block Nil
														(plyMessage gPlayer "Mission complete!")
														(objSetData gSource "MissionStatus" "success")
														(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
														)
													(block (foundTarget)
														(for i 1 (objGetData gSource "TargetCount")
															(block (theTarget)
																(setq theTarget (objGetObjRefData gSource (cat "Target" i)))
																(if (and theTarget (not foundTarget))
																	(block Nil
																		(shpCancelOrders gPlayerShip)
																		(shpOrder gPlayerShip 'attack theTarget)
																		(setq foundTarget True)
																		)
																	)
																)
															)
														)
													)
												)
											)
										)
									)
							)
						)

					; Even if mission is no longer in progress we track wingmen
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(eq missionID "mission4b")
								(for i 0 5
									(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Wingman" i)))
										(objIncData gSource "WingmenDestroyed")
										)
									)
							)
						)
					)
				(block (reinfrenchments)
					(setq reinfrenchments (objGetData gSource "Created"))
					(objSetData gSource "Created" (subtract reinfrenchments 1))
					;plyMessage gPlayer "Is "Created" decreased?"
					)
					)
			</OnObjDestroyed>

			<OnObjDocked>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(and (eq missionID "mission1c") (eq aObjDocked gPlayerShip) (eq aDockTarget gSource))
								(if (objGetItems gPlayerShip "* +LamplighterDataROM;")
									(block Nil
										(objRemoveItem gPlayerShip (itmCreate &itLamplighterDataROM; 1))
										(objSetData gSource "MissionStatus" "success")
										(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
										(shpCancelOrders gPlayerShip)
										)
									)

							(and (eq missionID "mission2a") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission2b") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission3rescue") (eq aObjDocked (objGetObjRefData gSource "Ship")))
								(switch
									; Docked with base
									(eq aDockTarget (objGetObjRefData gSource "Target"))
										(block Nil
											(plyMessage gPlayer "Extraction commencing")

											; Add some encounters
											(sysAddEncounterEventAtDist (add 500 (random 0 100)) aObjDocked &etRogueAmbush2; (random 120 200))
											(sysAddEncounterEventAtDist (add 1000 (random 0 100)) aObjDocked &etRogueAmbush1; (random 120 200))
											)

									; Docked back with the carrier
									(eq aDockTarget gSource)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											(objUnregisterForEvents gSource aObjDocked)
											(shpCancelOrders gPlayerShip)
											)
									)

							(and (eq missionID "mission3a") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)
							)
						)
					)
			</OnObjDocked>

			<OnObjEnteredGate>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(eq missionID "mission1d")
								(block Nil
									(for i 0 (subtract (objGetData gSource "TargetCount") 1)
										(if (eq aObj (objGetObjRefData gSource (cat "Target" i)))
											(block Nil
												(plyMessage gPlayer "Mission failed")
												(objSetData gSource "MissionStatus" "failure")
												(typIncGlobalData &scCSCTaskForce; "missionsFailed")
												(sysCancelTimerEvent gSource "OnAresPatrolCheck")
												)
											)
										)
									)

							(eq missionID "mission3b")
								(block (shipClass)
									(setq shipClass (objGetType aObj))
									(switch
										(eq shipClass &scScarabFreighter;)
											(objIncData gSource "SuperfreightersEscaped")

										(eq shipClass &scEI100;)
											(objIncData gSource "FreightersEscaped")
										)

									; Unregister so that we don't get called again at OnObjDestroyed
									(if (not (eq aObj gPlayerShip))
										(objUnregisterForEvents gSource aObj)
										)

									; If all ships are accounted for, then the mission is
									; successful.

									(if (eq (add
												(add (objGetData gSource "SuperfreightersDestroyed") 
													(objGetData gSource "FreightersDestroyed"))
												(add (objGetData gSource "SuperfreightersEscaped")
													(objGetData gSource "FreightersEscaped"))
												)
											11)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											(objUnregisterForEvents gSource gPlayerShip)
											(shpCancelOrders gPlayerShip)
											)
										)
									)

							(eq missionID "mission4b")
								(for i 0 4
									(if (eq aObj (objGetObjRefData gSource (cat "Target" i)))
										(block (escaped destroyed lost)
											(setq escaped (add (objGetData gSource "FreightersEscaped") 1))
											(objSetData gSource "FreightersEscaped" escaped)
											(setq destroyed (objGetData gSource "TargetsDestroyed"))
											(setq lost (objGetData gSource "WingmenDestroyed"))

											(objSetObjRefData gSource (cat "Target" i) Nil)
											(objUnregisterForEvents gSource aObj)

											(if (eq (add escaped destroyed) 5)
												(block Nil
													(if	(or (eq destroyed 0) (gr lost destroyed))
														(block Nil
															(plyMessage gPlayer "Mission failed")
															(objSetData gSource "MissionStatus" "failure")
															(typIncGlobalData &scCSCTaskForce; "missionsFailed")
															)
														(block Nil
															(plyMessage gPlayer "Mission complete!")
															(objSetData gSource "MissionStatus" "success")
															(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
															)
														)

													(objUnregisterForEvents gSource gPlayerShip)
													(shpCancelOrders gPlayerShip)
													)
												)
											)
										)
									)
							)
						)
					)
			</OnObjEnteredGate>

			<OnObjReconned>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(and (eq missionID "mission1a") (eq aObj (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Recon completed")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObj)
									(shpCancelOrders gPlayerShip)
									)
							)
						)
					)
			</OnObjReconned>
			
			<OnOrdersCompleted>
				(block (behavior)
					(setq behavior (objGetData gSource "behavior"))
					(switch
						(eq behavior 'moving)
							(block Nil
								(shpOrder gSource 'hold)
								(objSetData gSource "behavior" Nil)
								)

						(block Nil
							(shpOrder gSource 'hold)
							(objSetData gSource "behavior" Nil)
							)
						)
					)
			</OnOrdersCompleted>

			<OnAresPatrolCheck>
				(block (inScanRange)
					; Are Ares ships in scan range?
					(for i 0 (subtract (objGetData gSource "TargetCount") 1)
						(if (objGetObjRefData gSource (cat "Target" i))
							(if (leq (objGetDistance (objGetObjRefData gSource (cat "Target" i)) gSource) 12)
								(setq inScanRange True)
								)
							)
						)

					; Recall the ships
					(if inScanRange
						(block Nil
							(for i 0 (subtract (objGetData gSource "TargetCount") 1)
								(block (ship)
									(setq ship (objGetObjRefData gSource (cat "Target" i)))
									(if ship
										(block Nil
											(shpCancelOrders ship)
											(shpOrderGate ship)
											)
										)
									)
								)

							(sysCancelTimerEvent gSource "OnAresPatrolCheck")
							)
						)
					)
			</OnAresPatrolCheck>

			<OnSuicideRunCheck2B>
				(block (freighter dist)
					(setq freighter (objGetObjRefData gSource "Target"))
					(if freighter
						(setq dist (objGetDistance gSource freighter))
						)

					(switch
						(not freighter)
							(block Nil
								(sysCancelTimerEvent gSource "OnSuicideRunCheck2B")
								)

						(ls dist 3)
							(block (pos)
								(sysCancelTimerEvent gSource "OnSuicideRunCheck2B")

								; Mission failed
								(plyMessage gPlayer "Mission failed")
								(objSetData gSource "MissionStatus" "failure")
								(typIncGlobalData &scCSCTaskForce; "missionsFailed")
								(shpCancelOrders gPlayerShip)

								(setq pos (objGetPos freighter))
								(objDestroy freighter)
								(sysCreateWeaponFire &itM5Missile; Nil pos 0 0 gSource True)
								)

						(and (ls dist 15) (objGetData freighter "Armed"))
							(if (leq (random 1 100) 25)
								(objSendMessage 
									gPlayerShip
									gSource
									(random
										(list
											"Destroy the freighter!"
											"Blast the bloody freighter!"
											"Do you copy? Destroy the freighter now!"
											(plyComposeString gPlayer "%name%, destroy the freighter!")
											"The freighter is on a suicide run! Destroy it!"
											)
										)
									)
								)

						(and (ls dist 25) (not (objGetData freighter "Armed")))
							(block Nil
								; Freighter is on sucide run
								(objSetSovereign freighter &svRogueFleet;)
								(shpCancelOrders freighter)
								(shpOrderGoto freighter gSource)
								(shpOrderHold freighter)
								(objSetData freighter "Armed" True)

								; Set the CSC to wait (so that it doesn't blast the freighter on its own)
								; we assume that the CSC is caught by surprise
								(shpCancelOrders gSource)
								(shpOrderWait gSource 15)
								(shpOrderHold gSource)

								; Player should destroy freighter
								(objSendMessage gPlayerShip gSource "Freighter on suicide run!")
								(objSendMessage gPlayerShip gSource "Destroy the freighter!")
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip freighter)
								(objSetIdentified freighter)
								)
						)
					)
			</OnSuicideRunCheck2B>

			<OnTimerConvoyAppears3A>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (ship)
						(plyMessage gPlayer "Transport has arrived")

						; create the transport that will go back to the carrier
						(setq ship (sysCreateShip &scAurochs; (objGetObjRefData gSource "Target") &svCommonwealthFleet;))
						(shpOrderDock ship gSource)
						(shpOrderGate ship)

						; Remember this ship
						(objSetObjRefData gSource "Target" ship)

						; Add an encounter half-way
						(if (leq (random 1 100) 90)
							(sysAddEncounterEventAtDist 
								(random 500 1000)
								(if (eq (random 1 3) 1) gPlayerShip ship)
								(random
									(list
										&etAresAmbush1;
										&etAresAmbush2;
										&etAresAmbush2;
										&etRogueAmbush1;
										&etRogueAmbush1;
										&etRogueAmbush2;
										)
									)
								(random 120 200)
								)
							)

						; register so we know when the transport is destroyed
						(objRegisterForEvents gSource ship)

						; Point the player to the transport
						(shpCancelOrders gPlayerShip)
						(shpOrderEscort gPlayerShip ship)
						(objSetIdentified ship)
						)
					)
			</OnTimerConvoyAppears3A>

			<OnTimerConvoyAppears3B>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (freightersLeft dist totalTime timePortion)
						(plyMessage gPlayer "Convoy has arrived")

						; A superfreighter takes 8 ticks to move 1 light-second.

						(setq dist (objGetDistance (objGetObjRefData gSource "StartGate") (objGetObjRefData gSource "EndGate")))
						(setq totalTime (multiply dist 8))
						(setq timePortion (divide totalTime 12))

						; Create all the ships

						(setq freightersLeft 8)
						(for i 0 2
							(block (ship)
								(setq ship (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(shpOrderGate ship (objGetObjRefData gSource "EndGate"))
								(objSetData ship "noPiracyCheck" True)
								(objRegisterForEvents gSource ship)

								(if (eq i 0)
									(block Nil
										(shpOrderEscort gPlayerShip ship)
										(objSetIdentified ship)
										)
									)

								(for j 0 2
									(if (gr freightersLeft 0)
										(block Nil
											(setq escort (sysCreateShip &scEI100; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
											(objSetData escort "noPiracyCheck" True)
											(shpOrderFollow escort ship)
											(objRegisterForEvents gSource escort)

											(setq freightersLeft (subtract freightersLeft 1))
											)
										)
									)

								; On timer, enemies attack ship
								(sysAddEncounterEventAtDist 
									(multiply timePortion (add (multiply i 4) (random 1 3)))
									(if (eq (random 1 3) 1) gPlayerShip ship)
									&etAresAmbush1; 
									(random 120 200)
									)
								)
							)

						; Keep track of how many ship were destroyed and how many escaped
						(objSetData gSource "SuperfreightersEscaped" 0)
						(objSetData gSource "FreightersEscaped" 0)
						(objSetData gSource "SuperfreightersDestroyed" 0)
						(objSetData gSource "FreightersDestroyed" 0)
						)
					)
			</OnTimerConvoyAppears3B>

			<OnTimerConvoyAppears4B>
				(block (variant startGate endGate)
					(setq variant (objGetData gSource "MissionVariant"))
					(setq startGate (objGetObjRefData gSource "StartGate"))
					(setq endGate (objGetObjRefData gSource "EndGate"))

					(switch
						(eq variant 'chasmEscort)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(setq escort (sysCreateShip &scChasm; startGate &svAres;))
										(shpOrderEscort escort freighter)
										)
									)
								)

						(eq variant 'advancedPolar)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar2; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(setq escort (sysCreateShip &scSandstorm; startGate &svAres;))
										(shpOrderEscort escort freighter)

										(setq escort (sysCreateShip &scSandstorm; startGate &svAres;))
										(shpOrderEscort escort freighter)
										)
									)
								)

						(eq variant 'deimosEscort)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(if (or (eq i 0) (eq i 2))
											(block Nil
												(setq escort (sysCreateShip &scDeimos; startGate &svAres;))
												(shpOrderEscort escort freighter)
												)
											)
										)
									)
								)
						)

					; Point the player at the lead freighter
					(shpCancelOrders gPlayerShip)
					(shpOrderAttack gPlayerShip (objGetObjRefData gSource "Target0"))
					(objSetIdentified (objGetObjRefData gSource "Target0"))
					)
			</OnTimerConvoyAppears4B>

			<OnTimerFreighterAppears2B>
				(block (variant)
					(setq variant (objGetData gSource "MissionVariant"))
					(switch
						(eq variant 'aresAttack)
							(block (freighter)
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)
								(shpOrderWait freighter (random 6 18))
								(shpOrderGate freighter)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Create an encounter after a certain period of time
								(sysAddEncounterEventAtDist 
									(random 1000 1500) 
									freighter 
									&etAresAmbush4; 
									(random 120 200)
									)

								(if (leq (random 1 100) 90)
									(sysAddEncounterEventAtDist 
										(random 1000 1500) 
										gPlayerShip 
										&etAresAmbush2; 
										(random 120 200)
										)
									)

								(if (leq (random 1 100) 20)
									(sysAddEncounterEventAtDist 
										(random 1350 1900) 
										freighter 
										&etAresAmbush2; 
										(random 120 200)
										)
									)

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)

						(eq variant 'rogueAmbush)
							(block (freighter ambushPos mineLayer waitPos pathPos)
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)
								(shpOrderWait freighter (random 6 18))
								(shpOrderGate freighter)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Figure out where the ambush point is
								(setq pathPos (random 35 65))
								(setq ambushPos (sysGetNavPathPoint
									&svCommonwealth;
									(objGetObjRefData gSource "StartGate")
									gSource
									pathPos
									))

								; Create a rogue transport that will lay mines in the path
								(setq mineLayer (sysCreateShip &scRogueMineLayer; ambushPos &svRogueFleet;))
								(objSetData mineLayer "MinePos" ambushPos)

								; Create a bunch of mines in addition
								(for i 0 (random 10 20)
									(sysCreateWeaponFire &itStaticMine; mineLayer (sysVectorPolarOffset ambushPos (random 0 359) (random 1 5)) 0 0 Nil)
									)

								; Figure out where the centurions will wait
								(setq waitPos (sysGetNavPathPoint
									&svCommonwealth;
									(objGetObjRefData gSource "StartGate")
									gSource
									(add pathPos 15)
									))
								(setq waitPos (sysCreateMarker "" waitPos &svRogueFleet;))

								; Create some centurions that will attack once the freighter
								; goes through the mines
								(for i 0 (random 2 4)
									(block (theShip thePos)
										(setq thePos (sysVectorPolarOffset waitPos (random 0 359) (random 10 14)))
										(setq theShip (sysCreateShip &scCenturion; thePos &svRogueFleet;))
										(shpOrderPatrol theShip waitPos 7)
										)
									)

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)

						(eq variant 'suicideRun)
							(block Nil
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Create a recurring timer that will turn the freighter into a suicide bomber
								(sysAddObjRecurringTimerEvent 31 gSource "OnSuicideRunCheck2B")

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)
						)
					)
			</OnTimerFreighterAppears2B>
		</Events>

		<DockScreens>
			<Main>
				<InitialPane>
					(block (missionID missionStatus)
						(setq missionID (objGetData gSource "MissionID"))
						(setq missionStatus (objGetData gSource "MissionStatus"))
						
						; If we're in the middle of the fleetDelivery mission and we can't
						; dock with the target, then we fail
						(if (and (eq missionID 'mission1b)
								(eq missionStatus 'inprogress)
								(objIsAngryAt (objGetObjRefData gSource "Target") gPlayerShip))
							(block Nil
								(setq missionStatus "failure")
								(objSetData gSource "MissionStatus" missionStatus)
								(typIncGlobalData &scCSCTaskForce; "missionsFailed")
								(shpCancelOrders gPlayerShip)
								)
							)
						
						(switch
							(eq missionStatus "inprogress")
								"MissionInProgress"

							(eq missionStatus "failure")
								"MissionFailure"

							(eq missionStatus "success")
								"MissionSuccess"

							"Default"
							)
						)
				</InitialPane>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "You are in the docking bay of the " (objGetName gSource) "."))
						</OnPaneInit>

						<Actions>
							<Action name="Bridge" key="B">
								<Navigate screen="Bridge"/>
							</Action>

							<Action name="Flight Deck" key="F">
								<Navigate screen="FlightDeck"/>
							</Action>

							<Action name="Dock Services" key="D">
								(block Nil
									(setq gPrevScreen2 "Main")
									(scrShowScreen gScreen "&dsFleetDockServices;")
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<MissionFailure>
						<OnPaneInit>
							(block (success failure)
								; Get the mission
								(setq gMission (objGetData gSource "Mission"))

								; Execute the post-mission code (which must set the description).
								(apply (eval (item gMission 4)) Nil)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block (success failure)
									(objSetData gSource "MissionStatus" Nil)

									(setq success (objGetData gPlayerShip "fleetTFSuccess"))
									(setq failure (add (objGetData gPlayerShip "fleetTFFailure") 1))
									(objSetData gPlayerShip "fleetTFFailure" failure)

									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</MissionFailure>

					<MissionInProgress
							desc="&quot;What is your major malfunction!? Get back out there and complete your mission!&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<Exit/>
							</Action>
						</Actions>
					</MissionInProgress>

					<MissionSuccess>

						<OnPaneInit>
							(block (success failure)
								; Get the mission
								(setq gMission (objGetData gSource "Mission"))

								; Execute the post-mission code (which must set the description).
								(apply (eval (item gMission 3)) Nil)

								; Update mission success/failures
								(setq success (add (objGetData gPlayerShip "fleetTFSuccess") 1))
								(setq failure (objGetData gPlayerShip "fleetTFFailure"))
								(objSetData gPlayerShip "fleetTFSuccess" success)

								; Done with mission
								(objSetData gSource "MissionStatus" Nil)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block Nil
									; If see if we got promoted
									(if (intFleetPromotion)
										(block Nil
											(setq gPrevScreen "Main")
											(setq gPrevPane "Default")
											(setq gName Nil)
											(scrShowScreen gScreen "&dsFleetPromotion;")
											)
										(scrShowPane gScreen "Default")
										)
									)
							</Action>
						</Actions>
					</MissionSuccess>

				</Panes>

			</Main>

			<Bridge
				name=			"Bridge"
				>

				<Panes>
					<Default>
						<OnPaneInit>
							(switch
								(eq (objGetData gSource "CSC") "america")
									(scrSetDesc gScreen "You talk to the captain of the CSC America. \"The Ares have been ruthless. When we lost the CSC Europa, the damn Martians deliberately targeted the emergency capsules. We taught them a lesson after that, though: we torched several of their communes.\"")

								(eq (objGetData gSource "CSC") "india")
									(scrSetDesc gScreen "You talk to the captain of the CSC India. \"If you ever get back to the Commonwealth, you've got to tell them to send more ships. We're getting killed out here and I don't even know if anyone back home cares.\"")

								(eq (objGetData gSource "CSC") "atlantica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Atlantica. \"This war has been tough on the troops. We've had to start scavenging for vital supplies. I'm not surprised that the discipline in some units has deteriorated.\"")

								(eq (objGetData gSource "CSC") "asia")
									(scrSetDesc gScreen "You talk to the captain of the CSC Asia. \"When the Antarctica went rogue, Admiral Decker just about pissed acid. He was furious! He took it as a personal betrayal.\"")

								(eq (objGetData gSource "CSC") "pacifica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Pacifica. \"You ever meet a Martian? Not the meek little Syrtians&#x97;I mean the Ares clones. They all have this smug look of superiority that cranks me up. They look better in the crosshairs of TeV 9, that's for sure!\"")

								(scrSetDesc gScreen "The captain welcomes you aboard.")
								)
						</OnPaneInit>

						<Actions>
							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Bridge>

			<FlightDeck
				name=			"Flight Deck"
				>

				<Panes>
					<Default>
						<OnPaneInit>
							(block (behavior)
								(setq behavior (objGetData gSource "behavior"))
								(setq gLevel (objGetData gPlayerShip "fleetLevel"))
								
								(switch
									(eq behavior 'moving)
										(scrSetDesc gScreen
											"You are on the flight deck of " (objGetName gSource 0x04) ". "
											"The ship is on maneuvers and the XO is giving orders to the navigator and the sensor chief."
											)
											
									(eq gLevel 1)
										(scrSetDesc gScreen
											"The flight deck of " (objGetName gSource 0x04) 
											" hums with the activity of men and women working at terminals and holocharts. "
											"The XO is giving orders to a squadron out on a mission."
											)

									(scrSetDesc gScreen
										"You are on the flight deck of " (objGetName gSource 0x04) ". "
										"Men and women work at terminals planning missions and communicating with squadrons on patrol. "
										"The XO is near a holochart, listening to a report."
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Talk to Executive Officer" key="X">
								(block (behavior)
									(setq behavior (objGetData gSource "behavior"))
									(switch
										(eq behavior 'moving)
											(scrShowPane gScreen "ShipMoving")
										
										(block Nil
											(setq gPrevScreen "FlightDeck")
											(setq gPrevPane "Default")
											(setq gMissionTitle "Flight Deck")

											; Get the list of missions for this level. If the player is at level 3
											; and the scientist rescue mission has not been completed, then do that mission;
											; otherwise, do a mission appropriate for the level

											(if (and (geq (objGetData gPlayerShip "fleetLevel") 3)
													(not (typGetGlobalData &scCSCTerra; "p262scientists"))
													)
												(setq gMissionListName "MissionRescueScientists")
												(setq gMissionListName (cat "Missions" (objGetData gPlayerShip "fleetLevel")))
												)

											; Set some other parameters for the mission screen

											(if (gr (objGetData gPlayerShip "fleetTFSuccess") 0)
												(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
												(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
												)
											(setq gMissionAcceptText (plyComposeString gPlayer "\"Good luck, %name%!\""))
											(setq gMissionDeclineText "\"Get the hell out of here then!\"")
											(scrShowScreen gScreen "&dsMission;")
											)
										)
									)
							</Action>

							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
					
					<ShipMoving>
						<OnPaneInit>
							(scrSetDesc gScreen
								"The XO is too busy to talk to you right now. He waves you away while he concentrates on the maneuvers."
								)
						</OnPaneInit>
						
						<Actions>
							<Action name="Leave" default="1" cancel="1" key="L">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</ShipMoving>
				</Panes>
			</FlightDeck>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>

	</ShipClass>

<!-- DySys  Aquila-class Cruiser -->

	<ShipClass UNID="&scDSAquilaCruiser;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Aquila"
			type=				"cruiser"
			score=				"2835"
			dockScreen=			"&dsAbandonedStation;"
			abandonedScreen=	"&dsAbandonedStation;"

			mass=				"10000"
			cargoSpace=			"1000"
			thrust=				"5000"
			maneuver=			"12"
			maxSpeed=			"16"
			
			cyberDefenseLevel=	"8"
			explosionType=		"&vtThermoExplosion2;"
			leavesWreck=		"100"
			
			attributes=			"commonwealth,commonFleet,commonMilitary,genericClass"
			>
			
		<Names noArticle="true">Public Defense Aquila; Outer Realm Emergency Squad; Fleet Cleanup Crew;
			Fleet Patrol Alpha; Fleet Patrol Beta; Fleet Patrol Delta;
			Fleet Patrol Gamma; Fleet Patrol Charlie; Fleet Patrol Epsilon;
			Phoenix Squadron; Red Wing Fighters; Fleet Defense Beta; Support Squad Phi;
			Fleet System Defense; Firefly; SG-1; Galactica;
			Starfighter Base; Prometheus; Bebop; Guren Defense;
			Lancelot Recon; Valvrave; Gurren Lagann; Eva 01;
			Eva 00; Eva 02; The Byron;
			Anacreon Starfrigate; Anacreon Explorer; Anacreon Solar Defense;
			The Sirius Anacreon; Anacreon Colonial Defense; Antimatter Research Squad
		</Names>
		<Armor>
			<ArmorSection start="345" span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="330" span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="315" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="300" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="285" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="270" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="255" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="240" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="225" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="210" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="195" span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="180" span="15" armorID="&itP210HexphaseArmor;" />

			<ArmorSection start="165" span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="150" span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="135" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="120" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="105" span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="90"  span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="75"  span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="60"  span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="45"  span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="30"  span="15" armorID="&itP210HexphaseArmor;" nonCritical="general"/>
			<ArmorSection start="15"  span="15" armorID="&itP210HexphaseArmor;" />
			<ArmorSection start="0"   span="15" armorID="&itP210HexphaseArmor;" />
		</Armor>
		<Escorts>
			<Ship     count="1d6"	class="&scCenturion;"		orders="escort" patrolDist="15"/>
			<Ship 	  count="1d4"	class="&scCenturionX;"		orders="escort" patrolDist="15"/>
			<Ship     count="1d4"	class="&scBritannia;"		orders="escort" patrolDist="15"/>
		</Escorts>
		<Devices>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="355" maxFireArc="175" posAngle="99" posRadius="22"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="160" maxFireArc="5" posAngle="261" posRadius="22"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="355" maxFireArc="175" posAngle="180" posRadius="30"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="160" maxFireArc="5" posAngle="180" posRadius="-30"/>
			<Device deviceID="&itNAMIHeavyLauncher;" omnidirectional="true"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&itR9Deflector;"/>
		</Devices>

		<Image imageID="&rsLargeShips1;" imageX="1728" imageY="0" imageWidth="192" imageHeight="192" imageFrameCount="0" imageTicksPerFrame="0"/>

		<Items>
			<Item count="4d20" item="&itM2Missile;"/>
		</Items>

		<AISettings
			fireRateAdj=		"20"
			fireAccuracy=		"95"
			perception=			"4"
			combatStyle=		"standOff"
			/>
			
		<DockingPorts>
			<Port x="25"	y="45" />
			<Port x="25"	y="25" />
			<Port x="25"	y="-25" />
			<Port x="25"	y="-45" />
			
			<Port x="-25"	y="45" />
			<Port x="-25"	y="25" />
			<Port x="-25"	y="-25" />
			<Port x="-25"	y="-45" />
		</DockingPorts>
			
		<Events>
			<OnCreate>
				(block nil
					;make this undockable:
					(objSetProperty gSource 'dockingEnabled Nil)
					)
			</OnCreate>
			<OnDestroy>
				(block (store Steve)
					(setq store (random 5 15))
					(for i 0 store
						(block (Escape)
							(setq Escape (sysCreateShip &scCWEarthzone; aWreckObj (objGetSovereign gSource)))
							(shpOrder Escape 'gate)	
							)
						)
					; if the player is close enough, they hear radio chatter
					(setq Steve (random 50 150))
					; Steve is the name of the Radio Operator
					; just kidding!
					(if 
						(leq (objGetDistance gPlayerShip aWreckObj) Steve)
						(block (warning)
							(setq warning (random 0 5))
							(switch
								(eq warning 0)
									(plyMessage gPlayer "Mayday! Mayday! Mayday!")
								(eq warning 1)
									(plyMessage gPlayer "Don't shoot! We are unarmed!")
								(eq warning 2)
									(plyMessage gPlayer "Aquila down! I repeat, Aquila down!")
								(eq warning 3)
									(plyMessage gPlayer "Don't shoot! We are leaving the battlefield.")
								(eq warning 4)
									(plyMessage gPlayer "SOS! SOS!")
								(eq warning 5)
									(plyMessage gPlayer "Warning to all civilians in the area! Evacuate immediately!")
								)
							)
						)
					)
			</OnDestroy>
		</Events>
		
	</ShipClass>
	
<!-- CW Escape Earthzone -->

	<ShipClass UNID="&scCWEarthzone;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Earthzone"
			type=				"escape pod"
			score=				"70"

			mass=				"50"
			cargoSpace=			"50"
			thrust=				"120"
			maneuver=			"4"
			maxSpeed=			"20"

			leavesWreck=		"100"

			attributes=			"commonwealth,commonMilitary,genericClass"
			>

		<Armor>
			<ArmorSection start="315" span="90" armorID="&itStealthPlate;" areaSet="0,2" />
			<ArmorSection start="225" span="90" armorID="&itStealthPlate;" areaSet="3,4" />
			<ArmorSection start="135" span="90" armorID="&itStealthPlate;" areaSet="1,6" />
			<ArmorSection start="45"  span="90" armorID="&itStealthPlate;" areaSet="7,13" />
		</Armor>

		<Devices>
			<Device deviceID="&itLaserCannon;"/>
			<Device deviceID="&itClass1Deflector;"/>
		</Devices>

		<Items>
			<Item count="2d6" item="&itHelium3FuelRod;"/>
		</Items>

		<Image imageID="&rsMediumShips1;" imageX="192" imageY="0" imageWidth="48" imageHeight="48" imageFrameCount="0" imageTicksPerFrame="0"/>

		<AISettings
			fireRateAdj=		"40"
			fireRangeAdj=		"50"
			fireAccuracy=		"85"
			perception=			"4"
			/>

	</ShipClass>

	
	<!-- CW Pirate Earthzone -->

	<ShipClass UNID="&scPirateEarthzone;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Earthzone"
			type=				"escape pod"
			score=				"70"

			mass=				"50"
			cargoSpace=			"50"
			thrust=				"120"
			maneuver=			"4"
			maxSpeed=			"20"

			leavesWreck=		"100"

			attributes=			"commonwealth,commonMilitary,genericClass"
			>

		<Armor>
			<ArmorSection start="315" span="90" armorID="&itLightTitaniumPlate;" areaSet="0,2" />
			<ArmorSection start="225" span="90" armorID="&itLightTitaniumPlate;" areaSet="3,4" />
			<ArmorSection start="135" span="90" armorID="&itLightTitaniumPlate;" areaSet="1,6" />
			<ArmorSection start="45"  span="90" armorID="&itLightTitaniumPlate;" areaSet="7,13" />
		</Armor>

		<Devices>
			<Device deviceID="&itLaserCannon;"/>
			<Device deviceID="&itClass1Deflector;"/>
		</Devices>

		<Items>
			<Item count="2d6" item="&itHelium3FuelRod;"/>
		</Items>

		<Image imageID="&rsMediumShips1;" imageX="192" imageY="0" imageWidth="48" imageHeight="48" imageFrameCount="0" imageTicksPerFrame="0"/>

		<AISettings
			fireRateAdj=		"40"
			fireRangeAdj=		"50"
			fireAccuracy=		"85"
			perception=			"4"
			/>
		<Events>
			<PlayerStealing>
				(block Nil
					(if 
						(leq(ObjGetDistance gSource gPlayership) 10)
						(block Nil
							;transfer all items to playership
							(enum (objGetItems gSource "*U -ID;") itemelement (block Nil
								(objAddItem gPlayership itemelement)
								(objRemoveItem gSource itemelement)
								))
							(ObjSuspend gSource)
							)
						)
					)
			</PlayerStealing>
		</Events>
	</ShipClass>
	
	<!-- Aquila Encounter -->

	<StationType UNID="&stAquilaEncounter;"
			name=				"(Aquila)"
			sovereign=			"&svCommonwealthFleet;"
			shipEncounter=		"true"
			scale=				"ship"
			level=				"8"

			attributes=			"fleet,friendly,primary,envAir,envEarth,envFire,envWater"
			levelFrequency=		"----- ruurv ----- ----- -----"
			locationCriteria=	"--planetary"
			>
		<Ships>
			<Ship	count="1"	class="&scDSAquilaCruiser;" orders="scavenge">
				<Names noArticle="true">Public Defense Aquila; Outer Realm Emergency Squad; Fleet Cleanup Crew;
					Fleet Patrol Alpha; Fleet Patrol Beta; Fleet Patrol Delta;
					Fleet Patrol Gamma; Fleet Patrol Charlie; Fleet Patrol Epsilon;
					Phoenix Squadron; Red Wing Fighters; Fleet Defense Beta; Support Squad Phi;
					Fleet System Defense; Firefly; SG-1; Galactica;
					Starfighter Base; Prometheus; Bebop; Guren Defense;
					Lancelot Recon; Valvrave; Gurren Lagann; Eva 01;
					Eva 00; Eva 02; The Byron;
					Anacreon Starfrigate; Anacreon Explorer; Anacreon Solar Defense;
					The Sirius Anacreon; Anacreon Colonial Defense; Antimatter Research Squad
				</Names>
			</Ship>
		</Ships>
	</StationType>
	
	<!-- Ranx HQ -->

		<StationType UNID="&stRanxHQ;"
				name=				"Ranx HQ"
				sovereign=			"&svRanxEmpire;"
				dockScreen=			"&dsAbandonedStation;"
				abandonedScreen=	"&dsAbandonedStation;"
				dockingPorts=		"8"
				repairRate=			"4"
				canAttack=			"true"

				multiHull=			"true"
				armorID=			"&itOrthoSteel;"
				maxHitPoints=		"1000"
				hitPoints=			"1000"
				explosionType=		"&vtThermoExplosion3;"
				ejectaType=			"&vtWreckEjecta;"

				attributes=			"ranx,enemy,envEarth,envAvoidsAir,populated,RanxHQ"
				levelFrequency=		"----- --rrr ----- ----- -----"
				locationCriteria=	"+planetary,-OuterSystem"
				enemyExclusionRadius="100"
				>

			<Image			imageID="&rsStations8;" imageX="0" imageY="192" imageWidth="256" imageHeight="256"/>

			<Devices>
			</Devices>

			<Items>
				<Item count="10d100"	item="&itAkan30CannonShell;" />
				<Item count="4d20"		item="&itKilotonCannonShell;" />
				<Table>
					<Lookup chance="40" count="1" table="&trConsumables9;"/>
					<Lookup chance="40" count="1" table="&trMinorItem9;"/>
					<Lookup chance="20" count="1" table="&trMajorItem9;"/>
				</Table>
			</Items>

			<Ships>
				<Ship			count="1d6"	class="&scRanxGunship;"	orders="patrol" patrolDist="5"/>
				<Ship			count="1d6"	class="&scRanxGunship;"	orders="guard" />
				<Ship					count="1d3"	class="&scRanxDreadnought;"	orders="guard" >
					<Escorts>
						<Ship			count="1d5"	class="&scRanxGunship;"	orders="escort"/>
					</Escorts>
				</Ship>
				<Ship					count="1"	class="&scRanxDreadnought;"	orders="patrol" patrolDist="150">
					<Escorts>
						<Ship			count="1d4"	class="&scRanxGunship;"	orders="escort"/>
					</Escorts>
				</Ship>
				<Ship			count="1d6"	class="&scRanxGunship;"	orders="patrol" patrolDist="50"/>
			</Ships>

			<Reinforcements minShips="25">
				<Table>
					<Ship chance="25"  count="1d4"	class="&scRanxGunship;" orders="patrol" patrolDist="5"/>
					<Ship chance="75"  count="1"	class="&scRanxDreadnought;"	orders="patrol" patrolDist="25">
						<Escorts>
							<Ship			count="1d4"	class="&scRanxGunship;"	orders="escort"/>
						</Escorts>
					</Ship>
				</Table>
			</Reinforcements>

			<Construction constructionRate="500" maxConstruction="5">
				<Table>
					<Ship chance="30"	count="1"	class="&scRanxDreadnought;"	 orders="patrol" patrolDist="75"/>
					<Ship chance="70"	count="1"	class="&scRanxDreadnought;"	 orders="patrol" patrolDist="150"/>
				</Table>
			</Construction>
		
			<Encounters frequency="common">
				<Lookup table="&tbRanxEncounters;"/>
			</Encounters>
			<Events>
				<OnCreate>
					(for RPC 0 1
						<!--thanks Drako!-->
						(block (buildLocation)
							(setq buildLocation (sysFindObject gSource "nt:asteroid"))
							(if (geq (count (sysFindObject buildLocation "t:asteroid; N:50")) 50)
								(block Nil
									;find a spot
									(setq location (sysVectorPolarOffset gSource (random 0 360) (random 10 50)))
									(sysCreateMarker "Outpost" location &svRanxEmpire;)
									;create the station
									(setq Outpost (sysCreateStation &stRanxOutpost; location))
									;create Ranx Dread to guard station
									(setq Mobile (sysCreateShip &scRanxDreadnought; gSource &svRanxEmpire;))
									(shpOrder Mobile 'guard Outpost)
									)
								)
							)
						)
				</OnCreate>
			</Events>
		</StationType>
********************************************************************************************************************************	
	
	<!--Mining Event Handler-->
	
	<ShipClass UNID="&evMining;"
			class=				"(wingman base class)"
			virtual=			"true"
			
			attributes=			"behaviourClass"
			>
			
		<Events>
			;known problems:
				;they get stuck on an asteroid
				;they need a better mining apparatus
				;aparently there is a mod that makes this work... uh-oh
			;Ok, fixed. I used shpSetCommandCode to restart the mining process so they don't derp :D
			<StartMine>
				(block Nil
					(sysAddObjRecurringTimerEvent 10 gSource "Mining")
					;(sysAddObjTimerEvent 10 gSource "Mining")
					(shpSetCommandCode gSource 
						(block Nil
							;if orders are done, then not docking
							(ObjSetData gSource "Docking" 0)
							(objFireEvent gSource "Mining") 
							))
					;register for onsysweaponfire
					;(dbgoutput(objRegisterForSystemEvents gSource 100))
					)
			</StartMine>
			<Endmine>
				(sysCancelTimerEvent gSource "Mining")
			</Endmine>
			<Mining>
				(block Nil
					;(plymessage gPlayer "mining")
					;(shpOrder gSource 'hold)
					(switch
						;go back to base when full
						(ls (objGetCargoSpaceLeft gSource) 15)
							(block Nil
								(shpOrder gSource 'dock (objGetObjbyID (objGetData gSource "Origin")))
								)
						;get ore
						;and the ore asteroid has free docking ports
						(and 
							;(setq ore (sysFindObject gSource "Nt:ore"))
							(setq ore (sysFindObject gSource "tNN:35 +UNID:&stMinedOre;"))
							(geq (objGetOpenDockingPortCount ore) 2)
							)
							(block Nil
								;(plymessage gPlayer "docking to ore")
								(ObjSetData gSource "Docking" 1)
								(shpCancelOrders gSource)
								(shpOrder gSource 'dock ore)
								;(shpOrder gSource 'loot ore)
								
								;collect until full or no more ore
								(enum (objGetItems ore "*") oreinAsteroid
									(block Nil
										(setq left (objGetCargoSpaceLeft gSource))
										; split ore to fit our cargo space left
										(if (gr (multiply (itmGetcount oreinAsteroid)(itmGetMass oreinAsteroid)) left)
											(block Nil
												(setq oreinAsteroid (itmCreate (itmGetUNID oreinAsteroid) (add (divide left (itmGetMass oreinAsteroid)) 3)))
												)
											)
										(objRemoveItem ore oreinAsteroid)
										(objAddItem gSource oreinAsteroid)
										)
									)
								(ObjSetData gSource "Docking" 0)
								)
						;if none applies:
						;look for asteroid and fire at it
						;not docking
						(not (eq (ObjGetData gSource "Docking") 1))
							(block (asteroid)
								;(setq asteroid (sysFindObject gSource "Nt:asteroid"))
								;(setq asteroid (sysFindObject gSource "NN:50; t:asteroid"))
								(setq asteroid (random (filter (sysFindObject gSource "N:50; t:asteroid") asteroidcheck (not (objGetProperty asteroidcheck 'parallax)))))
								;the above line doesn't work for some reason
								(shpCancelOrders gSource)
								(shpOrder gSource 'attack asteroid)
								(ObjSetData gSource "AstPos" (ObjGetPos asteroid))
								)
						)
					)
			</Mining>
			;this is so that they actually get lots of ores:
			<OnSystemWeaponFire>
				(block (minedOre)
					;if the ship is a mining ship:	borer and ferian:
					;(plymessage gPlayer "herp!")
					(if
						(or
							(eq (objGetType aWeaponObj) &scBorer; )
							(eq (objGetType aWeaponObj) &scBorer-II; )
							(eq (objGetType aWeaponObj) &scFerianMiner; )
							)
							;have around 50% to get some ores:
							(block (chance)
								(setq chance (random 0 100))
								(if
									(leq chance 1)
										(block (theOre)
											;(plymessage gPlayer "derp!")
											; Create the mined ore
											;(setq minedOre (sysCreateStation &stMinedOre; (ObjGetData gSource "AstPos")))
											(dbgOutPut (ObjGetTarget gSource))
											(if
												(ObjGetPos (ObjGetTarget gSource))
													(setq minedOre (sysCreateStation &stMinedOre; (ObjGetPos (ObjGetTarget gSource))))
												)
											(objAddItem minedOre (itmCreate &itTitaniumOre; 1) 25)
											(objIncVel minedOre (sysVectorPolarVelocity (random 0 360) 5))
											)
									)
								)
							)
						)
			</OnSystemWeaponFire>
		</Events>
	</ShipClass>
	
<!--Mining Station Handler-->
	<ShipClass UNID="&evMiningStation;"
			class=				"(wingman base class)"
			virtual=			"true"
			
			attributes=			"behaviourClass"
			>
			
		<Events>
			<Start>
				(block (miner)
					(for RPC 0 (random 3 7)
						(block Nil
							(setq miner (sysCreateShip &scBorer-II; (objGetPos gsource) (ObjGetSovereign gSource)))
							(objSetEventHandler miner &evMining;)
							(ObjSetData miner "Origin" (objGetID gSource))
							(ObjSetData miner "AstMiner" True)
							(objFireEvent miner "StartMine")
							(objRegisterForEvents gSource miner)
							(ObjIncData gSource "MinerCount" 1)
							)
						)
					)
			</Start>
			<OnObjDestroyed>
				;this is for the vanilla mining mission
				(block (missionID)
					(setq missionID (objGetData gSource "missionID"))
					(if (eq (objGetData gSource "missionStatus") 'inProgress)
						(switch
							(eq missionID 'DestroyIllegalMiners)
								(if (mneAllTargetsDestroyed gSource aObjDestroyed)
									(block Nil
										(objSetData gSource "missionStatus" 'success)
										(typIncGlobalData &stMiningColony; "missionsCompleted")
										(shpCancelOrders gPlayerShip)
										(shpOrder gPlayerShip 'dock gSource)
										(plyMessage gPlayer "Mission complete!")
										)
									)

							(eq missionID 'SaveMiningShip)
								(switch
									(eq aObjDestroyed (objGetObjRefData gSource "targetMiner"))
										(block Nil
											(objSetData gSource "missionStatus" 'failure)
											(typIncGlobalData &stMiningColony; "missionsFailed")
											(shpCancelOrders gPlayerShip)
											(plyMessage gPlayer "Mission failed!")
											)
									(if (mneAllTargetsDestroyed gSource aObjDestroyed)
										(block (theMiner)
											(objFireEvent (objGetObjRefData gSource "targetMiner") "OrderSetFree")

											(objSetData gSource "missionStatus" 'success)
											(typIncGlobalData &stMiningColony; "missionsCompleted")
											(shpCancelOrders gPlayerShip)
											(shpOrder gPlayerShip 'dock gSource)
											(plyMessage gPlayer "Mission complete!")
											)
										)
									)
							)
						)
					;this is for respawning miners
					(if
						(ObjGetData aObjDestroyed "AstMiner")
						;true= run respawn event
							(block Nil
								(ObjSetData gSource "MinerCount" (subtract (ObjGetData gSource "MinerCount") 1))
								(setq miner (sysCreateShip &scBorer-II; (objGetPos gsource) &svCommonwealth;))
								(objSetEventHandler miner &evMining;)
								(ObjSetData miner "Origin" (objGetID gSource))
								(objFireEvent miner "StartMine")
								(objRegisterForEvents gSource miner )
								(ObjIncData gSource "MinerCount" 1)
								)
						;false=nil
						)
					)
			</OnObjDestroyed>
			<OnObjDocked>
				(block Nil
					(if
						(and 
							;if they docked with this station
							(eq aDockTarget gSource)
							;we have less than X ships
							(ls (ObjGetData gSource "MinerCount") 10)
							;and not destroyed:
							(not (ObjIsAbandoned gSource))
							)
							(block Nil
								;take ore
								(enum (objGetItems aObjdocked "* c +Ore;") thing
									(block Nil
										(objRemoveItem aObjdocked thing)
										(objAddItem gSource thing)
										)
									)
							;make ship
								(setq miner (sysCreateShip &scBorer-II; (objGetPos gsource) &svCommonwealth;))
								(objSetEventHandler miner &evMining;)
								(ObjSetData miner "Origin" (objGetID gSource))
								(objFireEvent miner "StartMine")
								(objRegisterForEvents gSource miner )
								;(objFireEvent miner "Dock")
								(ObjIncData gSource "MinerCount" 1)
								)
						)
					;take ore anyways:
						(enum (objGetItems aObjdocked "* c +Ore;") thing
							(block Nil
								(objRemoveItem aObjdocked thing)
								(objAddItem gSource thing)
								)
							)
					;if they docked to ore: [let's assume ore in all other cases]
					;(sysCancelTimerEvent aObjdocked "Mining")
					)
			</OnObjDocked>
		</Events>
	</ShipClass>

	<DockScreen UNID="&dsSovereignRelation;"
			type=				"customPicker"
			backgroundID=		"&rsItemListScreen;"
			nestedScreen=		"true"
			>

		<List
			rowHeight="96"
			>
			<!--
			LEGEND:
			EncounteredSovlist is list of sovereign unids encountered in game
			SovRelations is list used by this dockscreen
			
			;make a list of entries about relations of the player with the sovereign
				;entry is in the form of:
					;(list [Title] (list [Image]) [Description])
					;[sovname], nil, [ (sovGetDisposition sovereignID targetSovereignID)]
				;how to generate list of encountered sovereigns:
					;check the map using the registration event
					
					 	list: a list of 5 numbers, the 
						first is the UNID of the image resource as a number, the 
						second and the third are the x,y coordinates in pixels of the resource image (from the top left corner of the image) the 
						fourth and fifth are the sizes of the resource image in pixels. (first width then height)
						(ObjGetImageDesc [object])
						(list
							1-keep
							2-
							3-
							4-change to 96
							5-change to 96
							)
			
			-->
			(block Nil
				;initialize with the CW
				(block (sovobject SovImageDesc)
					(setq sovobject (random (sysFindObject gSource (cat "*T J:" &svCommonwealth; ";"))))
					(setq SovImageDesc
						(resCreateImageDesc 
							(item (objGetImageDesc sovobject) 0) 
							(add
								(item (objGetImageDesc sovobject) 1)
								(subtract (divide (item (objGetImageDesc sovobject) 3) 2) 48) 
								)
							(add
								(item (objGetImageDesc sovobject) 2)
								(subtract (divide (item (objGetImageDesc sovobject) 4) 2) 48) 
								)
							(switch
								(ls (item (objGetImageDesc sovobject) 3) 96)
									(item (objGetImageDesc sovobject) 3)
								)
							(switch
								(ls (item (objGetImageDesc sovobject) 4) 96)
									(item (objGetImageDesc sovobject) 4)
								)
							)
						)
					(TypSetData &stRetaliationController; "SovRelations" 
						(list 
							(list 
								(TypGetDataField  &svCommonwealth; 'name) 
								SovImageDesc
								(cat 
									(switch
										(eq (count (sysFindObject gSource (cat "*T J:" sovtoadd ";"))) 0)
											"This sovereign does not have a presence in this system. \n"
										)
									"Relationship: " 
									(sovGetDisposition &svCommonwealth; (ObjGetSovereign gPlayership))
									"\n\n"
									(switch
										(leq (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 5)
											" You are a nuisance. Only small gunships will be sent to deal with you."
										(leq (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 10)
											" You are a bandit. Small gunships will come after you but in larger fleets."
										(leq (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 15)
											" You are a desperado. Heavy gunships will start coming after you."
										(leq (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 20)
											" You are a pirate. Frigates and larger will come after you."
										(leq (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 25)
											" You are a target for extermination. Entire fleets will come after you. They will not stop until the genocide of their stations and livelihood has ended."
										)
									)
								&svCommonwealth; 
								)
							)
						)
					<!---
					(enum (TypGetData &stRetaliationController; "EncounteredSovlist") sovunid (block (sovobject SovImageDesc)
						(setq sovobject (random (sysFindObject gSource (cat "*T J:" sovunid ";"))))
						(setq SovImageDesc
							(resCreateImageDesc 
								(item (objGetImageDesc sovobject) 0) 
								(add
									(item (objGetImageDesc sovobject) 1)
									(subtract (divide (item (objGetImageDesc sovobject) 3) 2) 48) 
									)
								(add
									(item (objGetImageDesc sovobject) 2)
									(subtract (divide (item (objGetImageDesc sovobject) 4) 2) 48) 
									)
								(switch
									(ls (item (objGetImageDesc sovobject) 3) 96)
										(item (objGetImageDesc sovobject) 3)
									)
								(switch
									(ls (item (objGetImageDesc sovobject) 4) 96)
										(item (objGetImageDesc sovobject) 4)
									)
								)
							)
						(switch
							(not (eq sovunid &svCommonwealth;))
								(TypSetData &stRetaliationController; "SovRelations" 
									(lnkAppend 
										(TypGetData &stRetaliationController; "SovRelations") 
										(list 
											(TypGetDataField sovunid 'name) 
											SovImageDesc
											(cat "Relationship: " (sovGetDisposition sovunid (ObjGetSovereign gPlayership))) 
											sovunid 
											)
										)
									)
							)
						))
					
					(random (sysFindObject gSource (cat "*t J:" unid ";")))
					lnkRemoveNil complains with "identifier expected"
					(TypSetData &stRetaliationController; "SovRelations" 
						(lnkRemoveNil (TypGetData &stRetaliationController; "SovRelations"))
						)
						-->
					;enum through other encountered sovs and add them
					(enum (TypGetData &stRetaliationController; "EncounteredSovlist") sovtoadd (block Nil
						(block (sovobject SovImageDesc)
							(switch
								(not (eq sovtoadd &svCommonwealth;))
									(block Nil
										(setq sovobject (random (sysFindObject gSource (cat "*T J:" sovtoadd ";"))))
										(setq SovImageDesc
											(resCreateImageDesc 
												(item (objGetImageDesc sovobject) 0) 
												(add
													(item (objGetImageDesc sovobject) 1)
													(subtract (divide (item (objGetImageDesc sovobject) 3) 2) 48) 
													)
												(add
													(item (objGetImageDesc sovobject) 2)
													(subtract (divide (item (objGetImageDesc sovobject) 4) 2) 48) 
													)
												(switch
													(ls (item (objGetImageDesc sovobject) 3) 96)
														(item (objGetImageDesc sovobject) 3)
													)
												(switch
													(ls (item (objGetImageDesc sovobject) 4) 96)
														(item (objGetImageDesc sovobject) 4)
													)
												)
											)
										(TypSetData &stRetaliationController; "SovRelations" 
											(lnkAppend (TypGetData &stRetaliationController; "SovRelations") 
												(list 
													(TypGetDataField sovtoadd 'name) 
													SovImageDesc
													(cat 
														(switch
															(eq (count (sysFindObject gSource (cat "*T J:" sovtoadd ";"))) 0)
																"This sovereign does not have a presence in this system. \n"
															)
														"Relationship: " 
														(sovGetDisposition sovtoadd (ObjGetSovereign gPlayership))
														"\n\n"
														(switch
															(leq (TypGetData &stRetaliationController; (cat sovtoadd "Retaliate")) 5)
																"You are a nuisance. Only small gunships will be sent to deal with you."
															(leq (TypGetData &stRetaliationController; (cat sovtoadd "Retaliate")) 10)
																"You are a bandit. Small gunships will come after you but in larger fleets."
															(leq (TypGetData &stRetaliationController; (cat sovtoadd "Retaliate")) 15)
																"You are a desperado. Heavy gunships will start coming after you."
															(leq (TypGetData &stRetaliationController; (cat sovtoadd "Retaliate")) 20)
																"You are a pirate. Frigates and larger will come after you."
															(leq (TypGetData &stRetaliationController; (cat sovtoadd "Retaliate")) 25)
																"You are a target for extermination. Entire fleets will come after you. They will not stop until the genocide of their stations and livelihood has ended."
															)
														)
													sovtoadd 
													)
												)
											)
										)
								)
							)
						))
					(TypGetData &stRetaliationController; "SovRelations")
					)
						
						<!--
						;true = lnkappend new sovereigns
						(block (sovredundancylist)
							
							(setq sovredundancylist (list Nil))
							(enum (TypGetData &stRetaliationController; "SovRelations") knownsovs (block Nil
								(lnkAppend sovredundancylist (item knownsovs 3))
								))
							(setq sovredundancylist (lnkRemoveNil sovredundancylist))
							
							(enum (TypGetData &stRetaliationController; "EncounteredSovlist") sovtoadd (block Nil
								(switch
									(match sovredundancylist sovcheck (eq sovcheck sovtoadd))
										;true=don't need to do anything
											Nil
										;nil=append this to the sovereign
										(block (sovobject SovImageDesc)
											(setq sovobject (random (sysFindObject gSource (cat "*T J:" sovtoadd ";"))))
											(setq SovImageDesc
												(resCreateImageDesc 
													(item (objGetImageDesc sovobject) 0) 
													(add
														(item (objGetImageDesc sovobject) 1)
														(subtract (divide (item (objGetImageDesc sovobject) 3) 2) 48) 
														)
													(add
														(item (objGetImageDesc sovobject) 2)
														(subtract (divide (item (objGetImageDesc sovobject) 4) 2) 48) 
														)
													(switch
														(ls (item (objGetImageDesc sovobject) 3) 96)
															(item (objGetImageDesc sovobject) 3)
														)
													(switch
														(ls (item (objGetImageDesc sovobject) 4) 96)
															(item (objGetImageDesc sovobject) 4)
														)
													)
												)
											(TypSetData &stRetaliationController; "SovRelations" 
												(lnkAppend (TypGetData &stRetaliationController; "SovRelations") 
													(list 
														(TypGetDataField sovtoadd 'name) 
														SovImageDesc
														(cat "Relationship: " (sovGetDisposition sovtoadd (ObjGetSovereign gPlayership)) ) 
														sovtoadd 
														)
													)
												)
											)
									)
								))
							)-->
				;return the SovRelations list at the end so the game knows what to display
				(TypGetData &stRetaliationController; "SovRelations")
				)
				<!--
				
				rename:

				(destructive chaos)
				(destructive order)

				exclude:
				auton
				Stars

				random trivia?

				independent
				Commonwealth
				independent merchant
				independent merchant
				Charon Pirates
				Outlaws
				Ares Orthodoxy
				Anarchists
				Settlers
				Cult
				rogue fleet
				Sung Slavers
				Slaves of Sung
				Corporate Hierarchy
				Black Market
				Ferian miners
				Ringers
				Ferian miners
				gladiator
				Sisters of Domina
				CSC Antarctica
				Commonwealth Fleet
				Commonwealth Fleet
				Iocrym
				Ares Sect
				sentinel AI
				Domina
				Heliotropes
				Centauri Clans
				Kobol Syndicate
				Luminous drone
				Huari Empire
				Dwarg Raiders
				zoanthrope
				Lombard Marauders
				Himal Separatists
				Urak Warlords
				Tinkers Guild
				Gaian Terraformers

				Ranx Empire
				The Flood
				Zombie Horde
				FutureTech Industries
				Agnath Collectice

				-->
		</List>

		<Panes>
			<Default>
				<OnPaneInit>
					(block Nil
						(ScrSetDesc gScreen "This screen shows current sovereigns in the system and their attitute towards you.")
						)
				</OnPaneInit>

				<Actions>
					<!--
					<Action name="View Relationship Status" key="R">
						
					</Action>
					-->
					<Action name="Done" key="D" default="1" cancel="1">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

<!--Escape Earthzone Event Handler-->
	<ShipClass UNID="&evEscapeEarthzone;"
			class=				"(wingman base class)"
			virtual=			"true"
			
			attributes=			"behaviorClass"
			>
			
		<Events>
			<OnAttacked>
				(block (Steve)
					; if the player is close enough, they hear radio chatter
					(setq Steve (random 50 150))
					; Steve is the name of the Radio Operator
					; just kidding!
					(if 
						(leq (objGetDistance gPlayerShip aWreckObj) Steve)
						;[objGetName aWreckObj] and setq it!
						(block (warning name)
							(setq name (objGetName gSource))
							(setq warning (random 0 5))
							(switch
								(eq warning 0)
									(plyMessage gPlayer "Mayday! Mayday! Mayday!")
								(eq warning 1)
									(plyMessage gPlayer "Don't shoot! We are unarmed!")
								(eq warning 2)
									(plyMessage gPlayer " "name" down! I repeat, "name" down!")
								(eq warning 3)
									(plyMessage gPlayer "Don't shoot! We are leaving the battlefield.")
								(eq warning 4)
									(plyMessage gPlayer "SOS! SOS!")
								(eq warning 5)
									(plyMessage gPlayer "Warning to all civilians in the area! Evacuate immediately!")
								)
							)
						)
					)
			</OnAttacked>
		</Events>
	</ShipClass>
	
<!--Retaliation Event Handler-->

	<ShipClass UNID="&evRetaliationEventHandler;"
			class=				"(Retaliation Event Handler)"
			virtual=			"true"
			
			attributes=			"behaviorClass"
			>
		<AISettings
			noFriendlyFire=		"true"
			/>
		
		<Events>
			;give retaliation ship this event
			;set the teamLeader status
			;get ShipOrders from previous leader
				;ObjSetData- what?
					;order
					;target
			
			;give them the OnBehavior Check!
			<SquadronTactics>
			(block Nil
				;if object is already dead:
				(if	
					(and
						(shpGetOrderTarget gSource)
						(objIsAbandoned (shpGetOrderTarget gSource))
						)
					;true= leave system
					(block Nil
						(PrintTo 'log "name of station and abandoned state")
						(PrintTo 'log (shpGetOrderTarget gSource))
						(PrintTo 'log (objIsAbandoned (shpGetOrderTarget gSource)))
						(ShpCancelOrders gSource)
						)
					)
				(if (objGetData gSource "teamLeader") 
					(block Nil
						(enum (sysFindObject gSource "sO:escort;") gunship
							(if 
								;distance between the two is gr than 50 ls,
								(gr (sysVectorDistance gunship gSource) 50)
								(block Nil
									;cancel orders
									(shpCancelOrders gunship)
									;tell the gunship to escort the leader
									(shpOrder gunship 'escort gSource)
									)
								)
							)
						)
					)
				(if 					
					(and
						;if the target is also the playership
						(eq (objGetTarget gSource) gPlayership)
						;this is the leader
						(objGetData gSource "teamLeader")
						)
						(block Nil
							;register it so that we can use OnObjEnteredGate
							(objRegisterForEvents gSource gPlayership)
							;(plymessage gPlayer "Registered")
							)
					)
				)
			</SquadronTactics>
			
			<OnDestroy>
				;; check if this ship is the leader
				(if (objGetData gSource "teamLeader") 
					(block (escorts prevOrder prevTarget)
						;; get the ships currently escorting destroyed ship
						(setq escorts (sysFindObject gSource "sO:escort"))
						
						;prev orders + target
						(setq prevOrder (objGetData gSource "shipOrder"))
						(setq prevTarget (objGetObjById (objGetData gSource "orderTarget")))

						;; only proceed if we have any escorts left
						(if escorts 
							(block (newleader test)
								;; the first becomes the new leader
								(setq newleader (item escorts 0))
								;; designate the ship as teamLeader
								(objSetData newleader "teamLeader" true)
								;; give the new leader some useful order
								;; (cancel any previous ones first)
								(shpCancelOrders newleader)
								(shpOrder newleader 'attack prevTarget)
								<!--
								(plyMessage gPlayer "PrevTarget is "prevTarget"!")
								-->
								;set Target again for the next leader
								(objSetData newLeader "orderTarget" (objGetData gSource "orderTarget"))
								<!--
								(plyMessage gPlayer "Next leader's targ is "prevTarget"!")
								-->
								;; if there are any more ships, tell them to escort newleader
								(enum (subset escorts 1) s 
									(block nil
										(shpCancelOrders s)
										(shpOrder s 'escort newleader)
										)
									)
								)
							)
						)
					)
			</OnDestroy>
			
			<OnObjEnteredGate>
				(PrintTo 'log(ObjSetData gSource "Gateable" true))
			</OnObjEnteredGate>
			
			<OnPlayerLeftSystem>
				(block (gatetest)
					;(plymessage gPlayer "OnPlayerLeftSystemTest")
					;(plymessage gPlayer ""aDestNode"")
					;(PrintTo 'log "OnPlayerLeftSystemTest")
					;if the playership is using a normal gate
						;NOTE: this also checks if the player is the target so that random retaliation fleets don't just gate out randomly :D
					(setq gatetest(sysFindObject gSource "Ns D:teamLeader; "))
					(if 
						(and
							(PrintTo 'log(ObjGetData gSource "Gateable"))
							(eq (objGetObjById (objGetData gSource "orderTarget")) gPlayership)
							(not
								(eq aDestNodeID 'Elysium)
								)
							)
						'followPlayer
						;else
						Nil
						)
					)
			 </OnPlayerLeftSystem>
		</Events>
	</ShipClass>
	
	<!--Freighter Respawner Event Handler-->

	<ShipClass UNID="&evRespawnerEventHandler;"
			class=				"(Respawner Event Handler)"
			virtual=			"true"
			
			attributes=			"behaviorClass"
			>
		<AISettings
			noFriendlyFire=		"true"
			/>
			
		<Events>
			;newStationlocation is the new station location
			<Reconstruction>
				;use syscreate station and vector offset to do it!
				(block (prevstationlocation namek wessidestory sigh great test)
					;get the pos
					(setq prevstationlocation (objGetData gSource "oldstationlocation"))
					;get the UNID
					(setq wessidestory (objGetData gSource "oldstationUNID"))
					;get the sov
					(setq namek (objGetData gSource "oldstationSov"))
					(if 
						(and
							;the freighter is close to the new stationlocation
							(leq (sysVectorDistance (objGetPos gSource) (objGetData gSource "newStationlocation")) 60)
							;we already destroyed the station 
							(ls (objGetData gSource "call") 1)
							)
						(block Nil
							(objDestroy (objGetObjById (objGetData gSource "TheRealOldeStation")))
							)
						)
					
					(if
						(and
							;the freighter is close to the new stationlocation
							(leq (objGetDistance gSource prevstationlocation) 20)
							;it hasn't been called yet
							(ls (objGetData gSource "call") 1)
							;it doesn't give an error
							;(not (iserror (sysCreateStation wessidestory (objGetData gSource "newStationlocation"))))
							)
							(block Nil
								;tell the freighter to go to the place:
								;create the station
								(setq sigh (sysCreateStation wessidestory (objGetData gSource "newStationlocation")))
								;set the sov
								(objSetSovereign sigh namek)
								<!-- defunct
								;tell the station what it's supposed to replace
								(setq great (objSetData sigh "OldStationDataOnNewStation" prevstationlocation))
								
								;(plyMessage gPlayer "OldStationDataOnNewStation is "great" when passed to station? ")
								-->
								(objIncData gSource "call" 1)
								)
							<!--
							(if
								(and
									;the freighter is close to the new stationlocation
									(leq (sysVectorDistance (objGetPos gSource) (objGetData gSource "newStationlocation")) 60)
									;it hasn't been called yet
									(ls (objGetData gSource "call") 1)
									)
								(block Nil
									; wack it a couple times to make sure
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									(sysCreateWeaponFire &itAresPlasmaCannon; gSource (objGetData gSource "newStationlocation") 0 0 gSource True)
									)
									)
								-->
						)
					)
					;check for player in system!
			</Reconstruction>
			<OnPlayerLeftSystem>
				(block Nil
					(shpOrder gSource 'wait)
					)
			</OnPlayerLeftSystem>
			<OnPlayerEnteredSystem>
				(block (test)
					(shpOrder gSource "goto" (objGetData gSource "newStationlocation"))					
					)
			</OnPlayerEnteredSystem>
			<OnDestroy>
				(sysCancelTimerEvent gSource "Reconstruction")
			</OnDestroy>
		</Events>
	</ShipClass>

<!--The Respawn station-->	
		
	<StationType UNID="&stRespawnstation;"
			name=				"Construction station"
			sovereign=			"&svIndependent;"
			abandonedScreen=	"Main"
			dockScreen=			"Main"
			canAttack=			"true"
			
			multiHull=			"true"
			repairRate=			"2"
			armorID=			"&itReinforcedTitanium3;"
			maxHitPoints=		"150"
			hitPoints=			"150"
			ejectaType=			"&vtWreckEjecta;"

			noArticle=			"true"
			>
		<ImageVariants>
			<Image			imageID="&rsStations3;" imageX="0" imageY="128" imageWidth="224" imageHeight="224"/>
			<Image			imageID="&rsSmallReconstructionStation;" imageX="0" imageY="0" imageWidth="213" imageHeight="171"/>
			<Image			imageID="&rsSungReconstructionStation;" imageX="0" imageY="0" imageWidth="60" imageHeight="60"/>
			<Image			imageID="&rsSungReconstructionStation2;" imageX="0" imageY="0" imageWidth="60" imageHeight="62"/>
		</ImageVariants>
		<Events>
			<!--
			<OnCreate>
				(block Nil
					;timer for making new station
					(objFireEvent gSource "Replacement")
					;(sysAddObjTimerEvent (random 3000 6000) gSource "Replacement")
					)
			</OnCreate>
			<Replacement>		
				(block (oldStation runningOutOfNames farFarAway)
				
					;know what previous station was	
					;no binding for OldStationDataOnNewStation. GRRRR.
					;(staGetType station)
					
					(setq oldStation (objGetData gSource "OldStationDataOnNewStation"))
					(plyMessage gPlayer "OldStationDataOnNewStation is "OldStationDataOnNewStation"?")
					
					;make new station far away
					(setq runningOutOfNames (sysCreateStation oldStation (setq farFarAway (sysVectorPolarOffset gSource (random 0 360) (random 10000 20000)))))
					
					;get rid of guards
					(enum (sysFindObject runningOutOfNames "s O:guard") ship 
						(block Nil
							;digdug's idea:
								;guard goes over the station and disappears (saving the state and details)
								(objSuspend ship)
								;so, basically, you can save the details of a ship and recall it later (by respawning it)							
							)
						)
					;then resume the ships
					(objResume ship)
					
					;now, move the station to this station
					(objMoveTo runningOutOfNames (objGetPos gSource))
					
					;destroy this station
					(objDestroy gSource)
					
					)
			</Replacement>
			<store>
				;something like this:
			
			;create a station far away
			(setq removal (sysCreateStation &stRespawnstation; (setq location (sysVectorPolarOffset gSource (random 0 360) (random 10000 20000)))))
			
				;so yeah
				;remove the guards
							;(enum (sysFindObject removal "sAE N:60; O:guard;") something exp)
							;then "teleport" station using objmoveTo
							;use ObjGetData
			</store>
			-->	
			<SelfDestruct>
				(block Nil
					(ObjDestroy gSource)
					)
			</SelfDestruct>
		</Events>

		<DockScreens>
			<Main>

				<Panes>
					<Default
							desc=	"The station is bustling about, with everybody hurrying to establish the station as soon as they can.">

						<Actions>
							<Action name="Loot" key="L" default="1" >
								(block Nil
									(setq gPrevScreen "&dsAbandonedStation;")
									(scrShowScreen gScreen "&dsLoot;")
									(scrEnableAction gScreen 0 Nil)
									)
							</Action>

							<Action name="Jettison" key="J">
								(block Nil
									(setq gPrevScreen "&dsAbandonedStation;")
									(scrShowScreen gScreen "&dsJettison;")
									(scrEnableAction gScreen 1 Nil)
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>

		</DockScreens>
		<!--
		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="61"	y="35" />
			<Port x="61"	y="-35" />
			<Port x="0"		y="-70" />
			<Port x="-61"	y="-35" />
			<Port x="-61"	y="35" />
		</DockingPorts>
		-->
	</StationType>

	-steal cargo
		;event handler
	<!-- Stealing Cargo event handler -->

	<ShipClass UNID="&evStealCargoEventHandler;"
			class=				"(Steal Cargo Event Handler)"
			virtual=			"true"
			
			attributes=			"behaviorClass"
			>
			
		<Events>
			<StealCargo>
				(if
					;if it's close enough and it hasn't fired yet:
					(and
						(ls (ObjGetDistance gSource gPlayership) 70)
						;check this conditional first!
						(eq (ObjGetData gSource "Fired") nil)
						)
						(block Nil
							(sysCreateWeaponFire &vtCargoSteal; gSource (objGetPos gSource) (sysCalcFireSolution (objGetpos (objGetTarget gSource)) (objGetVel (objGetTarget gSource)) (objGetVel gPlayerShip))(typGetDataField &vtCargoSteal; 'speed) (objGetTarget gSource))
							(ObjSetData gSource "Fired" True)
							)
				
					)
			</StealCargo>
			<!--
				
				(if
					;if it's close enough and it hasn't fired yet:
					(and
						(ls (ObjGetDistance gSource gPlayership) 50)
						;check this conditional first!
						(eq (ObjGetData gSource "Fired") nil)
						)
						(block Nil
							;(plymessage gPlayer "firing")
							;(sysCreateWeaponFire weaponID objSource    posVector   dir           speed                               objTarget [detonateNow])
							;(sysCreateWeaponFire &vtCargoSteal; gSource 0 0 (typGetDataField &vtCargoSteal; 'speed) (objGetTarget gSource))
							)
				
					)
			-->
		</Events>
	</ShipClass>
	
	<!-- Cargo Steal Weapon 
	frequency=			"rare"
	numberAppearing=	"1"
	-->

	<ItemType UNID="&vtCargoSteal;"
			name=				"Cargo Steal device"
			level=				"5"
			value=				"50000"
			mass=				"6000"
			frequency=			"uncommon"
			attributes=			"Illegal; MajorItem; blackMarket;"
			description=		"This weapon spawns a short lived auton that hijacks cargo from unsuspecting travellers. It has been used by pirates and other outlaws to fund their operations."
			>
			;passersby
			;virtual=			"true"
		<Image imageID="&rsItemsNAMI1;" imageX="96" imageY="0" imageWidth="96" imageHeight="96"/>
		<Weapon
				type=				"missile"
				ammoID=				"&itCargoStealAmmo;"

				damage=				"kinetic:4d6:"
				missileSpeed=		"25"
				fireRate=			"30"
				maneuverability=	"2"
				lifetime=			"500"
				powerUse=			"100"
				omnidirectional=	"true"
				autoAquireTarget=	"true"

				hitPoints=			"20"
				interaction=		"100"

				sound=				"&snRecoillessCannon;"
				>
				<!--
				<Image imageID="&rsWeapons9DB32;" imageX="0" imageY="0" imageWidth="32" imageHeight="32" />
				-->
				<Effect>
					<Image imageID="&rsSmallShips1;" imageX="32" imageY="0" imageWidth="32" imageHeight="32" imageFrameCount="0" imageTicksPerFrame="0"/>
				</Effect>
		</Weapon>

		<Events>			
			<OnDamageArmor>
				(block Nil
					; Add the cargo steal overlay, but only if we don't already
					; have too many overlays

					(if (leq (count (objGetOverlays gSource)) 12)
						(objAddOverlay 
							gSource 
							&ovCargoStolen; 
							aHitPos 
							(modulo (add aHitDir 180) 360)
							)
						)

					; Return full damage
					aDamageHP
					)
			</OnDamageArmor>

			<OnDamageShields>
				(block (probTable)
					; Chance of passing through the shield is based on level
					(setq probTable
						'(100
							100		; Level I
							100		; Level II
							100		; Level III
							100		; Level IV
							100		; Level V
							100		; Level VI
							100		; Level VII
							100		; Level VIII
							95		; Level IX
							85		; Level X
							65		; Level XI
							30		; Level XII
							5		; Level XIII
							0		; Level XIV and higher
							)
						)

					(if (leq (random 1 100) (item probTable (min 14 (itmGetLevel aDeviceItem))))

						; If we penetrate shields, then return full damage
						aDamageHP

						; Otherwise, we return Nil to indicate that normal shield handling applies
						Nil
						)
					)
			</OnDamageShields>
		</Events>
	</ItemType>
	
	<!-- CargoSteal Ammo -->

	<ItemType UNID="&itCargoStealAmmo;"
			name=				"Cargo Steal Ammo"
			level=				"2"
			value=				"1"
			mass=				"100"
			attributes=			"Consumable; Missile; Illegal; MajorItem; blackMarket;"
			frequency=			"uncommon"
			numberAppearing=	"12d40"

			description=		"This is ammunition for illegal weapons that drill into the hulls of other ships."

			>
		<Image imageID="&rsSmallShips1;" imageX="32" imageY="0" imageWidth="32" imageHeight="32" imageFrameCount="0" imageTicksPerFrame="0"/>
		<!--
		<Image imageID="&rsItemsRasiermesser1;" imageX="0" imageY="96" imageWidth="96" imageHeight="96"/>
		-->
	</ItemType>
	
	<!--Cargo Stolen Overlay type-->
		
	<OverlayType UNID="&ovCargoStolen;"
			>
		<Effect>
			<Image imageID="&rsDrill;" imageWidth="32" imageHeight="32" rotationCount="1"/>
		</Effect>

		<HitEffect 
				sound=	"&snArmorHit1;"
				>
			<ParticleExplosion
					particleCount=		"2d4"
					particleSpeed=		"25"
					particleLifetime=	"20"
					>
				<!--
				;need debris here!
				<Image imageID="&rsPteravoreDebris;" imageWidth="12" imageHeight="12" imageFrameCount="8" imageTicksPerFrame="3"/>
				-->
			</ParticleExplosion>
		</HitEffect>

		<Events>
			<OnCreate>
				(block Nil
					;(Plymessage gPlayer (cat "Is the test "(eq aOrderGiver gPlayerShip)"?"))
					(objSetOverlayData gSource aOverlayID "hp" 60)
					;set data if the player fired it:
					(objSetOverlayData gSource aOverlayID "PlayerFired" (eq aOrderGiver gPlayerShip))
					(if 
						(eq gSource gPlayership)
							(block Nil
								;play the hit sound
								(sysPlaySound &snBoink;)
								(objFireOverlayEvent gSource aOverlayID "StealCargoInit")
							)
						)
					)
			</OnCreate>
			<StealCargoInit>
				(if 
					(eq gSource gPlayership)
						(block Nil
							;play the drilling sound
							;(sysPlaySound &snDrill;)
							;warn the player
							(plymessage gPlayer "Pirates are drilling into your cargo hold!")
							)
					)				
			</StealCargoInit>
			<!--
			;last working OnUpdate event
			(block (timer ship allItems)
					;after a while, 
					(setq timer (objIncOverlayData gSource aoverlayID "time" 1))
						(sysPlaySound &snDrill;)
						(if
							(geq timer 15) 
							(block Nil
								;make escape pod and transfer some random items there
								(setq ship (sysCreateShip &scEarthzone; gSource &svIndependent;))
								
								; pick a random item in the ship's cargo hold to damage
								(setq allItems (objGetItems gPlayerShip "*U -ID;"))

								; Remove an item
								(if (eq (count allItems) 0)
									(setq desc (cat desc " Fortunately, your cargo hold is empty and nothing was stolen."))
									(block (itemDamaged)
										(setq itemDamaged (random allItems))
										(setq desc (cat desc " The pirates have taken " (itmGetName itemDamaged 8) "."))
										(objRemoveItem gPlayerShip itemDamaged)
										(objAddItem ship itemDamaged)
										)
									)
									
								;(objRemoveItem spaceObject itemStruct [number])
								;(objAddItem gPlayerShip (itmCreate &itGemOfSacrifice; 1))
								;remove the overlay
								;(objRemoveOverlay sObj overlayID)
								(objRemoveOverlay gSource aoverlayID)
								)
							)
					)
			-->
			<OnUpdate>
			<!--
			(if 
				(eq gSource gPlayership)
					(block (timer ship allItms damagechance)
						(setq damagechance (random 1 100))
						;after a while, 
						(setq timer (objIncOverlayData gSource aoverlayID "time" 1))
							(sysPlaySound &snDrill;)
							(if
								(geq timer 15) 
								;do a switch here so I can add device destruction as an option
								;do steal cargo
									(block Nil
										;make escape pod and transfer some random items there
										(setq ship (sysCreateShip &scEarthzone; gSource &svIndependent;))
										
										; pick a random item in the ship's cargo hold to damage
										(setq allItems (objGetItems gPlayerShip "*U -ID;"))

										; Remove an item
										(if (eq (count allItems) 0)
											(plymessage gPlayer " Fortunately, your cargo hold is empty and nothing was stolen.")
											(block (itemDamaged)
												(setq itemDamaged (random allItems))
												(plymessage gPlayer" The pirates have taken " (itmGetName itemDamaged 8) ".")
												(objRemoveItem gPlayerShip itemDamaged)
												(objAddItem ship itemDamaged)
												)
											)
											
										;remove the overlay
										;(objRemoveOverlay sObj overlayID)
										(objRemoveOverlay gSource aoverlayID)
										)
								)
								)
						)	
					-->
					(block (timer ship allItms damagechance)
						(setq damagechance (random 1 100))
						;after a while, 
						(setq timer (objIncOverlayData gSource aoverlayID "time" 1))
						(sysPlaySound &snDrill;)
							;(if
							;	(eq gSource gPlayership)
							;		(sysPlaySound &snDrill;)
							;	)
							;(plymessage gPlayer (cat "Is it still " (eq aOrderGiver gPlayership) " ?"))
							(if
								(geq timer 15)
								(switch
									;(eq aOrderGiver gPlayership)
									(objGetOverlayData gSource aOverlayID "PlayerFired")
										(block Nil
											;make escape pod and transfer some random items there
											(setq ship (sysCreateShip &scPirateEarthzone; gSource &svHimalSeparatists;))
											(ShpOrder ship 'goto gPlayership)
											(sysAddObjRecurringTimerEvent 60 ship "playerstealing")
											
											; pick a random item in the ship's cargo hold to damage
											(setq allItems (objGetItems gSource "*U -ID;"))
											
											; Remove an item
											(if 
												(eq (count allItems) 0)
												(plymessage gPlayer "Unfortunately, the cargo hold is empty and nothing was stolen.")
												(block (itemDamaged)
													(setq itemDamaged (random allItems))
													(plymessage gPlayer" Pirates have taken " (itmGetName itemDamaged 8) "!")
													(objRemoveItem gSource itemDamaged)
													(objAddItem ship itemDamaged)
													)
												)
											;remove the overlay
											;(objRemoveOverlay sObj overlayID)
											(objRemoveOverlay gSource aoverlayID)
											)
									;do a switch here so I can add device destruction as an option
									;do steal cargo
										(block Nil
											;make escape pod and transfer some random items there
											(setq ship (sysCreateShip &scPirateEarthzone; gSource &svHimalSeparatists;))
											
											; pick a random item in the ship's cargo hold to damage
											(setq allItems (objGetItems gSource "*U -ID;"))
											
											;NPC= immediate removal
											(if
												(not(eq gSource gPlayership))
												(block Nil
													(objRemoveOverlay gSource aoverlayID)
													)
												;false= continue
												; Remove an item
												(if 
													(and
														(eq (count allItems) 0)
														(eq gSource gPlayership)
														)
													(plymessage gPlayer " Fortunately, your cargo hold is empty and nothing was stolen.")
													(block (itemDamaged)
														(setq itemDamaged (random allItems))
														(plymessage gPlayer" The pirates have taken " (itmGetName itemDamaged 8) "!")
														(objRemoveItem gPlayerShip itemDamaged)
														(objAddItem ship itemDamaged)
														)
													)
												)
												
											;remove the overlay
											;(objRemoveOverlay sObj overlayID)
											(objRemoveOverlay gSource aoverlayID)
											)		
									)
								)
						)
			</OnUpdate>
			<OnDamage>
				(switch
					; Skip if we are hit by a pteravore
					(eq aWeaponType &vtCargoSteal;)
						Nil

					; Overlay gets damaged
					(block Nil
						(if (leq (objIncOverlayData gSource aOverlayID "hp" (subtract 0 aDamageHP)) 0)
							(objRemoveOverlay gSource aOverlayID)
							)

						; We take all the damage
						0
						)
					)
			</OnDamage>

			<OnInsuranceClaim>
				; Insurance cleans up pteravores
				(objRemoveOverlay gSource aOverlayID)
			</OnInsuranceClaim>

			
		</Events>
	</OverlayType>
	
	<!-- Collision-->
	<ItemType UNID="&itCollision;"
			name=				"Collision Damage"
			level=				"10"
			value=				"0"
			mass=				"4000"
			frequency=			"notrandom"
			virtual=			"true"
			
			description=		"This happens when a wreck collides with a station."
			>
		<Image imageID="&rsItems1;" imageX="96" imageY="0" imageWidth="96" imageHeight="96"/>
		<Weapon
				type=				"missile"
				fireRate=			"30"
				powerUse=			"5"

				deviceSlots=		"0"	
				
				damage=				"thermo:6d24; momentum6; WMD7"
				missileSpeed=		"0"
				hitPoints=			"20"
				lifetime=			"10"
				maneuverability=	"2"

				directional=		"true"
				sound=				"&snMissileLauncher;"

				vaporTrailLength=	"16"
				vaporTrailWidth=	"110"
				vaporTrailWidthInc=	"5"
				vaporTrailColor=	"0xd0, 0xd0, 0xd0"
				>

			<Effect>
				<Image imageID="&rsMissiles4;" imageX="0" imageY="0" imageWidth="16" imageHeight="16" imageFrameCount="4" imageTicksPerFrame="1" randomStartFrame="true"/>
			</Effect>

			<HitEffect
					sound="&snArmorHit1;"
					>
				<Image imageID="&rsExplosionsAG128;"
						imageX="0"
						imageY="0"
						imageWidth="128"
						imageHeight="128"
						imageFrameCount="16"
						imageTicksPerFrame="2"/>
			</HitEffect>

			<Fragment 
					count=			"1"
					type=			"radius"

					damage=			"thermo:6d24; momentum6; WMD7"
					minRadius=		"1"
					maxRadius=		"4"
					missileSpeed=	"0"
					>

				<Effect>
					<Flare
							style=			"fadingBlast"
							radius=			"50"
							primaryColor=	"0xff, 0xff, 0xf0"
							lifetime=		"8"
							/>
				</Effect>
			</Fragment>

		</Weapon>
	</Itemtype>
	
	<!-- Centauri Base Ship -->

	<ShipClass UNID="&scCentauriBaseShip;"
			manufacturer=		"Centauri"
			class=				""
			type=				"base ship"
			score=				"140"

			mass=				"350"
			cargoSpace=			"250"
			thrust=				"200"
			maneuver=			"8"
			maxSpeed=			"10"
			rotationCount=		"24"

			leavesWreck=		"50"

			attributes=			"centauriWarlords"
			>

		<Armor>
			<ArmorSection start="315" span="90" armorID="&itLightPlasteelPlate;" areaSet="0,2" />
			<ArmorSection start="225" span="90" armorID="&itLightPlasteelPlate;" areaSet="3,4" />
			<ArmorSection start="135" span="90" armorID="&itLightPlasteelPlate;" areaSet="1,6" />
			<ArmorSection start="45"  span="90" armorID="&itLightPlasteelPlate;" areaSet="7,13" />
		</Armor>

		<Devices>
			<Device deviceID="&itBallistaCannon;"  secondaryWeapon="true" omnidirectional="true"/>
			<Device deviceID="&itCentauriHeavyCLAW;" posAngle="90" posRadius="10" secondaryWeapon="true" omnidirectional="true"/>
			<Device deviceID="&itCentauriCLAW;" posAngle="180" posRadius="10" secondaryWeapon="true" omnidirectional="true"/>
		</Devices>

		<Image	imageID="&rsCentauriBaseShip2;" imageX="0" imageY="0" imageWidth="96" imageHeight="96"/>

		<Items>
			<Item chance="60"	count="2d6" item="&itHelium3FuelRod;"/>
			<Table>
				<Item chance="25"	count="4" item="&itHeavyReactiveArmor;"/>
				<Item chance="10"	count="1" item="&itTritiumPropulsionUpgrade;"/>
				<Item chance="15"	count="1" item="&itMonopoleDeflector;"/>
				<Item chance="25"	count="4" item="&itCentauriNanos;"/>
				<Lookup chance="15" count="1" table="&trMinorItem2;"/>
				<Lookup chance="10" count="1" table="&trMajorItem2;"/>
			</Table>
		</Items>
		
		<AISettings
			fireRateAdj=		"30"
			fireAccuracy=		"70"
			perception=			"4"
			/>

	</ShipClass>
	
	<!-- Corporate Explorer -->

	<ShipClass UNID="&scCorporateExplorer;"
			manufacturer=		"Ringers"
			class=				"Hudson"
			type=				"explorer"
			score=				"705"

			mass=				"5000"
			cargoSpace=			"1500"
			thrust=				"2000"
			maneuver=			"8"
			maxSpeed=			"12"

			explosionType=		"&vtThermoExplosion2;"
			leavesWreck=		"100"

			attributes=			", ringers"
			
			>

		<Armor>
			<ArmorSection start="345" span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="330" span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="315" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="300" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="285" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="270" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="255" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="240" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="225" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="210" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="195" span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="180" span="15" armorID="&itQuadroCarbideArmor;" />

			<ArmorSection start="165" span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="150" span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="135" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="120" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="105" span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="90"  span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="75"  span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="60"  span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="45"  span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="30"  span="15" armorID="&itQuadroCarbideArmor;" nonCritical="general"/>
			<ArmorSection start="15"  span="15" armorID="&itQuadroCarbideArmor;" />
			<ArmorSection start="0"   span="15" armorID="&itQuadroCarbideArmor;" />
		</Armor>

		<Devices>
			<Device deviceID="&itMammoth100Deflector;"/>

			<Device deviceID="&itPositronLancer;" minFireArc="30" maxFireArc="175" posAngle="90" posRadius="5"/>
			<Device deviceID="&itPositronLancer;" minFireArc="185" maxFireArc="330" posAngle="270" posRadius="5"/>
		</Devices>

		<Items>
			
		</Items>

		<Image imageID="&rsCorporateExplorer;" imageWidth="192" imageHeight="192" />

		<AISettings
			fireRateAdj=		"15"
			fireAccuracy=		"95"
			perception=			"8"
			/>

	</ShipClass>

	<!-- Scarab Respawn Freighter -->

	<ShipClass UNID="&scScarabRespawnFreighter;"
			manufacturer=		"NAMI"
			class=				"Scarab"
			type=				"superfreighter"
			score=				"440"

			mass=				"20000"
			cargoSpace=			"15000"
			thrust=				"2000"
			maneuver=			"20"
			maxSpeed=			"6"

			explosionType=		"&vtBlastExplosion4;"
			leavesWreck=		"100"

			attributes=			"commonwealth,freighter,genericClass"
			>

		<Armor>
			<ArmorSection start="345" span="15" armorID="&itLightBlastPlate;" />
			<ArmorSection start="330" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="315" span="15" armorID="&itLightBlastPlate;" />
			<ArmorSection start="300" span="15" armorID="&itLightBlastPlate;" />
			<ArmorSection start="285" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="270" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="255" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="240" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="225" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="210" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="195" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="180" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>

			<ArmorSection start="165" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="150" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="135" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="120" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="105" span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="90"  span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="75"  span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="60"  span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="45"  span="15" armorID="&itLightBlastPlate;" />
			<ArmorSection start="30"  span="15" armorID="&itLightBlastPlate;" />
			<ArmorSection start="15"  span="15" armorID="&itLightBlastPlate;" nonCritical="general"/>
			<ArmorSection start="0"   span="15" armorID="&itLightBlastPlate;" />
		</Armor>

		<Devices>
			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="67" posRadius="32" minFireArc="0" maxFireArc="200" />
			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="35" posRadius="46" minFireArc="0" maxFireArc="170" />
			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="25" posRadius="53" minFireArc="300" maxFireArc="170" />

			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="293" posRadius="32" minFireArc="160" maxFireArc="0" />
			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="325" posRadius="46" minFireArc="190" maxFireArc="0" />
			<Device deviceID="&itSlamCannon;" secondaryWeapon="true" posAngle="335" posRadius="53" minFireArc="190" maxFireArc="60" />
			<Device deviceID="&itSlamCannon;" omnidirectional="true"/>
			<Device deviceID="&itMissileDefense;" omnidirectional="true" />
			<Device deviceID="&itClass5Deflector;"/>
			<Device deviceID="&it250MWReactor;"/>
		</Devices>

		<Items>
		</Items>

		<Image imageID="&rsLargeShips1;" imageX="1344" imageY="0" imageWidth="192" imageHeight="192" imageFrameCount="0" imageTicksPerFrame="0"/>

		<Names definiteArticle="true">
			superfreighter St. Aoki; superfreighter St. Beatrice; superfreighter St. Celendin;
			superfreighter St. Dominarus; superfreighter St. Elaine; superfreighter St. Florentine;
			superfreighter St. Goramesh; superfreighter St. Haldane; superfreighter St. Inez;
			superfreighter St. Jotur; superfreighter St. Kim; superfreighter St. Lin Chemei;
			superfreighter St. Miranda; superfreighter St. Navreen; superfreighter St. Orinaga;
			superfreighter St. Pelerine; superfreighter St. Queleborn; superfreighter St. Rebecca;
			superfreighter St. Salvador; superfreighter St. Tomashi; superfreighter St. Unami;
			superfreighter St. Voxanna; superfreighter St. Ha-neul; superfreighter St. Joo-eun;
			superfreighter St. Emiko; superfreighter St. Aiko; superfreighter St. Rumiko;
			superfreighter St. Bharati; superfreighter St. Madhavi; superfreighter St. Astrel
		</Names>

		<AISettings
			fireRateAdj=		"40"
			fireAccuracy=		"90"
			perception=			"4"
			combatStyle=		"standOff"
			/>		
	</ShipClass>
	
	
	<!-- Yoroi S250 -->

	<ItemType UNID="&itYoroiS250;"
			name=				"Yoroi S250 shield generator"
			level=				"5"
			value=				"16000"
			mass=				"3000"
			frequency=			"common"
			attributes=			"MajorItem; Specialty; Bushido"

			description=		"The Sung have modified this Yoroi S100 to provide more shielding."

			sortName=			"Yoroi shields, S250"
			>

		<Image imageID="&rsItemsBushido1;" imageX="0" imageY="0" imageWidth="96" imageHeight="96"/>

		<Shields
				hitPoints=		"170"
				regen=			"36"
				depletionDelay=	"360"
				powerUse=		"200"
				/>

	</ItemType>
	
	<!-- Slaver, Tech -->

	<ShipClass UNID="&scTechSlaver;"
			manufacturer=		""
			class=				"Tech Slaver"
			type=				""
			score=				"935"

			mass=				"9500"
			cargoSpace=			"500"
			thrust=				"3200"
			maneuver=			"8"
			maxSpeed=			"12"

			cyberDefenseLevel=	"6"

			explosionType=		"&vtBlastExplosion2;"
			leavesWreck=		"100"

			attributes=			"capitalShip, genericClass, sungSlavers"
			>

		<Armor>
			<ArmorSection start="345" span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="315" span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="285" span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="255" span="30" armorID="&itHeavySungArmor;" nonCritical="general" />
			<ArmorSection start="225" span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="195" span="30" armorID="&itHeavySungArmor;" nonCritical="drive" />
			<ArmorSection start="165" span="30" armorID="&itHeavySungArmor;" nonCritical="drive" />
			<ArmorSection start="135" span="30" armorID="&itHeavySungArmor;" nonCritical="drive" />
			<ArmorSection start="105" span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="75"  span="30" armorID="&itHeavySungArmor;" nonCritical="general" />
			<ArmorSection start="45"  span="30" armorID="&itHeavySungArmor;" />
			<ArmorSection start="15"  span="30" armorID="&itHeavySungArmor;" nonCritical="dev0" />
		</Armor>

		<Devices>
			<Device deviceID="&itParticleBoltCannon;"/>
			<Device deviceID="&itCyberDeckLowerShields;"/>
			<Device deviceID="&itCyberDeckDisarm;"/>
			<Device deviceID="&itParticleBeamWeapon;" secondaryWeapon="true" minFireArc="350" maxFireArc="190" posAngle="100" posRadius="50" posZ="0"/>
			<Device deviceID="&itParticleBoltCannon;" secondaryWeapon="true" minFireArc="350" maxFireArc="190" posAngle="100" posRadius="50" posZ="0"/>
			<Device deviceID="&itParticleBeamWeapon;" secondaryWeapon="true" minFireArc="170" maxFireArc="10" posAngle="260" posRadius="50" posZ="0"/>
			<Device deviceID="&itParticleBoltCannon;" secondaryWeapon="true" minFireArc="170" maxFireArc="10" posAngle="260" posRadius="50" posZ="0"/>
			<Device deviceID="&itYoroiS250;"/>
		</Devices>

		<Items>
			<Item				  count="2d6"	item="&itHeliumAssembly;"/>
			<Item				  count="40d40"	item="&itParticleBoltCartridge;"/>
			<Table>
				<Lookup chance="40" count="1" table="&trConsumables6;"/>
				<Lookup chance="40" count="1" table="&trMinorItem6;"/>
				<Lookup chance="20" count="1" table="&trMajorItem6;"/>
			</Table>
		</Items>

		<Image imageID="&rsMediumShips4;" imageX="384" imageY="0" imageWidth="128" imageHeight="128" imageFrameCount="0" imageTicksPerFrame="0"/>

		<AISettings
			fireRateAdj=		"25"
			fireAccuracy=		"95"
			perception=			"5"

			ignoreShieldsDown=	"true"
			/>

	</ShipClass>
	
	<!--Xenophobe Spam Event Handler -->
	<ShipClass UNID="&evXenoSpamEventHandler;"
			class=				"Xenophobe Spam Event Handler"
			virtual=			"true"
			
			attributes=			"baseClass"
			>
			
		<Events>
			<pwning>
				(block Nil
					;(PrintTo 'log (objGetObjById (objGetData gSource "Endlocation")))
					;(PrintTo 'log (SysFindObject gSource "N:150; AE"))
					;(PrintTo 'log (SysFindObject gSource "EN:150"))
					(if
						;run the disappear event check
							;disappear if we're withing 50 ls to exit point
						(ls (objGetDistance (objGetObjById (objGetData gSource "Endlocation")) gSource) 50)
							;true= run Disappear event
							(block Nil
								(objFireEvent gSource "Disappear")
								;(plymessage gplayer "Time to disappear!")
								)
							;false= pwn everything within 150 ls
							(block Nil
								;(plymessage gplayer "pwning!")
								(if 
									;there is something within 150 ls
									(SysFindObject gSource "AstEN:150;")
									(block Nil
										;attack closest 
										(block (victim)
											;(plymessage gplayer "you're dead!")
											(setq victim (SysFindObject gSource "NstAE"))
											;remember old orders
											(ObjSetData gSource "prevOrder" (shpGetOrder gSource))
											;cancel orders
											(shpCancelOrders gSource)
											;order attack
											(shpOrder gSource 'attack victim)
											;set as attacking
											(ObjSetData gSource "VictimAcquired" true)
											)
										)
									)
								)
						)
					)
			</pwning>
			<Disappear>
				(block Nil
					;(plymessage gplayer "Disappear event!")
					
					;disappear everything within 150 ls
						;D:xyz;    Only objects with data 'xyz'
						;(sysFindObject Nil "s D:0010201F_status")
					;if they can't gate out then just kill everything
						(enum (sysFindObject gSource "s N:150; D:Xeno") Variable
							(block Nil
								(if (iserror (objGateTo Variable "Elysium" "Start" &efStargateOut;))
									Nil
									(objGateTo Variable "Elysium" "Start" &efStargateOut;)
									;(plymessage gplayer "Gating out!")
									)
								)
							)
						;gate out the worldship and
						;create jump point
						(if (iserror (objGateTo gSource "Elysium" "Start" &efStargateOut;))
							Nil
							(block Nil
								(objGateTo gSource "Elysium" "Start" &efStargateOut;)
								(sysCreateStation &stXenoJump; (objGetObjById (objGetData gSource "Endlocation")))
								)
							)
					;create a black-hole thingy that lasts for a while
					;(sysCreateStation stationType position)
					)
			</Disappear>
			<OnOrdersCompleted>
				;when attack is done, resume old orders
				;(shpOrder gSource (ObjGetData gSource "prevOrder"))
				(shpOrder gSource 'goto (objGetObjById (objGetData gSource "Endlocation")))
			</OnOrdersCompleted>
			<OnEnteredGate>
				;(sysCreateStation &stXenoJump; (objGetObjById (objGetData gSource "Endlocation")))
			</OnEnteredGate>
		</Events>
	</ShipClass>
<!-- Xenophobe Jump Location -->

	<StationType UNID="&stXenoJump;"
		name=				"Xenophobe Jump Location"
		scale=				"star"
		sovereign=			"&svIndependent;"
		backgroundPlane = 	"100"
		
		>
	<Image imageID="&rsXenoJump;" imageX="0" imageY="0" imageWidth="512" imageHeight="512" imageFrameCount="0" imageTicksPerFrame="0"/>
	
	<Events>
		<OnCreate>
			(Block Nil
				(sysAddObjRecurringTimerEvent 5 gSource "Sun")
				(sysAddObjRecurringTimerEvent 30 gSource "ElysiumShock")
				;make it last 2-5 minutes
					;30 ticks-1sec
					;60 sec-1min
				;(sysAddObjTimerEvent (random 9000 18000) gSource "GateEnd")
				(sysAddObjTimerEvent 500 gSource "GateEnd")
				)
		</OnCreate>
		<Sun>
			(block Nil
			;(sysCreateWeaponFire weaponID          Nil posVector             dir speed objTarget [detonateNow])
			(sysCreateWeaponFire &itXenoJumpEffectsmall; Nil (objGetPos gSource) (random 0 359)(typGetDataField &itXenoJumpEffectsmall; 'speed) gSource)
			(sysCreateWeaponFire &itXenoJumpEffectmedium; Nil (objGetPos gSource) (random 0 359)(typGetDataField &itXenoJumpEffectmedium; 'speed) gSource)			
			(sysCreateWeaponFire &itXenoJumpEffectLarge; Nil (objGetPos gSource) (random 0 359)(typGetDataField &itXenoJumpEffectLarge; 'speed) gSource)			
			)
		</Sun>
		<ElysiumShock>
			(block Nil
				;if player is close, then gate to Elysium
				(if
					(ls (objGetDistance gPlayerShip gSource) 3)
					(objGateTo gPlayerShip "Elysium" "Start" &efStargateOut;)
					;(objGateTo gSource "Elysium" "Start" &efStargateOut;)
					)
				)
		</ElysiumShock>
		<GateEnd>
			(objDestroy gSource)
		</GateEnd>		
	</Events>
	</StationType>
	
	<!-- Xeno Jump Effect-small -->

	<ItemType UNID="&itXenoJumpEffectsmall;"
			name=				"Sun Damage"
			level=				"13"
			value=				"4000000"
			mass=				"15000"
			frequency=			"notrandom"
			virtual=			"true"

			description=		"The powers of the sun flow through here."
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="0" imageWidth="96" imageHeight="96"/>

		<Weapon
				fireRate=			"50"
				powerUse=			"8000"
				>

			<Missiles>
				<Missile
						type=			"missile"

						damage=			"plasma:12d8; WMD7; momentum5; EMP3;"
						missileSpeed=	"15"
						hitPoints=		"10"
						accelerationFactor="125"
						maxMissileSpeed="60"
						maneuverability="6"
						lifetime=		"360"
						
						noFriendlyFire=	"true"

						sound=			"&snRecoillessCannon;"
						>

					<Effect>
						<Flare
							style=			"fadingBlast"
							radius=			"10"
							primaryColor=	"0x33, 0x00, 0x33"
							
						/>

						<ParticleComet
								particleCount=	"200"
								primaryColor=	"0xFF, 0xFF, 0xCC"

								width=			"10"
								length=			"80"
								/>
					</Effect>
				</Missile>
			</Missiles>

		</Weapon>

	</ItemType>
	
	<!-- Xeno Jump Effect-Medium -->

	<ItemType UNID="&itXenoJumpEffectmedium;"
			name=				"Sun Damage"
			level=				"13"
			value=				"4000000"
			mass=				"15000"
			frequency=			"notrandom"
			virtual=			"true"

			description=		"The powers of the sun flow through here."
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="0" imageWidth="96" imageHeight="96"/>

		<Weapon
				fireRate=			"50"
				powerUse=			"8000"
				>

			<Missiles>
				<Missile
						type=			"missile"

						damage=			"plasma:12d8; WMD7; momentum5; EMP1; radiation1;"
						missileSpeed=	"15"
						hitPoints=		"10"
						accelerationFactor="125"
						maxMissileSpeed="60"
						maneuverability="6"
						lifetime=		"360"
						
						noFriendlyFire=	"true"

						sound=			"&snRecoillessCannon;"
						>

					<Effect>
						<Flare
							style=			"fadingBlast"
							radius=			"20"
							primaryColor=	"0x00, 0x00, 0x00"
							
						/>

						<ParticleComet
								particleCount=	"200"
								primaryColor=	"0x99, 0x99, 0x99"
								width=			"20"
								length=			"120"
								/>
					</Effect>
				</Missile>
			</Missiles>

		</Weapon>

	</ItemType>
	
	<!-- Xeno Jump Effect-Large -->

	<ItemType UNID="&itXenoJumpEffectlarge;"
			name=				"Sun Damage"
			level=				"13"
			value=				"4000000"
			mass=				"15000"
			frequency=			"notrandom"
			virtual=			"true"

			description=		"The powers of the sun flow through here."
			>

		<Image imageID="&rsItems1;" imageX="96" imageY="0" imageWidth="96" imageHeight="96"/>

		<Weapon
				fireRate=			"50"
				powerUse=			"8000"
				>

			<Missiles>
				<Missile
						type=			"missile"

						damage=			"plasma:12d8; WMD7; momentum5; radiation2;"
						missileSpeed=	"15"
						hitPoints=		"10"
						accelerationFactor="125"
						maxMissileSpeed="60"
						maneuverability="6"
						lifetime=		"360"
						
						noFriendlyFire=	"true"

						sound=			"&snRecoillessCannon;"
						>

					<Effect>
						<Flare
							style=			"fadingBlast"
							radius=			"40"
							primaryColor=	"0x33, 0x33, 0x33"
							
						/>

						<ParticleComet
								particleCount=	"200"
								primaryColor=	"0x99, 0x99, 0x99"

								width=			"40"
								length=			"200"
								/>
					</Effect>
				</Missile>
			</Missiles>

		</Weapon>

	</ItemType>
;TODO:
<!--

21=> alcrulean
5 ships per fleet => 4 fleets

list: a list of 5 numbers, 
the first is the UNID of the image resource as a number, 
the second and the third are the x,y coordinates in pixels of the resource image (from the top left corner of the image) 
the fourth and fifth are the sizes of the resource image in pixels. (first width then height)
item starts w/ 0


;(staSetImageVariant station variant)
;COMSOC missions for The Shrike
===== Doable =====
-mine clusters!
-wiki:
notes on registering to trac /forums/xelerus/wiki
-trac and wiki don't like caps for some reason

-trac:
	kinds of weapons inheriting sounds
-Katami- Sent 14 minutes ago: <RPC-phone> pm Drako about Syscreatestargates so that the Network does not rely on overwrites!


	
	
	
	R_P_C	digdug: is there a way so that when X type of weapon is fired, the weapon sound is Y?
	[13:52]	R_P_C	like energy weapon= energy fire sound?
	digdug	R__P__C, yeah, use inherit
	[13:53]	digdug	and the the base class put a onfireweapon event that makes the sound

	backup ships code from Drako Slyith
	(enum (sysFindObject gSource "s+Attribute*" ships
		(if (objGetOrderGiver ships)
			(block nil
				Backup Orders here
				)
			)
		)
		)

<!--
;code snippets:
<OnDestroy>
(block Nil
;remember the attacker
;gate in a Xeno ship
;tell Xeno ship to attack the destroyer then wander
)
</OnDestroy>
^^^^^ tack that onto the Xeno ships so that they respawn :D

-for baddies make Korolov shipping containers yield lots of stuff!
-insure NPC merchant ships!
-;CW repairer/ rescuer!
-tow hook
-make comets!
-;put in half-dead and survivor ships!

-have each ship have a "run away" code. use event handler or overlay? which ships should this not apply to?
	-Dragon Slaver
	-capships like the Phobos
	;if the object has twice the combat power OR it has armor 3 levels higher than its weapons -it has armor immune to the weapons-
		;cancel all orders
		;leave system
-autolooter looting too much
-faction takeover events?
-armor replacer wep
6. Baseships are very low-value targets, may be deliberate

7. Please make rare buildings like Tinkers/Korolov try to respawn multiple times/forever, they're rare enough already!
-problem: they have no "big" sov [SEMI-FEATURE]
Does (iserror (shpOrder ship prevOrder)) still evaluate if it works properly?
INCORPORATE PAPER FLEET!
HOLY CRAP!
(objSetDeviceFireArc obj deviceItem 'omnidirectional) -> True/Nil
I'll try to think up of a way to tell the player that it's safe to destroy a station.
;use (objGetImageDesc obj) to figure out where to cut off gravity!

;make a virus ship using navbeacons and maxspeed=0!


;mess with the HUD!
-make rocky compatible with Crystal Iocrym
;red and blue particlebeam!	
	;rsExplosionsA20G256 --- flames on asteroids!
	;tron effect [the tails] ships!
JUMPDRIVE EFFECT:
(objIncVel ship (sysVectorPolarOffset (ObjGetPos ship) (sysVectorAngle (objGetpos ship)) 1))
Ventari craft with device disrupt!
uranium barrel weapon!
===== /Doable =====








===== Has a big constant for O() =====

-Get sdw to tell me how to add mods to the .tdb
-get Star working on Sandbox stuff
-get tutorial on how to go Wings->Blender on the wiki
-carrier AI

-look at GIThub!
IRC Days:
interview people w/ big mods 


-friendly fire off func
;maybe you can fight your way out of the courthouse

Ptolemy:
	I think we can use the Aquila as a placeholder for the Ptolemy for now
	-	Carrier, launches gundams and such
		right now the first thing on my mind is to make it launch and repair the gundams and recall them
	I'll have to figure out things to do for the Ptolemy
	and make sure the gundams aren't so stupid that they die like a Gaian processor that walks up towards a Ringer shipyard....
	so I'm thinking survivability first
	-	also maybe a transam?XD
	R_P_C	tries to figure out how radiation gives ships a green tine...
	but should they have 1 hit kill weapons?
	I'm just wondering if the AI won't be too off	
	R_P_C	ok, give the GN armor lots of hp to survive a blast
[21:17]	R_P_C	and then it should be in survival mode if it is low enough armor, so it goes to ptolemy
[21:17]	R_P_C	if it dies, it ejects a super-fast DN enhanced escape pod that saves the pilot
[21:18]	R_P_C	and the gundam will be salvaged and operational after 10 real world minutes
	
-escape pod mod
-autoturret mod
-stats shower mod
DS in the playership config
NUMBERS:
	;#1-this mod

	; when capships die, like the DSAquila, spawn earthzones to gate!-- or go to nearest CWFleet station?
	;when the attacker is gone, find something w/ same sov and kill it

	;HELIOTROPE SOLAR STORM SUPER WEAPON!!!


	;have to find a way to have the aquila and CSC correlate
	;when the aquila is attacked, get the attacker and then have the CSC bombard with LAM's.
	; have the Ranx Mine!
	;Ares Retaliate
	; have Ranx DN have 'mining autons'
	
		;CW major attack
		;CW guard gate
		;CW maintenance ship and have a CW looter!
	;Ares major attack
		;Ares guard gate
	
		;add a virtual station that adds weapons[like the LAM], etc....
		;what about for the Ranx DN that has firearcs? --- I'll worry about that later
		
		
		;do an enum for the decrement function!

		;StarWeaver:	heliotropes should be able to do that at least, given the metatastic way solar works in the game
		
		;why aren't the freighters being escorted!
	
	;have capships "bleed" earthzones!
	
	;increase retaliationlevel by amount of stations the player has destroyed
		;I want it so that for sovs with many stations [like the CW and Sung], their retaliationlevel goes up slower, but for those with 
		;few stations will have their retaliationlevel shoot up the roof [like the Uraks]
			;ORRRR... make retaliationlevel go up by aDestroyer's killcount
			;Ex:
			;player [who else could rack up a killcount?] killed 1 sung satellite
			;sung sends wind slavers/ retaliation level goes up by 5
			;next sung satellite destroyed means
			;sung send steel slavers/ retaliation level goes up by 10. [5 for this one and 5 for the last one]
			;but you have to remember when the Sung should stop, as many sung Earth slavers in the retaliationfleet would be ludicrous
			;the player basically racks up retaliationlevel. ---should that actually be implemented?
		
	
	
	;For fleets:
	;fleet Ev handler
		;[objSetEventHandler targetObject handlerUNID]
	;check for: right space object
	;both segments are in
	;make sure ship/shp escorts leader
	;check if Target is different from ADestroyer for special events (i.e., not retaliate)
	
	;NEXT: Standardize theLeader, Ship, etc!
	
	;Do dynamic cnt's for major sovs!
	;[objGetName aWreckObj] and setq it!
	;the Ares Attack event includes Ships! Make it a station, then add the CSC to it!	
	
		;have a police force [use Zephyr!]
	
	;#2new mod
	;HUD improvements
	;advanced targeting to target individual segments!
	;sonar LRS
	;highlighting the damaged segment
	;we could make the damaged armor segment vent atmosphere to indicate damage.
		;and make the ship move b/c [losing air=force= ship being moved]
	;and some flame effect too!
	
	;GPS mod: galactic positioning system.
	
	;Korolov that has missions across systems! 

	;mod in an RPG7!
	;FLOOD gun/sov/weps
	;Oracus powers
		;rank of Heretic
	
	;to get a lamprey, you'd have to use the OnUpdate timer and then some on the overlay
				;increment Data
				;inc
				;inc
				;inc
				;if data is geq X, blow up as well as delete the overlay
					;sysCreateWeaponFire
				;have it stop firing
	
		;Flood:	
			;grunts
			;motherships that have smaller ships that have the weapon
			;How to proliferate?
			;have a Flood ev handler that has hundreds of flood spawning upon death?
			;if there are X amount, then make them come together and spawn a mothership
	
	
	;#4 other mods
		;Nerefir:
		;how to turn off devices!
			;use: (setq aresAlphaLeader (sysCreateShip &scTundra; pos &svAres; "fleetcommand"))
				;(fleetcommand)
			;and: (setq ship (sysCreateShip &scSandstorm; pos &svAres; "fleet"))
				;(fleet)
			;see how it goes!
	
	;MSU
	;Wing Blade -- that's an awesome name [from Hatsya Kanzaki]
	;give player GN particle field if by st. Kat's [make missions to get it!]
		-WEAPON SIM MOD
		;NEBULA BEER ADDICTION!
		;MINING PERMIT!-- 

-St Kat's arcology university to learn stuff! [resident-pyroman]That should be implemented. for a fee of 5,000 credits, you learn to install up to lv.IV items. 10,000 credits you can install up to lv. VII, and 50,000 cr. for tek lv. IX

;have the retaliation station spawn the baseships at the appropriate level system. then there will be a separate onObjDestroyed for them and the 
retaliation station will be the place where scripting is most involved.
-baseships:
	-Xenophobes
	-gaian
	-salvager nomads
	
-mineable planets--?
;Wiki editing standards page
-WAREHOUSE MOD!

;Ringers dammit!
		;I missed the Kobols!
		;apparently there are himals too!
		;svOutlaw
Zarb faction
Just what it says.
Thanks to Starweaver for insipration :D

-autopilot code for obiting nearest gravity well :D
-autopilot should have a "follow target" option- use ObjIncVel instead of ObjMoveTo?
-update baddies?
-factions should also attack the station [if any] that spawned the attacker
(setq angleRelShpFacing (lambda (shp) (add -90 (shpgetdirection shp)))))
do stations collide w/ each other?

-have arenas where you could bet on gladiators!
-have a fight every 5 minutes?
-if you make lots of money BM approaches you and you could join or fight them 
-fight=> attack their bases etc



-update Visible Damage: (make sure stations don't get blown by the stuff!-> also, repair NPC armor when docked?)
http://www.neurohack.com/transcendence/forums/viewtopic.php?f=5&t=4707


-fuel time left mod!

-omni slot/turret mod

-mod: smart ships:
they run away when they know you are invincible/ have earmor immune to their weps-> diff of 3 levels in wep and armor.
-issue: timesink:
several "starts" in the game
I like the recycling mechanic. It would be a nice mod.
=====/Has a big constant for O() =====

===== Fantasy =====
;clean up this .xml

-AI to play the game for you :P
get rid of mayfly's dependence on separate ADVLRS
;for barrelroll- have dynamically changing Interaction rates!

irc://freenode/transcendence
irc://freenode/transcendence-sandbox
irc://freenode/%23%23mecha


;Carrier AI!:
	;release fighters
	;recall fighters
	;repair fighters
	;settings.xml?
		;fleet formation and battle tactics!
		
;different image for capships
	;check is total # of segments
;fix baddies- try to enact most changes from forum post!

Test structs {}!
?- gate ID's and 7
how to work with them
-difference between 
(sysGetStargates (sysGetNode))
and 
(sysGetStargates)?
-> perception?

-;get rid of DySys's dependence on Vanilla Override- that should be optional.
{-static data 
	-factions
	-types of ships
	-????
	^^^ make it easier to add to code!
	-make a list of all retaliate #'s and just do one enum for the decrement event
	}

	;res-pyroman's suggestions:
		:like, every tenth sandstorm has a Cydonian shields and EMP cannon.
			R_P_C	but I'll switch an Ares lightning turret for 2 positrons for the Phobos
			]	Resident-Pyroman	Ooh. got another one: every tenth Xenophobe Worldship has a NAMI heavy launcher.
			Resident-Pyroman	watches a clip showing Aquilas bravely defeating tundras and Sandstorms...
			Resident-Pyroman	a clip advertising the 1M battle auton: buy now!
			
===== Sandbox-Related =====
-sandbox topo generator
	-have lots of helper funcs?
===== Sandbox =====
	;Sandbox:	
	; an explorative Roguelike
		;copy T's topo
	;Freighter	-glacier
	;Sapphire	-rogue
	;Wolfen		-fighter
;Setting:						Physical Heaven
;Plot:							Madden Into Misanthropy
;Narrative Device:				Supernaturally Delicious And Nutritious
;Hero:							Reckless Pacifist
;Villain:						This Cannot Be
;Character As Device:			Mafia Princess
;Characterization Device:		Smart People Play Chess

	;modlist:
		;baddies
		;Nerefir
		;Tutorial Station
		;sandbox
			;wombat ideas: 
				;skills
				;story
		;Sol-St.Kat's gates
	;flak, flare weapons
	
;Sandbox: 
	;corp vs Anarchists:
		;corp has subliminal messaging, anarchists fight back by blowing up ad stations

	plan:
Sand:
1.carrier AI
	<RollCall>
		;look for ships that are escorting this ship and register them
	</RollCall>
	<Send>
		(block Nil
			;if
				;there is an enemy ship at 100 ls
					;scramble fighters
			)
	</Send>
2.turret mounts
	
;Sandbox: 
	;d1gdug: can you make enhanced weapons also take more reactor power? It makes no sense to just use something random to enhance a weapon.
	;you can't add a virtual item that does the reactor drain? or invisible, invincible overlay that slowly sucks fuel?

	
;plan for Sand:
	;have empty systems
	;have an approach based on topo:
		;closeness to base
		;increase percentage 
		
		(setq sovGetDistancetoCapital 
	(lambda ()
		(block Nil
			)
		)
	)

;For sandbox:
	;different systems for different topoplaces! [so that stations aren't spawned stupidly] --?????
	-->
	<!--
===== Sandbox System Spawning =====
stargate dockscreen -> choice to gate to different systems
-system ideas:
forcegen systems
because I want to have 'hubs' of power that have their influence fade over time
-this means that when 5 systems from ST. Kat's to Anhault means that there is heavy fighting in the middle system between 
the two whereas if there are 15 systems there might be a huge stretch of systems that are "no man's land".
-have a system for all planets-> Make it like a RW CD where you can suspend everything from one system and resume when you go back
-also, have planets spawn ion cannon and stuff, would be cool :D

Sandbox:
small goals:
System generator
immersive system:
-comets
-moving planets
-two stations attacking each other
-ferians actually mining
-cool backgrounds with stuff made from Luminous

===== Sandbox Idea Page on Wiki =====
;SANDBOX
;system spawning
	;adding factions
		;CW, Ringer, Ares
		
-econ would start out with vey vague and general rules, and then it would work-- it doesn't have to be perfect, it should just work.
		;basically buy/sell rules and changing the buy/sell margin accordingly

1.	System Spawner Syntax:
-create environments like rad cloud
<SystemSpawner>
	;sun
	;planets
	;asteroids
	;environment-
		;nebula
		;rad cloud
		;specify some background image w/ parralax level
	;TODO
		;choose embellishment[s]
			;nebula, Heretic particles,
		
		
		;choose factions
			;get a list of factions from the node's faction desc
			;place stations
</SystemSpawner>

Sandbox Base (SB): 
1. Topology	 - Drako
2. Faction reputation system - Use(?) Dynamic Soverigns need ways to ally/befriend factions [Some tweaking needed] DONE!
3. Dynamic systems	 - Stations respawn too fast 
4. Additional Weapons	 - WE4 D1gdug -does not like plyshipchanging :( 
5. Advanced Long Range Scanner	 - DONE!
6. What to do with mods that are huge like Playership Drones 

Fluff (FF):
1. Anomalies - Drako DSMK2 
Djohaal: 
1a.random idea for blackholes 
1b.they'll have a ring of collision area that deals heavy dark matter damage 
1c.(dark acid/metal/fire whatever) 
1d.and then a inner circle where if your ship ends up it'll hyperjump you to a random system 
1e.the idea is, if your ship is badass enough to survive the outer ring, you gain a free random jump :D 

2. Sovereign expansions	 - See: http://neurohack.com/transcendence/forums/viewtopic.php?f=25&t=4400 
Ares Extension	 - DONE!
3. Dynamic Economy 
4. Advanced Targeting 
5. CW Radio
hailing calls and radio chatter 
6. Bank Faction 
7. Planet Stuff
Orbit	 - Framework done
Landing	 - Need to get backgrounds for planet surface, nebulas for land
8. NPC mining
Option 1 
-have a ship that shoots at all asteroids
-have a scavenger ship that collects ore
Option 2
-have a ship that shoots and collects ore (like what shpOrder 'mine was supposed to do) 
9. NPC rescue missions
10. Civilian ships for each faction 
11. Tutorial
12. mining permit 
Need to do illegal mining reactions of: 
ferians 
ringer 
Ranx 
Ares 
CW 
13. Empire Expansion -player creates empire 
14. ship scale decontamination sprays- little ships that have a weapon to decon 
15. Why IAV's look standardized: http://neurohack.com/transcendence/forums/viewtopic.php?f=2&t=4428&p=41023#p41023 
16. Sun does damage and gravity
17. Use Djohaal's galaxies and Ttech's galaxies 
18. go through dvlenk6's stuff! 
19. http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=888 :D 
20. Trap roms that do bad enhancements 
21. REAL autopilot 

22. different player starts: 
Sung Start:
Steel slaver ship

Ares Start:
Tundra ship

CW Starts:
the Vanilla ships

Ranx Start:
Ranx gunship


Mission ideas: (they are old threads so NO necromancy!) 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=894 
new ship call in 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=892 
new insurance func 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=895 
item bank 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=886 
more escort 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=893 
auton and smuggler's cargo hold 
some undone ideas from here: 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=934 
more missions: 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=905 
Expand CW fleet: 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=977 
;expand 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=1014 
BM ideas: 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=876 
http://neurohack.com/transcendence/forums/viewtopic.php?f=3&t=910 

TODO:
SB:
# 2 3 4
FF:

Discussion:
Class based system
Playerships [Keep the original three or make new ones?]
	
===== Class System for Sandbox =====
;Classes:
;1.fighter
;2.rogue
;3.merchant/trader

;characteristics:
;1.mining
;2.system exploration
	;-The_Shrike:	Option 1: Scan orbiting objects....does free return around the asteroid fields and planets.
	;-The_Shrike:	Option 2: Go X ls this way, then come back
	;-The_Shrike:	And use comlinks and a map update to send the data back.
;3.item repairing
;4.item identifying
;5.loot maximisation
6.trading
;7.fuel efficiency
;8.ship repairing
;9.smuggler

;redux:
	;1.fighter
		;3.item repairing
		;7.fuel efficiency
		;8.ship repairing
	;2.rogue
		;9.smuggler
		;2.system exploration
		;4.item identifying
	;3.merchant/trader
		;5.loot maximisation
		;1.mining
		6.trading
;mining, explorating, item repairing, identifying, looting, trading, smuggling, ship repairing


;1. engineer
;2. explorer
;3. pirate
;4. police/CW militia
;5. miner
;6. 
;7. 
;8. 
;9. 

;exploring
;identifying
;trading
===== System Name Ideas =====
Major:
CW
Ares 
Minor:
Sung 
Ranx
Unaffiliated:
independent
theif/pirate

2 galaxies:
Vanilla:						The Bound:						Triad territory????

5 systems:
1.Umbra
CW
2.Candela
Sung
3.Prenumbra
independent/pirate
4.Steradian
Ranx
5.Antumbra
Ares

===== Tutorial System Idea =====
;Formal Transcendence tutorial to surviving! a Commonwealth Experience.
;idea by DSMK2
;Where is this(?): Eridani deepspace

;-- BASIC TUTORIAL MISSIONS --
;1 Fly ship to the station (Instructor ship flies up to you, will follow you until you finish basic missions, will follow you again when you choose to start advanced tutorial missions)
;-- Feel free to shoot the instructor to get massively raped -> Game over
	;2.a Dock with station once in range
	;2.b Faux illegal item confistication
	;2.c Basic station functions (getting ferried from desk to desk)
	    ;2.c.1 Installing stuff: This takes you to step 3, Shooting exercises, Sisters of Dominia should cover the "find devices" part (?)

;2 Shooting exercises (These toss you tutorial purpose weapons, can't hurt anything other than paper)
;-- Get targetting ROM here?
	;3.a Firing primary weapon
	;3.b Switching weapons
	;3.c Firing missiles
	;3.d Omni-Directional weapons (?)
	;3.f Taking damage (damage control)
	;3.e Looting and accessing the Ship status screen
	
;3 Useables (Necessary?)
	;4.a Armor coatings (low quality paste)
	;4.b ROMs
	;etc. etc. etc.

	
	
;-- ADVANCED TUTORIAL MISSIONS --
;4 Mining (Get rocks, sell back, recycled into new, bigger rocks for other new pilots)
;5 Decon (Fly here, get contaminated, fly back, get decontaminated)

;-- FINISHING --
;6 Short warp gate to Eridani


;-- Other --
;7 NPC ships failing tutorial missions massively!
===== /Fantasy =====
-->
<!--RANDOM:
=======================================================================
 Will there be an official trailer to introduce new people to the game?
http://answers.yahoo.com/question/index?qid=20070328183454AALLqHv
----
community:
-wiki editing standards page
-script style-taben's doing that
-
;wiki pages:
Wiki editing standards page
how to add pages onto wiki:
how to delete pages
how to add images
spoilers at bottom and whatever Curudan said

how to do the ring around Phobos trick:
[00:16]	Curudan	I just pasted the basic phobos image in paint.net
[00:16]	R_P_C	ok
[00:16]	Curudan	Added a new layer.
[00:16]	R_P_C	ok
[00:16]	Curudan	Made a circle to cover the whole thing.
[00:17]	R_P_C	how did you know the angles?
[00:17]	Curudan	Centered the cursor in the middle of the image, and drew lines outward.
[00:17]	Curudan	Holding down control with the line tool.
[00:17]	Curudan	That'll keep the lines at angles of 15.
[00:17]	R_P_C	ok
[00:18]	R_P_C	Curudan: what was the quick message?
[00:18]	Curudan	That was the quick message.
[00:18]	R_P_C	
[00:18]	R_P_C	ok, thanks
[00:18]	R_P_C	gn
[00:19]	Curudan	Right, it's shift, not control.
[00:19]	Curudan	Goodnight.
[00:19]	<--|	Curudan has left #Transcendence

Legend:
-> denotes a link to other pages
a tab indicates something is within a header, or a page

main page
	general overview of Trans
	Account Activation	
	Reporting Bugs
	Players			
		FAQ
		Getting Started
			Choosing Your Ship  There is nothing you can't do with a ship, but they are geared toward different play-styles.
			Equipment for the Early Game
			Atarlost's Guide to Weapons
			Prophet's Guide to Misc Devices
		Gameplay
			Items index			
			Wolfy's Starship Guide  Identification Chart inluded
			Stations  For trade, missions, or blowin' up.
			Factions  Who's who in the galaxy.
			Domina Powers  The mysteries of the Invoke command
		Other Information
		Configuration
			Player's Guide to Mods
			Settings.xml  Keybinding and configuration
			Command Line Switches
		Intro Screen Keys
		
		Community: work on this Ttech!		
			The official Transendence Site is where George Moromisato hosts the official stable version of the game.
			There are five main venues for the Transendence community:
			The Official Forums
			[IRC explanation here]
			IRC (Instant Web Access!)  Full of modders and community staff.
			This Wiki  be aware of the Rules
			Xelerus Mod Database  Also has rules for mod uploaders.
			The Bug Tracking System
			Community  ??
			Talk Pages  On the wiki ??
		
	modders
		Version history
		changelog
		->Functions index- should we keep this, it's a bit outdated?
		mod projects
			Sandbox
			official Extensions
		weapons page
		events page


====== RPC's Modding Index ======
This is a list of links for all those up-and-coming modders.



Tutorials:

[[weapon_devices]]
[[events]]
[[legend]]


====== Mods ======
[[mods:recommended]] <-- out of date
http://dvlenk6.blackraven3d.com

UNID database

how to make a module
http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=3309

PASTEBIN!
paste.neurohack
MOTM vote

http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=1072
"planetary Systems"
http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=1925
"method for a random gateway builder"

IRC
http://webchat.freenode.net/?nick=Heretic.....&channels=transcendence&uio=Mj10cnVlJjk9dHJ1ZSYxMT0xNTQ3f

Mods:
Xelerus:
http://xelerus.de/doc_function_txt.php
MOTM:

Interesting Forum threads:
"Making Stargate Topology"
http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=4006
"Making a System"
http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=4007
"Modding 101: A Tutorial On How to Create A Playership Mod"
http://neurohack.com/transcendence/forums/viewtopic.php?f=8&t=2173
-->
<!--
===== Random Lists =====
Random lists:
;stations 
;on the recontruction event:
	;if we're making any of these stations
	;then don't send the freighter!

	(if 
		(or
			(eq (ObjGetType aObjDestroyed) &stArcoVaughnHabitat; )
			(eq (ObjGetType aObjDestroyed) &stMakayevFactory; )
			(eq (ObjGetType aObjDestroyed) &stRasiermesserFactory; )
			(eq (ObjGetType aObjDestroyed) &stHereticStation; )
			(eq (ObjGetType aObjDestroyed) &stCommonwealthResearchHeretic; )
			(eq (ObjGetType aObjDestroyed) &stRingersResearchHeretic; )
			(eq (ObjGetType aObjDestroyed) &stSistersResearchHeretic; )
			(eq (ObjGetType aObjDestroyed) &stTVX1Outpost; )
			(eq (ObjGetType aObjDestroyed) &stAresResearchHeretic; )
			(eq (ObjGetType aObjDestroyed) &stMaryamsArchive; )
			(eq (ObjGetType aObjDestroyed) &stMRADSensor; )
			(eq (ObjGetType aObjDestroyed) &stLogBuoy; )
			(eq (ObjGetType aObjDestroyed) &stHereticControlCenter; )
			;(eq (ObjGetType aObjDestroyed) &; )
			)
		;if the conditional is true:
			;Nil
			(plymessage gplayer "ha! take that unique station!")
		;false [we're okay to make the station]
			;whatever I did to make it happen
		)
	LIST OF UNIQUE STATIONS
arco vaughn			stArcoVaughnHabitat
makayev factory		stMakayevFactory
					stRasiermesserFactory
					
					heretic stations:
					stHereticStation
					stCommonwealthResearchHeretic
					stRingersResearchHeretic
					stSistersResearchHeretic
					stTVX1Outpost
					stAresResearchHeretic
					stMaryamsArchive
					stMRADSensor
					stLogBuoy
					stHereticControlCenter
					
	
	sovlist:
		;Centauri					-svCentauriWarlords
	;Charon						-svPirates
	;Marauders					-svMarauders
	;illegal miners--			-svSettlers
	;Urak Warlords				-svUrakWarlords	
	;Black Market				-svBlackMarket
	;Sung Slavers				-svSung		
	;Dwarg Raiders				-svDwargRaiders		
	;Huari Empire				-svHuariEmpire
	;Ventari Settlers			-N/A
	;Bennin Xenophobes			-N/A
	;Gaian Terraformers			-svGaianTerraformers
	;CW							-svcommonwealth
		;CW rogue fleet			-svRogueFleet
	;Ares						-svAres
	;Ranx						-svRanxEmpire
	;Ringers					-svRingers
	--------
	 (svCult)
	(svIndependentTrader)
	(svOutlaw)
	(svHimalSeparatists)
	(svAnarchists)
	(svKobolWarlords)
	(svIndependentTrader)
	(svFerianMiners) /(svFerianMinersAngry)
	
	(svDestructiveOrder)
	(svDestructiveChaos)
	(svDestructiveOrder)
	(svAresHeretic)
	
;List of sovereigns:
	;Centauri					-svCentauriWarlords
	;Charon						-svPirates
	;Marauders					-svMarauders
	;illegal miners--			-svSettlers
	;Urak Warlords				-svUrakWarlords
	
	;Black Market				-svBlackMarket-- they have their own
	;Sung Slavers				-svSung
		; disable protective ships and kill people--- from Ttech
	;Dwarg Raiders				-svDwargRaiders
		; Dwarg master and Behemoth EMP immune!
		; what do they raid?
	;Huari Empire				-svHuariEmpire
	;Ventari Settlers			-N/A
	;Bennin Xenophobes			-N/A
	;Gaian Terraformers			-svGaianTerraformers
	;CW							-svcommonwealth
		;CW rogue fleet			-svRogueFleet
	;Ares						-svAres
	;Ranx						-svRanxEmpire
	;Ringers					-svRingers
	;the Iocrym have a sov too!	
	
	
	
	list of sovs:
svIndependent
svFriendlyAuton
svDefectiveAuton
svIndependentTrader
svCult
svOutlaw
svSettlers
svGaianTerraformers
svAnarchists
svCSCAntarctica
svFleetAssassins
svAres
svGladiator
svBlackMarket
svCentauriWarlords
svPirates
svCommonwealth
svCommonwealthFleet
svCorporate
svDomina
svDwargRaiders
svFriendlyZoanthrope
svFerianMiners
svFerianMinersAngry
svHeliotropes
svHimalSeparatists
svHuariEmpire
svKobolWarlords
svMarauders
svAresHeretic
svSentinelAI
svIocrym
svFriendlyLuminous
svPlayer
svRingers
svRogueFleet
svSistersOfDomina
svSung
svSungSlaves
svUrakWarlords


svDestructiveOrder
svDestructiveChaos
	-->

<!--
===== Old Sig =====
Older Sig:
<Pontius> 4chan makes me happy when im sad.
Old Sig:
<The_Shrike> I made the Awesome Cannon. Which is currently beaten by the 
nyan cat in terms of "Oh my god what have you done?!!" responses.
<Disst> When I try to play Dynamic Systems I can only fly a ship called the Nerefir that has 
a bunch of crazy shit on it and I start off in some sort of limbo between Hell and space
<Atarlost> I think [Dynamic Systems and The Network are] still separate, but I 
think they're compatible. It's not recommended unless you're a masochist though.
Old sig #2:
Don't be absurd! No such attempt has, or ever will be made by any man
 who so much as understands the word! For a thing to be called "epic," 
it must be enduring! It must withstand the ravages? of time, bowing not 
to the wind or the rain or the motion of the very earth! To be epic is to 
be immortal! Those words and deeds which endlessly live on in the minds 
of man, whether through fear or admiration. Therefore to be epic in one's 
own life is impossible, yet it is for that that we must strive!
-Memphismastermind

<AzziWeaver> RPC: You have fair leaderships skills yourself, you hade more of a problem with people flaking out of the community
<AzziWeaver> You can't leader your way out of that
-->
<!--
;V5.b TODO:
I used to have a message that said when each sovereign cooled down, but it was more distracting than helpful. 
I'll try to think up of a way to tell the player that it's safe to destroy a station.


	Maybe store some values, like how strong the specific factions are in a system, and if one faction is nearly completely wiped out, they should not be able to reconstruct a huge fortress just two screens away from a bunch of their strongest enemies fortresses.

Maybe some "influence" or "power" rating that influences the probability and speed of respawning could be useful? This rating could then be modified by doing missions, destroying stations, etc.

-make cleanup services or friendly gaians so that game doesn't clutter up.
	-now gaians die at the sun :/
-Base ships
<Twir> EX: a charon frigate flies around the system, looking for hostile faction
<Ttech> :P
<Ttech> hence the impossible?
<RPC> derp
<RPC> not system
<RPC> a station gets destroyed
<Twir> sovergins send in fireteams to try to stake a presence in the system
<RPC> only when stations are destroyed do they fight
<RPC> I'm still trying the "stake presence" idea
<RPC> but that requires complicated AI >.<
<Twir> those conflict, with a capship acting as a station
<Twir> kill the capship, a retalation fleet forms to get revennge and repair the capship
<RPC> Twir, yeah, that's the ideal DySys :D
<Twir> kill the revenge fleet, no more encounters of them in that system
<Twir> just set the baseships to patrol
<RPC> hmmmm
<RPC> I think I can do that for V5, yeah 

DONE:
V5.b fixes:
-borers don't show up from destroyed mining colonies
-mining check is to 15 ls.

V5.b:
Mining AI for early mining colonies. Not added to ferians b/c of the lag issue
names of X atks Y fixed ??
retaliation ships no longer follow to Elysium
celestial movement [separate mod]
	-issues: movement may mess up some missions, like the refugees and the waypoint CW militia one

-station graphics:
	Patupi thanks:
		-small destroyed station
		-overlays
			-small stations need the wreck or they can't reconstruct.
			-you also need to shoot the construction overlays off. if it's not near the edge, try again ;)
V5.a
Make freighters have a "pickup" service if it's destroyed.
-pirate- CW retaliate and send a fleet after you
-utility pack:
;have autolooter say what state it's in
-autopilot uses same hotkey for autons

V5
-separated Gravity and utility items into their separate mods (so that it's easier to keep track of which ones are latest/up to date)
1. "The Commonwealth attacks!" with no enemies to attack, so just dumps ships into system, then they gate out after a bit.-hopefully fixed

-fix respawning to include the respawn station!
-turret slot system-> PM beat me to it XD
-generic attack fleets
-excluded stCommonwealthTurret and the Sung turret!
	-stCommonwealthTurret
	-stSungDefenseSat1
--RPCattack fleet issue:
	they're attacking dead stations :/ -- Not anymore!
2. Flight paths straight through the sun=ouch. must be a way to designate no-fly zones? [FIXED]
3. Problems with Korolov if the Charon Stronghold gets boomed by a faction. May be deliberate? [IS FEATURE]
4. Enemy Wolfen spawns in early systems=overpowered. [IS FEATURE]
5. Stations spawning in destruction zone of sun? [FIXED]
-stations within 60 ls get moved to 70 ls away from sun
-;fix worldship infinite spam
-escorts for respawn ships

UTILITY PACK:
-autolooter doesn't autoloot in a new system [DONE]

=== AlignBars ===
<div style="margin-left:2em">

Bars will always be drawn at equal distances. This command specifies whether the bars should be spaced as much apart as possible, or some white space should be reserved between the left/top side of the chart and the first bar or between the last bar and the right/bottom side of the chart.

; early ''(default)''
: The first bar will be placed on the leftmost/topmost position of the chart ('glued' to the axis), leaving space between the last bar and right/bottom side of the chart.

; late
: Opposite from ''early'': the last bar will be placed as far to the right/bottom side of the chart as possible, leaving space between the axis line (left/top side of chart) and the first bar.

; justify
: The first and last bars will be placed as far apart as possible, leaving no empty space on either side of the chart. When only one bar is present, justify will be interpreted as "centered".

The exact alignment depends on the orientation setting in the [[#TimeAxis (mandatory)|TimeAxis]] mandatory command.

<small>Examples:</small>
{|border="0" cellspacing="0" cellpadding="2" bgcolor="#F7F8FF" class="wikitable"
|-
!style="background:#EEEEEE"| Alignbars =
!style="background:#EEEEEE"| early
!style="background:#EEEEEE"| late
!style="background:#EEEEEE"| justify
!style="background:#EEEEEE"| (default)
|-
!style="background:#EEEEEE"| TimeAxis = orientation:horizontal
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = early

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:horizontal
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = late

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:horizontal
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = justify

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:horizontal
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:horizontal
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|-
!style="background:#EEEEEE"| TimeAxis = orientation:vertical
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = early

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:vertical
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = late

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:vertical
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20
AlignBars  = justify

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:vertical
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|
<timeline>
ImageSize  = width:90 height:120
PlotArea   = width:65 height:80 left:20 bottom:20

DateFormat = yyyy
Period     = from:1 till:5
TimeAxis   = orientation:vertical
ScaleMajor = unit:year increment:1 start:1

PlotData=
  color:red width:10
  bar:A from:start till:end
  bar:B from:start till:end
  bar:C from:start till:end
  bar:D from:start till:end
</timeline>
|}

</div>


-->

	<!--Steps:
	1. In the OnCreate event, set the "retaliationlevel" of your sovereign
	2. Also set the "decrement" timer to lower the retaliationlevel over time in the <OnCreate> tag. 
	3. Use SovTest in the <OnObjDestroyed> to fire the desired event
	4. Then, determine whatever retaliation event you want 
		note: a helpful function is switch and 
				use something like
				(not (eq (objGetSovereign aDestroyer) Nil))
				so that the sov does not retaliate to a 'Nil' destroyer, like an explosion from a capship
	
	
	set the OnCreate
	Decrement
	sovTest
	Retaliate
	
		optionsl: <special event here>
	-->
	
<StationType UNID="&stVirtualRespawnStation;"
    name=               "Virtual Respawn Station"
    scale=              "world"
    backgroundObject=   "true"
    sovereign=          "&svIndependent;"
	attributes=			"DySysRespawner"
    >
    <ImageVariants>
        <Image          imageID="&rsWorlds2;" imageX="0" imageY="0" imageWidth="1" imageHeight="1" />
    </ImageVariants>
    <Events>
		<OnCreate>
			(block Nil
				;(plymessage gplayer "new spawn created")
				(ObjSetData gSource "start_time" (unvGetTick))
				)
		</OnCreate>
		<Respawn>
			(block (Time)
				;if there is a time datum already:
					(if 
						(ObjGetData gSource "Time")
						;do nothing
						Nil
						;else: add it
						;change
						(ObjSetData gSource "Time" (random 20000 40000))
						;(ObjSetData gSource "Time" 1000)
						;(ObjSetData gSource "Time" 30)
						)
				(if
					(or	
						(and 
							;it hasn't been spawned yet
							;if freighter is near
							(ls (ObjGetDistance (ObjGetObjByID (ObjGetData gSource "IncomingFreighter")) gSource) 20)
							(not (eq (ObjGetData gSource "GraphicSpawned") true))
							)
						
						;OR half the time has passed AND freighter is gone :? 
						
						;AND it hasn't been spawned yet
							;controls respawn timing
						(and
							;(gr (subtract (unvGetTick) (divide(ObjGetData gSource "start_time")2)) Time)
							(gr (subtract (unvGetTick) (ObjGetData gSource "start_time")) time)
							(not (ObjGetObjByID (ObjGetData gSource "IncomingFreighter")) gSource)
							(not (eq (ObjGetData gSource "GraphicSpawned") true))
							)
						)
						(block (NewStation sov)
							(setq oldstation (ObjGetData gSource "TheRealOldeStation"))
							;(setq NewStation (SysCreateStation &stRespawnStation; (ObjGetData gSource "newstationlocation")))
							;set the image variant:
								(switch
									;sung turret:
									(eq (ObjGetData gSource "oldstationUNID") &stSungDefenseSat1;)
										(block Nil
											(setq NewStation (SysCreateStation &stRespawnStation; (ObjGetData gSource "newstationlocation")))
											(staSetImageVariant NewStation (random 2 3))
											(objRegisterForEvents gSource NewStation)
											;destroy the old station
											(ObjDestroy (ObjGetObjByID oldstation) gSource)
											(ObjSetData gSource "OldStationDestroyed" true)
											)
									;small station
									<!--
									korolov construction is 224 x 224
									small image is 213 x 171 which is (staSetImageVariant NewStation 1)
									170 < width < 200
									150 < lentgh < 200
									-->
									(and
										(and
											(ls (item (objGetImageDesc (ObjGetObjByID oldstation)) 3) 200) 
											(gr (item (objGetImageDesc (ObjGetObjByID oldstation)) 3) 170) 
											)
										(and
											(ls (item (objGetImageDesc (ObjGetObjByID oldstation)) 4) 200)
											(gr (item (objGetImageDesc (ObjGetObjByID oldstation)) 4) 150)
											)
										)
										(block Nil
											(setq NewStation (SysCreateStation &stRespawnStation; (ObjGetData gSource "newstationlocation")))
											(staSetImageVariant NewStation 1)
											(objRegisterForEvents gSource NewStation)
											(ObjDestroy (ObjGetObjByID oldstation) gSource)
											(ObjSetData gSource "OldStationDestroyed" true)
											)
										;place random construction overlays and destroy station later
										;set oldstation destroyed data
									;smaller than 
									<!--
										width < 170
										lentgh < 150
									-->
									(and
										(ls (item (objGetImageDesc (ObjGetObjByID oldstation)) 3) 170)
										(ls (item (objGetImageDesc (ObjGetObjByID oldstation)) 4) 150)
										)
										;uses the "overlay" stations
										(block (wid hig less)
											;issues: 
												;newstation is still there, use staSetImageVariant to give a dummy file?
												
											(PrintTo 'log(setq wid (item (objGetImageDesc (ObjGetObjByID oldstation)) 3)))
											(PrintTo 'log(setq hig (item (objGetImageDesc (ObjGetObjByID oldstation)) 4)))
											(switch
												(leq wid hig)
													(setq less wid)
												(ls hig wid)
													(setq less hig)
												)
											(PrintTo 'log "less")
											(PrintTo 'log less)
											(PrintTo 'log(setq LSconversion (divide less 24)))
											(for i 0 (random 3 10) (block (stationhere)
												; NOTE: scaffolding needs station wreck to work o.O
												;change the pos from wreck to virtual respawn station
												;(setq stationhere (sysCreateStation &stReconStation; (sysVectorPolarOffset (ObjGetPos (ObjGetObjByID oldstation)) (random 0 360) (random 0 LSconversion))))
												;(PrintTo 'log "does gSource for virt station not work?")
												;(PrintTo 'log (ObjGetPos gSource))
												;(ObjGetData gSource "newstationlocation")
												(switch 
													(eq LSconversion 0)
														(setq LSconversion (random 0 10))
													)
												(setq stationhere (sysCreateStation &stReconStation; (sysVectorPolarOffset (ObjGetPos gSource) (random 0 360) (random 0 LSconversion))))
												;(PrintTo 'log "checking if scaffolds work")
												;(PrintTo 'log stationhere)
												(setq sov (ObjGetData gSource "oldstationSov"))
												(ObjSetSovereign stationhere sov)
												;register the overlay stations
												(ObjSetData gSource "overlays" (lnkAppend (ObjGetData gSource "overlays") (ObjGetID stationhere)))
												;(PrintTo 'log (ObjGetData gSource "overlays"))
												(objRegisterForEvents gSource stationhere)
												))
											)
									;default
									(block Nil
										(setq NewStation (SysCreateStation &stRespawnStation; (ObjGetData gSource "newstationlocation")))
										(objRegisterForEvents gSource NewStation)
										(staSetImageVariant NewStation 0)
										(objSetPos (ObjGetObjByID oldstation) (sysVectorPolarOffset (ObjGetPos (ObjGetObjByID oldstation)) 0 10000))
										(ObjDestroy (ObjGetObjByID oldstation) gSource)
										(ObjSetData gSource "OldStationDestroyed" true)
										)
									)
							(ObjSetData gSource "GraphicSpawned" true)
							(ObjSetData gSource "Graphic" (ObjGetID NewStation))
							(setq sov (ObjGetData gSource "oldstationSov"))
							(ObjSetSovereign NewStation sov)
							;give it the ID of this virtual station
								;if the respawn gets destroyed then kill the respawn event
								;register the station and the freighter:
									;moved to the switch above!!
								;(objRegisterForEvents gSource NewStation)
							)
					)
				;only run if the freighter isn't destroyed:
				;(plymessage gplayer "respawn run")
					(if 
						;sysfindobject gSource +data: "respawner"- what if there are multiple ships? 
						(and
							(or
								;ship arrives:
								(ls (ObjGetDistance (ObjGetObjByID (ObjGetData gSource "IncomingFreighter")) gSource) 20)
								;lots of time passes by
								;(gr (subtract (unvGetTick) (ObjGetData gSource "start_time")) Time)
								)
							(not (eq (ObjGetData gSource "canceled") true))
							)
							(block Nil
								(if
									;it has been called already
									(eq (ObjGetData gSource "Reconstruct!") true)
									;nil
									Nil
									;else:
									(block Nil
										;change
										(SysAddObjTimerEvent (random 1000 10000) gSource "Reconstruct")
										;(SysAddObjTimerEvent 1000 gSource "Reconstruct")
										;(sysCancelTimerEvent gSource "Respawn")
										;(ObjDestroy gSource)
										(ObjSetData gSource "Reconstruct!" true)
										)
									)
								)
						)
				)
		</Respawn>
		<Reconstruct>
			(block (stationUNID sov NewStation pos oldstation Var!!)
				;graphic station
				(Setq Var!! (ObjGetData gSource "Graphic"))
				;destroy the graphic
				(objFireEvent (ObjGetObjByID Var!!) "SelfDestruct")
					;if the old station hasn't been destroyed yet:
					(if	(ObjGetData gSource "OldStationDestroyed")
						;true=
						nil
						;false=
						(block Nil
							(setq oldstation (ObjGetData gSource "TheRealOldeStation"))
							(ObjDestroy (ObjGetObjByID oldstation) gSource)
							)
						)
					(enum (ObjGetData gSource "overlays") lay (block Nil
						(ObjDestroy (ObjGetObjByID lay) gSource)
						))
				(setq stationUNID (ObjGetData gSource "oldstationUNID"))
				(setq sov (ObjGetData gSource "oldstationSov"))
				(setq pos (ObjGetData gSource "newstationlocation"))
				<!--
				(if 
					(iserror (sysCreateStation stationUNID pos))
					(ObjDestroy gSource)
					)
				-->
				(setq NewStation (sysCreateStation stationUNID pos))
				(ObjSetSovereign NewStation sov)
				;destroy this station
				(sysCancelTimerEvent gSource "Respawn")
				(ObjDestroy gSource)
				)
		</Reconstruct>
		<OnObjDestroyed>
			(block Nil
				(ObjSetData gSource "canceled" true)
				(sysCancelTimerEvent gSource "Respawn")
				(sysCancelTimerEvent gSource "Reconstruct")
				;(plymessage gplayer "freighter destroyed.")
				;(plymessage gplayer "overlays destroyed.")
				)
		</OnObjDestroyed>
    </Events>
</Stationtype>
	
<StationType UNID="&stReconStation;"
    name=               "Scaffold"
	sovereign=			"&svIndependent;"
    noMapLabel=			"true"
	armorID=			"&itReinforcedTitanium1;"
	maxHitPoints=		"50"
	hitPoints=			"50"
	
    >
	;ejectaType=			"&vtWreckEjecta;"
	;removed ejecta since it can lag games
	;cool effect, but can't use it because it can't get destroyed: backgroundplane=	"95"
	<ImageVariants>
		<Image imageID="&rsReconStationPart1;" imageWidth="40" imageHeight="40" rotationCount="1"/>
		<Image imageID="&rsReconStationPart2;" imageWidth="40" imageHeight="40" rotationCount="1"/>
		<Image imageID="&rsReconStationPart3;" imageWidth="40" imageHeight="40" rotationCount="1"/>
		<Image imageID="&rsReconStationPart4;" imageWidth="40" imageHeight="40" rotationCount="1"/>
		<Image imageID="&rsReconStationPart5;" imageWidth="40" imageHeight="40" rotationCount="1"/>
    </ImageVariants>
	<Events>
		<OnCreate>
			(block Nil
				(if 
					(ls (ObjGetDistance gSource (sysFindObject gSource "NT:star;")) 60)
						;remove this object
						(objSetPos gSource (sysVectorPolarOffset (ObjGetPos gSource) 0 10000))
						;(objSuspend gSource)
					)
				)
		</OnCreate>
		<OnUpdate>
			(block Nil
				;(Plymessage gPlayer "working?")
				(ls (ObjGetDistance gSource (sysFindObject Nil "tN +star;")) 15)
					(objSetPos gSource (sysVectorPolarOffset (ObjGetPos gSource) 0 10000))
					;(ObjSuspend gSource)
				)
		</OnUpdate>
	</Events>
</StationType>
<!--FROM SDW195-->

<!--- This station takes care of placing one of the controller stations into each system    --->

<!-- thanks Prophet!-->

<StationType UNID="&stRetaliationControllerSpawner;"
    name=               "RetaliationPoint"
    virtual=            "True"
    >
    <Events>
        <OnGlobalSystemCreated>
		(block Nil
            (sysCreateStation &stRetaliationController; nil)
            (sysCreateStation &stPiracySupportController; nil)
			)
        </OnGlobalSystemCreated>
    </Events>
</StationType>

<!--- This station will take care of all the work   --->
        
<StationType UNID="&stRetaliationController;"
    name=               "Retaliation Station"
    scale=              "world"
    backgroundObject=   "true"
    sovereign=          "&svIndependent;"
    unique=             "inSystem"
	attributes=			"DySys"
	virtual=            "True"
    >
    <ImageVariants>
        <Image          imageID="&rsWorlds2;" imageX="0" imageY="0" imageWidth="1" imageHeight="1" />
    </ImageVariants>
    <Events>
		;adding a DS for players to check sovereign relations
		<OnGlobalPaneInit>
			; aScreenUNID is the UNID of the screen being shown
			; aScreen is the screen name (if this is a local screen)
			; aPane is the pane being shown
			; shipStatusScreen is the current playership's dockscreen
			
			(block Nil
				(if 
					(eq aScreenUNID &dsRPGMissionJournal;)
						(scrAddAction
						gScreen
						'myNewAction
						1
						"Sovereign relations"
						"S"
						'default
						(scrShowScreen gScreen "&dsSovereignRelation;")
						)
					)
				)
		</OnGlobalPaneInit>
		<OnPlayerEnteredSystem>
			;(sysAddObjTimerEvent 500 gSource "HERPDERP")
			;(objChangeEquipmentStatus gPlayerShip 'GalacticMap 'install)
			;(plymessage gPlayer "DySys Retaliation initiated")
		</OnPlayerEnteredSystem>
		<HERPDERP>
			;new plan:
				;gate until there is an end OR you have gated to that Node already
				;if the above is true, then go back to a system with ungated gates and take that gate
				;repeat until done?
			(block Nil
				(objChangeEquipmentStatus gPlayerShip 'GalacticMap 'install)
				(setq B (random (sysGetStargates)))
				;(objGateTo obj node entrypoint [effectID])
				(objGateTo gPlayership (sysGetStargateDestinationNode (sysGetNode) B) (random(sysGetStargates (sysGetStargateDestinationNode (sysGetNode) B))))
				)
		<!--
		; I AM NOT USING THE RIGHT GATE: AKA using the sysGetStargateDestinationNode for ObjGateTo doesn't cut it
			;legend:
					;A-ungated in system
					;B-random gate in system
					;B1-list of gated nodes
					;Z- list of ungated nodes in topo
				(block NIL
					;(PrintTo 'log (SysGetName))
					;turn the map on
						(objChangeEquipmentStatus gPlayerShip 'GalacticMap 'install)
					(plymessage gPlayer "GATE!")
					;get list of gates in a system:
					(PrintTo 'log(setq A { Node: "(SysGetNode)" GateID: "(sysGetStargates (sysGetNode))" }))
					;choose one and append it to a list of gated nodes
					(PrintTo 'log(setq B (random (sysGetStargates))))
					;send the rest of A to list Z
					(PrintTo 'log(setq Z (ObjGetData gPlayership "Z")))
						;if B is within Z the get rid of it:
							;RPC within basically checks if set 1 is within set 2
							(if (eq (RPC-within B Z) true)
								(setq B (filter Z element (random(Not element B))))
								)
					(lnkAppend B1 B)
					(enum A Variable
						(block (add add2)
							(setq add (filter A element(Not element B)))
							(lnkAppend Z add)
							(setq add2(ObjGetData gPlayership "Z"))
							(lnkAppend add2 add)
							(ObjSetData gPlayership "Z" add2)
							)
						)
					;gate
						(switch
							;if there are no elements in Z
								;end
								(eq (Count Z) 0)
									(block Nil
										(PrintTo 'log "fin!")
										(Plymessage gPlayer "Fin!")
										)
							;if A has no ungated elements and --?
							;Z still has elements
								(gr (count Z) 1)
									;gate through an element of Z
									(block (A1)
										(setq A1 (random Z))
										(setq Z (filter Z element (Not element A1)))
										(objGateTo gPlayership (sysGetStargateDestinationNode (item A1 'Node) A1) A1)
										)
							;if none of the above:
								;gate through A
								(objGateTo gPlayership (sysGetStargateDestinationNode (sysGetNode) B) B)
								(dbgoutput ""System"")
							)
					)-->
		</HERPDERP>
        <OnCreate>
			(block (XenoSpawnChance baseshipChance SovList)
				(sysAddObjRecurringTimerEvent 90 gSource "SovereignEncounters")
				(if
					(or
						(ls(objGetDistance gSource (sysFindObject nil "GN")) 30)
						(eq (sysGetName) "St. Katharine's Star")
						)
						;don't do anything
						Nil
						;otherwise: sunavoidance!
						(sysAddObjRecurringTimerEvent 30 gSource "SunAvoidance")
					)
				;start the check to see if it's okay to have these events:
				(if
					(or 
						;Eridani excluded requested by Code Cannon
						(eq (sysGetName) "Eridani")
						(eq (sysGetName) "Point Juno")
						(eq (sysGetName) "Huaramarca")
						(eq (sysGetName) "Heretic")
						(eq (sysGetName) "Charon")
						(eq (sysGetName) "Elysium")
						(eq (sysGetName) "Rigel Aurelius")
						)
					(block Nil
						;start the deregistration timer
						(sysAddObjRecurringTimerEvent 90 gSource "Deregistration")
						)
					;if the conditional was false, then do the normal one:
					(block Nil
						;; start the timer
						(sysAddObjRecurringTimerEvent 90 gSource "Registration")
						;generic sovereign attack
						;(sysAddObjRecurringTimerEvent (random 5000 15000) gSource "Attack")
						;FOR GAMEPLAY
						(sysAddObjRecurringTimerEvent (random 1000 10000) gSource "Attack")
						;FOR MODDING
						;(sysAddObjRecurringTimerEvent 30 gSource "Attack")
						;CW defense
						(sysAddObjRecurringTimerEvent (random 2500 7500) gSource "CWDefense")
						;(sysAddObjRecurringTimerEvent (random 300 500) gSource "CWDefense")
						(ObjSetData gSource "DefenderAmt" (random 5 8))
						<!--
						; add in AttackAres Event
						(sysAddObjRecurringTimerEvent 6000 gSource "AttackAres")
						; AttackCW Event
						(sysAddObjRecurringTimerEvent 6000 gSource "AttackCW")
						-->
						;Djohaal's Xenophobe Encounter
						(setq XenoSpawnChance (random 1 5))
						;(PrintTo 'log "ElysiumCheck!")
						;(PrintTo 'log (filter (sysGetNodes) node (eq Node "Elysium")))
						(if
							;if the system level is 7-9
							;add a random chance too make it one fifth chance
							(and
								(geq (sysGetLevel) 7)
								(leq (sysGetLevel) 9)
								(leq XenoSpawnChance 2)
								(filter (sysGetNodes) node (eq Node "Elysium"))
								)
								;TRUE=run it
								(block Nil
									(PrintTo 'log (cat "Xenos will spawn in " (SysGetNode)"!"))
									(sysAddObjTimerEvent (random 1000 10000) gSource "XenophobeEncounter")
									)
							)
						;Twir's baseships
						;(sysAddObjTimerEvent (random 100 1000) gSource "BaseShipSpawn")
						;They don't even have retaliation events :/
						)
					)
					<!--
				(Setq SovListTimers (list 
					(cat &svCommonwealth; "Retaliate") 
					(cat &svAres; "Retaliate") 
					(cat &svRanxEmpire; "Retaliate") 
					(cat &svSung; "Retaliate") 
					(cat &svDwargRaiders; "Retaliate") 
					(cat &svHuariEmpire; "Retaliate") 
					(cat &svUrakWarlords; "Retaliate")
					(cat &svMarauders; "Retaliate") 
					(cat &svHeliotropes; "Retaliate") 
					(cat &svCentauriWarlords; "Retaliate") 
					(cat &svPirates; "Retaliate")))
				(objSetData gSource "SovListTimers" SovList)
				-->
				(setq SovList (list &svCommonwealth; &svAres; &svRanxEmpire; &svSung; &svDwargRaiders; &svHuariEmpire; &svUrakWarlords; &svMarauders; 
				&svHeliotropes; &svCentauriWarlords; &svPirates; ))
				(objSetData gSource "SovList" SovList)
				;CW
					;set (cat &svCommonwealth; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svCommonwealth; "Retaliate") 0)
				;Ares
					;set (cat &svAres; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svAres; "Retaliate") 0)
				;Ranx
					;set (cat &svRanxEmpire; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate") 0)
				;Sung
					;set (cat &svSung; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svSung; "Retaliate") 0)
				;Dwarg
					;set (cat &svDwargRaiders; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate") 0)
				;Huari
					;set (cat &svHuariEmpire; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate") 0)
				;Urak
					;set (cat &svUrakWarlords; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate") 0)
				;Marauders
					;set (cat &svMarauders; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svMarauders; "Retaliate") 0)
				;Heliotropes- They're my fav minor faction!	-svHeliotropes
					;set (cat &svHeliotropes; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svHeliotropes; "Retaliate") 0)
				;Centauri Warlords	(cat &svCentauriWarlords; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate") 0)
				;Charon Pirates	(cat &svPirates; "Retaliate")
					(TypSetData &stRetaliationController; (cat &svPirates; "Retaliate") 0)
					
				;set the Deescalate Timer
					(sysAddObjRecurringTimerEvent 3000 gSource "Decrement")
				
				;set the baddies timer
				(if
					;you're in weird/important systems
					(or 
						(eq (sysGetName) "Point Juno")
						(eq (sysGetName) "Huaramarca")
						(eq (sysGetName) "Heretic")
						(eq (sysGetName) "Charon")
						(eq (sysGetName) "Elysium")
						(eq (sysGetName) "St. Katharine's Star")
						)
					;cancel baddies timer
						(block Nil
							(sysCancelTimerEvent gSource "BaddiesEvents")
							;(objDestroy gSource)
							;(plyMessage gPlayer "Weirdness eradicated")
							)
						;if not, then proceed normally
						(block Nil
							;(plymessage gPlayer "Baddies!")
							(sysAddObjRecurringTimerEvent (random 5000 15000) gSource "BaddiesEvents")
							;(sysAddObjRecurringTimerEvent 500 gSource "BaddiesEvents")
							)
					)
				)
        </OnCreate>
		<SovereignEncounters>
            (block nil
                ;; loop over every active station in the system
                (enum (sysFindObject nil "tMA") station 
                    (if 
						(and
							(not (objGetData station "registered"))
							(not (eq (objGetType station) &stRespawnStation;))
							(not (eq (objGetType station) &stReconStation;))
							(not (objIsAbandoned station))
							)
                        (block (stationsov)
							;add the station's sovereign to the encountered sovlist 
							(setq stationsov (objGetSovereign station))
							(switch
								;check if there is already a sovlist
								(TypGetData &stRetaliationController; "EncounteredSovlist")
									;true means don't reinitialize
									(block Nil
										;check if the sovereign is already in the list
										(switch
											(match (TypGetData &stRetaliationController; "EncounteredSovlist") sovcheck (eq sovcheck stationsov))
												;yes = don't do anything
												Nil
												;no = add to list
												(TypSetData &stRetaliationController; "EncounteredSovlist" 
													(lnkAppend (TypGetData &stRetaliationController; "EncounteredSovlist") stationsov))
											)
										)
								;nil means initialize
									(block Nil
										(TypSetData &stRetaliationController; "EncounteredSovlist" (list stationsov))
										)
								)
							)
						)
					)
				)
		</SovereignEncounters>
		<SAVE>
			(Plymessage gPlayer "It's been 5 minutes! Save your game!")
		</SAVE>
		<SunAvoidance>
			(block Nil
			<!--
			;bugtest succession reminder to save every 5 minutes
				(if
					(geq (ObjGetData gSource "Time") (multiply 300 (ObjGetData gSource "SavingInstance")))
						(block Nil
							(objFireEvent gSource "SAVE")
							(objIncData gSource "SavingInstance" 1)
							)
						(block Nil
							(objIncData gSource "Time" 1)
							;(PrintTo 'log "timecheck!")
							;(PrintTo 'log (ObjGetData gSource "Time"))
							;(PrintTo 'log (geq (ObjGetData gSource "Time") (multiply 300 (ObjGetData gSource "SavingInstance"))))
							;(PrintTo 'log "Next Time!")
							;(PrintTo 'log (multiply 300 (ObjGetData gSource "SavingInstance")))
							)
					)
				-->
			(enum (sysFindObject Nil "*t +star") star (block Nil
			;antigravity [for when ships are near sun] 
				;(plymessage gPlayer "Sun check activated.")
			<!--
			old list:
			(sysFindObject gSource "sN:30; Z;") ship
			-->
			(enum (sysFindObject gSource "tN:60 -star;") station
				(if
					(and (not(ObjIsAbandoned station)))
					(objSetPos station (sysVectorPolarOffset Nil (RPCFindAngle gSource station) 80))
					)
				)
			(enum (sysFindObject gSource "sN:30; Z;") ship
				(block Nil
					(if 
						(and
							(objisship ship)
							(not (objIsParalyzed ship))
							)
						(block Nil
							(if (eq ship gPlayership)
								;(plymessage gPlayer "Sun avoidance system activated.")
								Nil
								)
							
							<!--
							;this moves it clockwise
							(objSetVel ship (objGetVel ship))
							(objIncVel ship (sysVectorPolarVelocity (add (sysVectorAngle (ObjGetPos ship)) 90) 2))
							-->
							<!--
							;WORKS:
							;this is the one that forces ships away
							(objIncVel ship (sysVectorPolarVelocity (sysVectorAngle (ObjGetPos ship)) 20))
							-->
							
							;compute a new flight path nav point -?
								;make the ship turn right 90 degrees
								;hold that 
							;NEW IDEA:
							;ship's angle will collide with sun
							<!--
							(block (Value Val2)
								;add 180 to the check?
								(setq value (shpGetDirection ship))
								(setq val2 (RPCFindAngle ship (sysFindObject gSource "tN +star;")))
								;(plymessage gPlayer ""Value"")
								;(plymessage gPlayer ""Val2"")
								(if
									(and
										(leq (abs(subtract Val2 Value)) 45)
										(not (ObjGetData ship "AvoidingSun") True)
										)
										(block (avoid PrevOrder)
											(ObjSetData ship "AvoidingSun" True)
											;(plymessage gPlayer "Sun avoidance system activated.!")
											;remember previous order
											(setq prevOrder(shpGetOrder ship))
											;cancel current shiporder
											(shpCancelOrders ship)
											;move ship
											(setq avoid (sysCreateMarker "RUN!" (sysVectorPolarOffset ship (add 90 (shpGetDirection ship)) 50) &svIndependent;))
											(shpOrder ship 'goto avoid)
											;(objSetKnown avoid)
											;(objSetShowAsDestination avoid)
											;(shpOrder 'goto (sysCreateStation &stArmorDealer; &svIndependent;))
											;do whatever it was supposed to do
											(if
												(iserror (shpOrder ship prevOrder))
												Nil
												)
											)
									)
								)-->
							(if
								(not (eq (ObjGetData ship "AvoidingSun") True))
									;if the ship is just too close:
									(block (avoid PrevOrder)
										(ObjSetData ship "AvoidingSun" True)
										;(plymessage gPlayer "Sun avoidance system activated.!")
											;remember previous order
											;(PrintTo 'log "SunAvoid ship order")
											;(PrintTo 'log (shpGetOrder ship))
											;(setq prevOrder(shpGetOrder ship))
											;cancel current shiporder
											;(shpCancelOrders ship)
										;move ship
										(setq avoid (sysCreateMarker "RUN!" (sysVectorPolarOffset Nil (add (RPCFindAngle gSource ship) 90) (random 80 130)) &svIndependent;))
										(shpOrderImmediate ship 'goto avoid)
										;(objSetKnown avoid)
										;(objSetShowAsDestination avoid)
										;(shpOrder 'goto (sysCreateStation &stArmorDealer; &svIndependent;))
										;do whatever it was supposed to do
										;(not(iserror (shpOrder ship prevOrder))) this /does/ return an error: this means that
											; I need a target to dock... now to find a way...
										(if
											(not(iserror (shpOrder ship prevOrder)))
											(block Nil
												(shpCancelOrders ship)
												(shpOrder ship prevOrder)
												(ObjSetData ship "AvoidingSun" False)
												)
											)
										)
								)
							<!--
							;(switch
								;(and
									(gr (shpGetDirection ship) 0)
									(leq (shpGetDirection ship) 180)
									)
									;(objIncVel ship (sysVectorPolarVelocity (sysVectorAngle (ObjGetPos gPlayership)) 20))
									;(sysCreateWeaponFire &itStarcannon; gPlayership (ObjGetPos gPlayership) (shpGetDirection ship) 359 10 nil)
								;(and
									(gr (shpGetDirection ship) 0)
									(leq (shpGetDirection ship) 180)
									)
									;(objIncVel ship (sysVectorPolarVelocity (sysVectorAngle (ObjGetPos gPlayership)) 20))
									;(sysCreateWeaponFire &itStarcannon; gPlayership (ObjGetPos gPlayership) (shpGetDirection ship) 359 10 nil)
								)
							-->
							;(objIncVel ship (sysVectorPolarVelocity (modulo (add 90 (sysVectorAngle (objGetpos ship))) 359) -20))
							
							;(objSetPos ship (sysVectorPolarOffset (ObjGetPos ship) (sysVectorAngle (objGetpos ship)) 1))
							;(plymessage gplayer "antigravity")
							)
						)
					)
				)
			;enum to undo the setting data
			(enum (sysFindObject gSource "sR:60; Z;") ship
				(ObjSetDAta ship "AvoidingSun" false)
				)
				))
				)
		</SunAvoidance>
		<XenophobeEncounter>
			(block (XenoA XenoB Defenderchance Fighterchance)
				(PrintTo 'log (cat "Xeno encounter starts in " (SysGetNode)"!"))
				;(sysCreateMarker "rally" (sysVectorPolarOffset (ObjGetPos aObjDestroyed) (random 0 359) (random 1 5)) &svCommonwealth;)
				;choose 2 opposite points in the star system
				(setq XenoA (sysCreateMarker "Xeno1" (sysVectorPolarOffset (ObjGetPos gSource) (random 0 90) (random 400 1200)) &svCommonwealth;))
				(setq XenoB (sysCreateMarker "Xeno2" (sysVectorPolarOffset (ObjGetPos XenoA) (random 180 270) (random 800 1200)) &svCommonwealth;))
				;(random (subtract (sysCalcFireSolution (ObjGetPos gSource) 0 0) 15) (add (sysCalcFireSolution (ObjGetPos gSource) 0 0) 15))
				;(objSetShowAsDestination XenoB True)
				;create jump point
				;(sysCreateStation &stXenoJump; (objGetPos XenoB))
				
				(setq Defenderchance (random 2 4))
				(setq Fighterchance (random 1 3 ))
					;make the Xeno fleet
						;3 Worldships
						;4-8 Defenders
						;5-20 fighters
						;in other words...
						(for i 0 2
							;make worldship
							(block (world Vector)
								(setq Vector (sysVectorPolarOffset (ObjGetPos XenoA) (random 0 359) (random 10 20)))
								(setq world (sysCreateShip &scXenophobeWorldship; Vector &svDestructiveChaos;))
								(sysCreateEffect &efStargateOut; Nil Vector)
								;set the ship as Xeno [so we can identify them when they gate out]
								(ObjSetData world "Xeno" true)
								;tell them to move from point A to point B
								(shpOrder world 'goto XenoB)
								;set data about end location on ship
								(objSetdata world "Endlocation" (objGetID XenoB))
								;give event handler
								(objSetEventHandler world &evXenoSpamEventHandler;)
								;fire the pwning event
								(sysAddObjRecurringTimerEvent 30 world "pwning")
								;(objSetShowAsDestination world True)
								;make defender
								(for i 0 Defenderchance
									(block (Defender)
										(setq Defender (sysCreateShip &scXenophobeDefender; (objGetPos XenoA) &svDestructiveChaos;))
										;set the ship as Xeno [so we can identify them when they gate out]
										(ObjSetData Defender "Xeno" true)
										(shpOrder Defender 'escort world)
										;make fighters
										(for i 0 Fighterchance
											(block (fighter)
												(setq fighter (sysCreateShip &scXenophobeFighter; (objGetPos XenoA) &svDestructiveChaos;))
												;set the ship as Xeno [so we can identify them when they gate out]
												(ObjSetData fighter "Xeno" true)
												(shpOrder fighter 'escort Defender)
												)
											)
										)
									)
								)
							)
					
					;give them an event handler to pwn everything withing 150 ls
					;and to disappear when close to target
				)
		</XenophobeEncounter>
		<BaseShipSpawn>
			(block Nil
				(if
					;if the system level is 7-9
					;add a random chance too make it one fifth chance
					(and
						(geq (sysGetLevel) 1)
						(leq (sysGetLevel) 5)
						(leq baseshipChance 2)
						)
						;TRUE=spawn
						(block (thingy)
							(setq thingy (sysCreateStation &stSalvagerEncounter; (sysVectorPolarOffset Nil (random 0 360) (random 100 1000))))
							(objRegisterForEvents gSource thingy)
							)
					)
				)
		</BaseShipSpawn>
		<BaddiesEvents>
			(block (TheShip shipchance orderchance baddie pos)
				;defining part				
				;(setq pos (sysFindObject nil "GN"))
				;filter out Huaramarca
				(setq pos 
					(random 
						(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
						)
					)
				(if 
					pos
					;true=don't do anything
					Nil
					;false= choose random gate, record it in logs
					(block Nil
						(setq pos (random (sysFindObject nil "G")))
						(PrintTo 'log "Pos didn't work!")
						)
					)
				(setq orderchance (random 1 2))
				(setq shipchance (random 1 100))
				(switch
					;by level
						;by chance [from 1-100]
					(leq (SysGetLevel) 5)
					(block Nil
						(switch 
							(ls shipchance 6)
								(setq TheShip &scCorsair;)
							(and
								(geq shipchance 7)
								(leq shipchance 12)
								)
								(setq TheShip &scCorsair-II;)
							(and
								(geq shipchance 13)
								(leq shipchance 18)
								)
								(setq TheShip &scZulu;)
							(and
								(geq shipchance 19)
								(leq shipchance 24)
								)
								(setq TheShip &scZulu-II;)
							(and
								(geq shipchance 25)
								(leq shipchance 30)
								)
								(setq TheShip &scHammerhead;)
							(and
								(geq shipchance 31)
								(leq shipchance 36)
								)
								(setq TheShip &scHammerhead-II;)
							(and
								(geq shipchance 37)
								(leq shipchance 42)
								)
								(setq TheShip &scCentauriRaider;)
							(and
								(geq shipchance 43)
								(leq shipchance 48)
								)
								(setq TheShip &scCentauriHeavyRaider;)
							(and
								(geq shipchance 49)
								(leq shipchance 54)
								)
								(setq TheShip &scT31ArmedTransport;)
							(and
								(geq shipchance 55)
								(leq shipchance 60)
								)
								(setq TheShip &scT55ArmedTransport;)
							(and
								(geq shipchance 4)
								(leq shipchance 68)
								)
								(setq TheShip &scViking;)
							(and
								(geq shipchance 4)
								(leq shipchance 76)
								)
								(setq TheShip &scSotho;)
							(and
								(geq shipchance 4)
								(leq shipchance 84)
								)
								(setq TheShip &scOromo;)
							(and
								(geq shipchance 4)
								(leq shipchance 92)
								)
								;(setq TheShip &scEI500;) - if you do this Korolov avenges the ship
								(setq TheShip &scOromo;)
							;if none of the above
								(setq TheShip &scWolfen;)
							)
						)
					(and
						(geq (SysGetLevel) 6)
						(leq (SysGetLevel) 8)	
						)
					(block Nil
						(switch 
							(ls shipchance 10)
								(setq TheShip &scPlague;)
							(and
								(geq shipchance 11)
								(leq shipchance 20)
								)
								(setq TheShip &scRevelations;)
							(and
								(geq shipchance 21)
								(leq shipchance 30)
								)
								(setq TheShip &scMolotok;)
							(and
								(geq shipchance 31)
								(leq shipchance 40)
								)
								(setq TheShip &scDwargMaster;)
							(and
								(geq shipchance 41)
								(leq shipchance 50)
								)
								(setq TheShip &scEarthSlaver;)
							(and
								(geq shipchance 51)
								(leq shipchance 60)
								)
								(setq TheShip &scDwargBehemoth;)
							(and
								(geq shipchance 61)
								(leq shipchance 70)
								)
								(setq TheShip &scLuminousDrone;)
							(and
								(geq shipchance 71)
								(leq shipchance 80)
								)
								(setq TheShip &scMethEnforcer;)
							(and
								(geq shipchance 81)
								(leq shipchance 90)
								)
								(setq TheShip &scAtonement;)
							
							;if none of the above
								(setq TheShip &scRepentant;)
							)
						)
					(geq (SysGetLevel) 9)
					(block Nil
						(switch 
							(ls shipchance 20)
								(setq TheShip &scVentariCruiser;)
							(and
								(geq shipchance 21)
								(leq shipchance 40)
								)
								(setq TheShip &scEarthSlaver;)
							(and
								(geq shipchance 41)
								(leq shipchance 60)
								)
								(setq TheShip &scDwargMaster;)
							(and
								(geq shipchance 61)
								(leq shipchance 80)
								)
								(setq TheShip &scKobolGunshipOmniTeV9;)
							;if none of the above
								(setq TheShip &scKobolGunshipDualTeV9;)
							)
						)
					<!--
					(and 
						(geq shipchance 16) 
						(leq shipchance 20)
						)
					-->
						
					)
				
				;action part
				(setq baddie (sysCreateShip TheShip pos &svGaianTerraformers; ))
				
				(switch 
					(eq orderchance 1)
						(block Nil
							(shpOrder baddie 'attack gPlayership)
							)
					(eq orderchance 2)
						(block Nil
							(shpOrder baddie 'wander gPlayership)
							)
					)
				(PrintTo 'log "Baddies Check")
				(PrintTo 'log (sysGetLevel))
				(PrintTo 'log (ObjGetDataField baddie 'name))
				;(plymessage gPlayer "Baddies!")
				(block Nil
					(objSetEventHandler baddie &evStealCargoEventHandler;)
					(sysAddObjRecurringTimerEvent 30 baddie "StealCargo")
					)
				)
		</BaddiesEvents>
		<Deregistration>
			(block nil
					;; loop over every active station in the system
					(enum (sysFindObject nil "tMA") station 
						(if (not (objGetData station "registered"))
							(block nil
								;; if the station is registered, unregister
								(objUnregisterForEvents gSource station)
								;; mark that we've unregistered this station
								(objSetData station "Registered" Nil)
								;(plyMessage gplayer "Deregistering now.")
								)
							)
						)
					)
		</Deregistration>
        <Registration>
            (block nil
				;(plyMessage gplayer "Registration.")
                ;; loop over every active station in the system
                (enum (sysFindObject nil "tMA") station 
                    (if 
						(and
							(not (objGetData station "registered"))
							(not (eq (objGetType station) &stRespawnStation;))
							(not (eq (objGetType station) &stReconStation;))
							(not (objIsAbandoned station))
							)
                        (block (stationsov)
                            ;; if the station isn't registered yet, do so now
                            (objRegisterForEvents gSource station)
                            ;; mark that we've registered this station
                            (objSetData station "Registered" True)
								;if the station is also a mining station:
									;start the mining thing:
								(if 
									(eq (objGetType station) &stMiningColony;)
										(block Nil
											(objSetEventHandler station &evMiningStation;)
											(objFireEvent station "Start")
											)
									)
							
							;add the station's sovereign to the encountered sovlist 
							(setq stationsov (objGetSovereign station))
							(switch
								;check if there is already a sovlist
								(TypGetData &stRetaliationController; "EncounteredSovlist")
									;true means don't reinitialize
									(block Nil
										;check if the sovereign is already in the list
										(switch
											(match (TypGetData &stRetaliationController; "EncounteredSovlist") sovcheck (eq sovcheck stationsov))
												;yes = don't do anything
												Nil
												;no = add to list
												(TypSetData &stRetaliationController; "EncounteredSovlist" 
													(lnkAppend (TypGetData &stRetaliationController; "EncounteredSovlist") stationsov))
											)
										)
								;nil means initialize
									(block Nil
										(TypSetData &stRetaliationController; "EncounteredSovlist" (list stationsov))
										)
								)
							)
						)
					)
				)
        </Registration>

		<Decrement>
			;check if this works!
			;stop it from going negative!
			(block (something)
			;sovRetaliationlevels
				(switch
					;CW
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svCommonwealth; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")))
							(PrintTo 'log (cat "CW:" something))
							;(plyMessage gPlayer "The Commonwealth retaliation level decreased to "something"!")
							)
						)
				(switch
					;Ares
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController;  (cat &svAres; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")))
							(PrintTo 'log (cat "Ares:" something))
							;(plyMessage gPlayer "The Ares retaliation level decreased to "something"!")
							)
						)
				(switch
					;Ranx
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate")))
							(PrintTo 'log (cat "Ranx:" something))
							;(plyMessage gPlayer "The Ranx retaliation level decreased to "something"!")
							)
						)				
				(switch
					;Sung
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svSung; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svSung; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svSung; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svSung; "Retaliate")))
							(PrintTo 'log (cat "Sung:" something))
							;(plyMessage gPlayer "The Sung retaliation level decreased to "something"!")
							)
						)				
				(switch
					;Dwarg
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate")))
							(PrintTo 'log (cat "Dwarg:" something))
							;(plyMessage gPlayer "The Dwarg retaliation level decreased to "something"!")
							)
						)
				(switch
					;Huari
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate")))
							(PrintTo 'log (cat "Huari:" something))
							;(plyMessage gPlayer "The Huari retaliation level decreased to "something"!")
							)
						)
				(switch
					;Urak
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate")))
							(PrintTo 'log (cat "Urak:" something))
							;(plyMessage gPlayer "The Urak retaliation level decreased to "something"!")
							)
						)
				;Marauder
				(switch				
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svMarauders; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svMarauders; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svMarauders; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svMarauders; "Retaliate")))
							(PrintTo 'log (cat "Marauder:" something))
							;(plyMessage gPlayer "The Marauder retaliation level decreased to "something"!")
							)
						)
				;Heliotrope
				(switch
					;Heliotrope
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svHeliotropes; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svHeliotropes; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svHeliotropes; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svHeliotropes; "Retaliate")))
							(PrintTo 'log (cat "Heliotrope:" something))
							;(plyMessage gPlayer "The Heliotrope retaliation level decreased to "something"!")
							)
						)
				;Centauri
				(switch
					;Centauri Warlord
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate")))
							(PrintTo 'log (cat "Centauri:" something))
							;(plyMessage gPlayer "The Centauri retaliation level decreased to "something"!")
							)
						)
				;Charon
				(switch
					;Charon Pirates
					(not (ls (subtract (TypGetData &stRetaliationController; (cat &svPirates; "Retaliate")) 2) 1))
						(block Nil
							(TypSetData &stRetaliationController; (cat &svPirates; "Retaliate") (subtract (TypGetData &stRetaliationController; (cat &svPirates; "Retaliate")) 1))
							(setq something (TypGetData &stRetaliationController; (cat &svPirates; "Retaliate")))
							(PrintTo 'log (cat "Charon:" something))
							;(plyMessage gPlayer "The Charon pirate retaliation level decreased to "something"!")
							)
						)
				(objSetData gSource "RPCCWRevengeSquad" (subtract (objGetData gSource "RPCCWRevengeSquad") 1))
				)
		</Decrement>
        
        <!--- This event will run whenever a station is destroyed
            You may want to add some code to change what happens
            depending on what kind of station was destroyed
            like spawning different ships if a Urak station is destroyed
            or ignoring stations that are destroyed by the player.
			
			<OnObjDestroyedhuh>
			(PrintTo 'log "number called")
		</OnObjDestroyedhuh>
        --->
		
		<CWDefense>
			(block (stationlist StationElement)
				;make list of CW stations
				(setq Stationlist (filter (sysFindObject Nil "TA +populated;") station 
					(and
						(or
							(eq (objGetSovereign station) &svCommonwealth;)
							(eq (objGetSovereign station) &svCorporate;)
							)
					(not (eq station &stCommonwealthTurret;)))
					))
				;(enum stationlist station (block Nil
				;	(PrintTo 'log (cat station))
				;	))
				;(PrintTo 'log "Stationlist")
				;(PrintTo 'log Stationlist)
				
				;set sys amt of defenders as a function of level (or just random 5-8)
				;replaced by the (ObjGetData gSource "DefenderAmt") on this station at generation
				;(setq Defenderamt (random 5 8))
				(PrintTo 'log (sysGetLevel))
				;set the station
				(setq StationElement (random stationlist))
				(PrintTo 'log StationElement)
				(PrintTo 'log (TypGetDataField (ObjGetType StationElement) 'name))
				(PrintTo 'log (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")))
				(PrintTo 'log ""(TypGetDataField (ObjGetType StationElement) 'name)" is defended with " (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) " ships!")
				(PrintTo 'log "CheckTests OPEN")
				(PrintTo 'log (geq (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) (ObjGetData gSource "DefenderAmt")))
				(PrintTo 'log (and
								(ls (ObjGetData gSource "DefenderAmt"))
								(gr (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) 1)
								))
				(PrintTo 'log "CheckTests END")
				;if the level is dangerous enough
				(if
					(and
						(geq (sysGetLevel) 5)
						StationElement
						)
					(block Nil
						;switch
						(switch
							;more than enough defenders
							(geq (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) (ObjGetData gSource "DefenderAmt"))
							(block Nil
								Nil
								;(Plymessage gPlayer ""(TypGetDataField (ObjGetType StationElement) 'name)" is defended with " (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) " ships!")
								(PrintTo 'log ""(TypGetDataField (ObjGetType StationElement) 'name)" is defended with " (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) " ships!")
								)
							;see if it has defenders but not full
							(and
								(ls (ObjGetData gSource "DefenderAmt"))
								(gr (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) 1)
								)
								;refill the station's defenses
								(block (ShipElement pos)
									(PrintTo 'log "Refilling")
									(PrintTo 'log (ls (ObjGetData gSource "DefenderAmt")))
									(PrintTo 'log (ObjGetData gSource "DefenderAmt"))
									(PrintTo 'log (gr (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")) 1))
									(PrintTo 'log (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")))
									;(Plymessage gPlayer "repeat event!")
									(PrintTo 'log "repeat")
									(PrintTo 'log (ObjGetData gSource "DefenderAmt"))
									(PrintTo 'log (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")))
									(PrintTo 'log (subtract (ObjGetData gSource "DefenderAmt") (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense"))))
									;filter out Huaramarca
									(setq pos 
										(random 
											(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
											)
										)
									(if 
										pos
										;true=don't do anything
										Nil
										;false= choose random gate, record it in logs
										(block Nil
											(setq pos (random (sysFindObject nil "G")))
											(PrintTo 'log "Pos didn't work!")
											)
										)
									(for RPC 0 (subtract (ObjGetData gSource "DefenderAmt") (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense")))(block Nil
										(setq ShipElement (sysCreateShip &scBritannia; pos &svCommonwealthFleet;))
										;set that it's a defender
										(ObjSetData ShipElement "DySysCWDefender" true)
										;set the station it's defending
										(ObjSetData ShipElement "Defendstation" (objGetObjByID StationElement))
										;increment defendcount by 1
										(ObjIncData gSource (cat(objGetObjByID StationElement)"-defense"))
										(shpOrder ShipElement 'escort StationElement)
										(objRegisterForEvents gSource ShipElement)
										))
									(PrintTo 'log (cat "defender count!" (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense"))) )
									;(objSetShowAsDestination ShipElement)
									;(Plymessage gPlayer "Defend "(TypGetDataField (ObjGetType StationElement) 'name)"!")
									(PrintTo 'log "Defend "(TypGetDataField (ObjGetType StationElement) 'name)"!")
									;(Plymessage gPlayer "SysLevel is "(sysGetLevel)"!")
									(PrintTo 'log "SysLevel is "(sysGetLevel)"!")
									)
							;if no defenders
							(block (ShipElement pos)
								;filter out Huaramarca
								(setq pos 
									(random 
										(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
										)
									)
								(if 
									pos
									;true=don't do anything
									Nil
									;false= choose random gate, record it in logs
									(block Nil
										(setq pos (random (sysFindObject nil "G")))
										(PrintTo 'log "Pos didn't work!")
										)
									)
								(for RPC 0 (ObjGetData gSource "DefenderAmt") (block Nil
									(setq ShipElement (sysCreateShip &scBritannia; pos &svCommonwealthFleet;))
									;set that it's a defender
									(ObjSetData ShipElement "DySysCWDefender" true)
									;set the station it's defending
									(ObjSetData ShipElement "Defendstation" (objGetObjByID StationElement))
									;increment defendcount by 1
									(ObjIncData gSource (cat(objGetObjByID StationElement)"-defense"))
									(shpOrder ShipElement 'escort StationElement)
									(objRegisterForEvents gSource ShipElement)
									))
									(PrintTo 'log (cat "defender count!" (ObjGetData gSource (cat(objGetObjByID StationElement)"-defense"))) )
									;(Plymessage gPlayer "Defend "(TypGetDataField (ObjGetType StationElement) 'name)"!")
									(PrintTo 'log "Defend "(TypGetDataField (ObjGetType StationElement) 'name)"!")
									;(Plymessage gPlayer "SysLevel is "(sysGetLevel)"!")
									(PrintTo 'log "SysLevel is "(sysGetLevel)"!")
								;(objSetShowAsDestination ShipElement)
								)
							)
						)
					)
				;remember to set stationID"-defense"!
				
					
							
								;if it has less than the system amt then add more
									;register the defenders
									;set the data as "ObjGetObjID"-defense""
									;in the OnDestroy then decrement by that amt
							;if it has no defenders then send as much as the system amt
								
				
				;have # of defenders set
				
				;===
				;make list of CW stations
					;filter if it's being defended
					
				;choose a random CW station from the filtered list
				;send brits
				;set station as being defended
				;if ships are destroyed then set it as undefended
				;do "refills"
				;===
				)
		</CWDefense>
		
        <OnObjDestroyed>
			;in this new system, I have decided on a "Generic Retaliate" event.
			;that means that it will be one huge block filled with switches- but it's also means that I have to look through shorter amount of lines.
			;not only that, but with added complexity means that I an add retaliationevents easier-- instead of one NEW event, I just append
			;the existing code and viola!
			;The retaliationevent will be split into two parts:
				;the definition part, where I will define local variables such as ships
				;and
				;the action part, where the ships are made,etc. 
			;Notes: to add factions, add them and the appropriate data to these locations:
				;RPCCreateSovereignAtkFleet for attack fleets
				;this event
				;respawn event
				;data:
					;Retaliationshiptype should be a ship UNID
					;escorttype should be the ship escorting Retaliationshiptype. if they're the same, use (setq escorttype Retaliationshiptype)
					;cnt is the amount of ships in the squad
					;metacnt is the amount of fleets to send (the Dwarg use this, they send more fleets of dwarg masters + zoanthropes)
						
				<!--
				;OLD WAY (V2)
				;AUTHOR NOTES:
					;to add a sovereign:
					;#1-the "and" to set up a check for the retaliation to go through
					;#1a. the set structural HP of the station- just a personal preference
					;#2-objIncData- increment the retaliation data
					;#3-setq level- set the level as the retaliation data so that I don't have to type too much :P
					;#4-the ship list- have a list of ships that appear when the retaliation is triggered
					;*********************************************
					;#5-make sure they setq the right local Vars!
						;Retaliationshiptype- the type of ship to show up
						;cnt- the amount of ships to show
					;*********************************************
					;#6: apply the ad-hoc answer to escorttype!
					;setq escorttype Retaliationshiptype
					;escorttype- the ship that would follow the retaliationship [like a dwarg raider following a dwarg master]
				-->
				
			; all right, here goes....
			(block (Retaliationshiptype escorttype pos sov theLeader cnt name level sovTest test ship Retaliationname metacnt)
				;added a switch here for the CWDefense event
				(switch 
					(eq (ObjGetData aObjDestroyed "DySysCWDefender") true)
						(block Nil
							;get the name of the ship destroyed (it should be a brit)
							(PrintTo 'log "NameCheck!")
							(PrintTo 'log (ObjGetDataField aObjDestroyed 'name))
							;decrement by 1
							(ObjSetData gSource (cat(ObjGetData aObjDestroyed "Defendstation")"-defense") (subtract (ObjGetData gSource (cat(ObjGetData aObjDestroyed "Defendstation")"-defense")) 1))
							)
					;not a ship means it's a station
					(not (ObjIsShip AObjDestroyed))
						(block Nil
							;(plymessage gPlayer "OnObjDestroyed!")
							(setq sovTest(objGetSovereign aObjDestroyed))
							;if stationhp = 100 set sovtest to Nil
							(if
								(eq 100 (staGetStructuralHP aObjDestroyed))
									(setq sovTest Nil)
								)
							(PrintTo 'log "Destroyed Check")
							(PrintTo 'log (ls (ObjGetData aObjDestroyed "DestroyedCount") 1))
							;if the station wasn't destroyed already:
							(if 
								(ls (ObjGetData aObjDestroyed "DestroyedCount") 1)
									;this is for respawning stations
									(objFireEvent gSource "RespawnStation")
								)
								;(PrintTo 'log "checking if station registers as abandoned")
								;(PrintTo 'log (ObjIsAbandoned aObjDestroyed))
								;it's abandoned on first go *sadface*
								;(PrintTo 'log "check if abandoned and structural HP works")
								<!--
								(PrintTo 'log (and 
									(eq 100 (staGetStructuralHP aObjDestroyed))
									(ObjIsAbandoned aObjDestroyed)
									))
									-->
								;(PrintTo 'log "what is HP?")
								;(PrintTo 'log (staGetStructuralHP aObjDestroyed))
							;(objFireEvent gSource "RespawnStation")
							;(sysAddObjTimerEvent 100 gSource "RespawnStation")
							;(rollDice 42 128 1000)
							;(objFireEvent gSource "RespawnStation")
							
							(switch
							;this is the start of the defining part....
								; For CW
								;and it's a station [since I also register freighters now to add some loot]
								(and
									(eq &svcommonwealth; sovTest)
									(not (objIsShip aObjDestroyed))
									(not (eq (ObjGetType aObjDestroyed) &stCommonwealthTurret;))
									)
									;in the next block, we will define the local vars for ships and fleetcounts
									(block Nil
										;make destructible before switch
										(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
										(switch
											(and
											;no CW vs Nil [dead ship's explosion]
												(not (eq (objGetSovereign aDestroyer) Nil))
											;no CW vs CW
												(not (eq (objGetSovereign aDestroyer) &svcommonwealth;))
											;no CW vs CWfleet
												(not (eq (objGetSovereign aDestroyer) &svCommonwealthFleet;))
											;no CW vs CWfleet assasins
												(not (eq (objGetSovereign aDestroyer) &svFleetAssassins;))
											;no CW vs Corp- although it would be cool!
												(not (eq (objGetSovereign aDestroyer) &svCorporate;))
											;It would be weird if the CW attack your auton but not you
												(not (eq (objGetSovereign aDestroyer) &svFriendlyAuton;))
											;no CW vs Ringers
												(not (eq (objGetSovereign aDestroyer) &svRingers;))
											;no CW vs Ferians either- I'm not letting the player off that easily!--- make a special retaliation for angry ferians that also targets player!
												(not (eq (objGetSovereign aDestroyer) &svFerianMiners;))
												(not (eq (objGetSovereign aDestroyer) &svFerianMinersAngry;))
												)
												(block Nil
													;I set the local variables to Nil because local variables carry over to blocks within blocks
													(if
														(ls (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svCommonwealth; "Retaliate") 5)
														)
														(setq level (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")))
														(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
													)
											)
										<!--
										;this is an ad-hoc solution for how to deal with escorttype [Used to be :P]
										(setq escorttype Retaliationshiptype)
										-->
										)
								; For Ares
									(eq sovTest &svAres;)
										(block Nil
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
													;no Ares vs Ares
													(not (eq (objGetSovereign aDestroyer) &svAres;))
													;no Ares vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
													(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svAres; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")))
													(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
													)
												)
											)
								; For Ranx
									(eq &svRanxEmpire; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
													;no Ranx vs Ranx
														(not (eq (objGetSovereign aDestroyer) &svRanxEmpire;))
													;no Ranx vs Nil [dead ship's explosion]
														(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svRanxEmpire; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svRanxEmpire; "Retaliate")))
															;retaliationlevel- how to vary?
															;scRanxGunship
															;scRanxDreadnought
															<!--
															;New Ranx ship list:
															Ranx Gunship---			Done
															Heavy Gunship
															Cruiser---				ish
															DN---					Done
															Destroyer
															-->
															(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
								;Sung
									(and 
										(eq &svSung; sovTest)
										(not (eq (ObjGetType aObjDestroyed) &stSungDefenseSat1;))
										(not (eq (ObjGetType aObjDestroyed) &stSungNWWall;))
										(not (eq (ObjGetType aObjDestroyed) &stSungNEWall;))
										(not (eq (ObjGetType aObjDestroyed) &stSungSEWall;))
										(not (eq (ObjGetType aObjDestroyed) &stSungSWWall;))
										)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Sung vs sung
													(not (eq (objGetSovereign aDestroyer) &svSung;))
												;no Sung vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svSung; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svSung; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svSung; "Retaliate")))
															<!--
															Sung:
															scDragonSlaver Slaver				40
															scCarrierEarthSlaver				26-39???it has special scripting.. will it still work? 
															scEarthSlaver 						15-25 [the number increases by 2 for every 5]
															scSteelSlaver 						6-15
															scWindSlaver						1-5
															-->
															(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
								;Dwarg
									(eq &svDwargRaiders; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Dwarg vs Dwarg
													(not (eq (objGetSovereign aDestroyer) &svDwargRaiders;))
												;no Dwarg vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svDwargRaiders; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svDwargRaiders; "Retaliate")))
															<!--
															scDwargMaster
															Dwarg:
															1-10
															scDwargRaider (5-8)
															11-15
															master+raider (x2)
															16-20
															master+raider (x3)
															21-25
															master+ 2 behemoths
															26-30
															master+ 2 behemoths (x2)
															scDwargBehemoth
															-->
															(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
								;Huari
									(eq &svHuariEmpire; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Huari vs Huari
													(not (eq (objGetSovereign aDestroyer) &svHuariEmpire;))
												;no Huari vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svHuariEmpire; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svHuariEmpire; "Retaliate")))
													(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
								;Urak
									(eq &svUrakWarlords; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Urak vs Urak
													(not (eq (objGetSovereign aDestroyer) &svUrakWarlords;))
												;no Urak vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svUrakWarlords; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svUrakWarlords; "Retaliate")))
													; set Retaliationshiptype and cnt at the same time
													(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
								; For Marauder
									(eq &svMarauders; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Marauder vs Marauder
													(not (eq (objGetSovereign aDestroyer) &svMarauders;))
												;no Marauder vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svMarauders; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svMarauders; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svMarauders; "Retaliate")))
														; set Retaliationshiptype, escorttype and cnt at the same time
														(switch
															<!--
																;scDrake
																;scViking-II
																;scBarbary
																;scMarauderRaidPlatform
																;scTripoli
															-->
															(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
															)
														)
													)
												)
								; For Heliotropes
									(eq &svHeliotropes; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Heliotrope vs Heliotrope
													(not (eq (objGetSovereign aDestroyer) &svHeliotropes;))
												;no Heliotrope vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svHeliotropes; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svHeliotropes; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svHeliotropes; "Retaliate")))
														(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
													)
												)
											)
								; For Centauri Raiders
									(eq &svCentauriWarlords; sovTest)
										(block Nil
											;make destroyable before switch
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Centauri vs Centauri
													(not (eq (objGetSovereign aDestroyer) &svCentauriWarlords;))
												;no CW vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate") 5)
														)
													(setq level (TypGetData &stRetaliationController; (cat &svCentauriWarlords; "Retaliate")))
														(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
													)
												)
											)
										
								; For Charon Pirates
									(eq &svPirates; sovTest)
										(block Nil
											;make destroyable before switch
											;(PrintTo 'log "checking aWreckObj!")
											(staSetStructuralHP aWreckObj (multiply (ObjGetLevel aWreckObj) 100))
											(switch
												(and
												;no Charon vs Charon
													(not (eq (objGetSovereign aDestroyer) &svPirates;))
												;no CW vs Nil [dead ship's explosion]
													(not (eq (objGetSovereign aDestroyer) Nil))
													)
												(block Nil
													(if
														(ls (TypGetData &stRetaliationController; (cat &svPirates; "Retaliate")) 50)
														(typIncData &stRetaliationController; (cat &svPirates; "Retaliate") 5)
														)
												;; get the current relatiation level
												(setq level (TypGetData &stRetaliationController; (cat &svPirates; "Retaliate")))
														<!--
															;scCorsair				1-5
															;scViking				6-10
															;scCorsair-II			11-15
															;scViking-II			16-20
															;scDrake				21-25
															;scCharonFrigateRaider	26-30
															;scMarauderRaidPlatform	
														-->
														;; run the switch
														;; set both the type and the count at the same time
															;;it's already set in RPCCreateSovereignAtkFleet
															(RPCCreateSovereignAtkFleet SovTest level aDestroyer 'attack (typGetDataField (objGetSovereign aObjDestroyed) 'name) (typGetDataField (objGetSovereign aDestroyer) 'name))
														)
													)
												)
										
								;add an eq switch to add a sovereign!
								;go ahead, I dare you.... [just be careful of the parentheses!]
								<!--
								;add your Sovereign here!
								
									(eq &yoursovereign; SovTest)
										(block Nil
											;increment your retaliationlevel!
											(switch
												(and
													;so that your sov doesn't retaliate against itself!	
													(not (eq (objGetSovereign aDestroyer) &yoursovereign;))
													;add more sovereigns that your sov is friendly with
													(not (eq (objGetSovereign aDestroyer) &SovereignThatIsFriendlyWithYourSovereign;))
													)
													(block Nil
														(setq Retaliationshiptype &;)
														;retaliationshiptype is the type of ship you want to attack the destroyer!
														(setq cnt &;)
														;cnt is the amount of ships you want to appear!
														
														;OPTIONAL:
														(setq metacnt [number])
														;[setq metacnt if you want teams of fleets working together [the two fleets will work together in attacking the ship, but independently (I don't know
														;how to make two groups work together yet])]
														(setq escorttype &;)
														;use escorttype only if you want a different ship to escort the retaliationshiptype! [AKA: retaliationshiptype= Aquila and escorttype=britannia]
														)
												)
											(setq escorttype Retaliationshiptype)
											)
						
								-->
								)
							)
					)
				;add data to say the station was destroyed once:
				(ObjSetData aObjDestroyed "DestroyedCount" 1)
				(PrintTo 'log "Destroyed Count!")
				(PrintTo 'log (ObjGetDataField aObjDestroyed 'name))
				(PrintTo 'log (ObjGetData aObjDestroyed "DestroyedCount"))
				)
				<!--
				;this is to tell the player X retaliated against Y!
				(if theLeader
					(block Nil
						(setq name (typGetDataField (objGetSovereign aDestroyer) 'name))
						(setq Retaliationname (typGetDataField (objGetSovereign aObjDestroyed) 'name))
						(if
							(or
								(eq (objGetSovereign aDestroyer) &svDestructiveOrder;)
								(eq (objGetSovereign aDestroyer) &svDestructiveChaos;)
								)
								(setq name (typGetDataField (objGetType aDestroyer) 'name))
								;otherwise:
								(setq name (typGetDataField (objGetSovereign aDestroyer) 'name))
							)
						(if
							(or
								(eq (objGetSovereign aObjDestroyed) &svDestructiveOrder;)
								(eq (objGetSovereign aObjDestroyed) &svDestructiveChaos;)
								)
								(setq Retaliationname (typGetDataField (staGetType aObjDestroyed) 'name))
								;otherwise:
								(setq Retaliationname (typGetDataField (objGetSovereign aObjDestroyed) 'name))
							)
						(plyMessage gPlayer "The "Retaliationname" retaliate against the "name"!")	
						)
					)
				)-->
        </OnObjDestroyed>
		<storage>
			(block Nil
				;there are two crucial functions for this:
				)
				
		</storage>
		<RespawnStation>
			;USE (objMoveTo spaceObject vector) !
			;create the station far away, then move it w/o its guards
			
			(block (prevStation theScarab Freightertype Escorttype pos sov cnt ship newStation GuardLocation location test sovTesting virtNewStation)
				;set sovTesting
				(setq sovTesting (objGetSovereign aObjDestroyed))
				;define stationcriteria location [in this case, it is the station]
				(setq prevStation aObjDestroyed)
				;define new station's location as a few ls from the old one:
				;(setq newStation (sysCreateMarker "rally" (objGetpos aObjDestroyed) &svCommonwealth;))
				(setq newStation (sysCreateMarker "rally" (sysVectorPolarOffset (ObjGetPos aObjDestroyed) (random 0 359) (random 1 5)) &svCommonwealth;))
				(setq GuardLocation (sysCreateMarker "rally" (sysVectorPolarOffset (ObjGetPos aObjDestroyed) (random 0 359) (random 5 15)) &svCommonwealth;))
				;define old station location with a marker
				;(setq oldStationLocation (sysCreateMarker "rally" (sysVectorPolarOffset (ObjGetPos aObjDestroyed) (random 0 359) (random 10 20)) &svCommonwealth;))
				;have a small offset in case stations don't respawn normally
				;(setq oldStationLocation (sysCreateMarker "rally" (sysVectorPolarOffset (ObjGetPos aObjDestroyed) (random 0 359) (random 1 5)) &svCommonwealth;))
				(setq oldStationLocation (sysCreateMarker "Artemis" (ObjGetPos aObjDestroyed) &svCommonwealth;))
				
				
				
				;do a switch to make an approriate freighter
				
					;illegal miners--			-svSettlers
							;make one
						
					
						
						;Black Market				-svBlackMarket-- they have their own
							;the big red one!
					(switch
						;centauri warlords
						(eq &svCentauriWarlords; sovTesting)
							(block Nil
								(setq Freightertype &scCentauriBaseShip;)
								(setq Escorttype &scCentauriHeavyRaider;)
								(setq cnt 5)
								)
						;charon pirates
						(eq &svPirates; sovTesting)
							(block Nil
								(setq Freightertype &scDrake;)
								(setq Escorttype &scViking-II;)
								(setq cnt 5)
								)
						;Marauders
						(eq &svMarauders; sovTesting)
							(block Nil
								(setq Freightertype &scTripoli;)
								(setq Escorttype &scDrake;)
								(setq cnt 5)
								)
						;Don't know what to do with illegal miners yet
						;Urak
						(eq &svUrakWarlords; sovTesting)
							(block Nil
								(setq Freightertype &scUrakDestroyer;)
								(setq Escorttype &scUrakSentinel;)
								(setq cnt 5)
								)
						;Don't know about the BM either	
						;Sung
						(eq &svSung; sovTesting)
							(block Nil
								(setq Freightertype &scEarthSlaver;)
								(setq Escorttype &scWindSlaver;)
								(setq cnt 5)
								)
						;Dwarg Raiders				-svDwargRaiders
							; behemoth and master escorts
						(eq &svDwargRaiders; sovTesting)
							(block Nil
								(setq Freightertype &scDwargBehemoth;)
								(setq Escorttype &scDwargMaster;)
								(setq cnt 5)
								)
						;Huari Empire				-svHuariEmpire
							;hurin
						(eq &svHuariEmpire; sovTesting)
							(block Nil
								(setq Freightertype &scHurinDestroyer;)
								(setq Escorttype &scHurinDestroyer;)
								(setq cnt 5)
								)
						
						;Bennin Xenophobes			-N/A
							;just gate in another worldship :P
						;Gaian Terraformers			-svGaianTerraformers
							;I have no clue
						;CW							-svcommonwealth
							;beefed up scarab
						(eq &svCommonwealth; sovTesting)
							(block Nil
								(setq Freightertype &scScarabRespawnFreighter;)
								(setq Escorttype &scCenturion;)
								(setq cnt 5)
								)
						(eq &svCorporate; sovTesting)
							(block Nil
								(setq Freightertype &scCorporateCruiser;)
								(setq Escorttype &scCenturion;)
								(setq cnt 5)
								)
							
							;CW rogue fleet			-svRogueFleet
								;beefed up scarab
								;OR
								;Polar--- make it random. As a rogue sov, they should be using whatever they have
								;but the Aurochs is EPIC!
						(eq &svRogueFleet; sovTesting)
							(block Nil
								(setq Freightertype &scAurochs;)
								(setq Escorttype &scCenturionX;)
								(setq cnt 5)
								)
						;Ares						-svAres
							;Polar
						(eq &svAres; sovTesting)
							(block Nil
								(setq Freightertype &scPolar2;)
								(setq Escorttype &scTundra;)
								(setq cnt 5)
								)
						;Ranx						-svRanxEmpire
							;Ranx DN
						(eq &svRanxEmpire; sovTesting)
							(block Nil
								(setq Freightertype &scRanxDreadnought;)
								(setq Escorttype &scRanxGunship;)
								(setq cnt 5)
								)
						;Ringers					-svRingers
						(eq &svRingers; sovTesting)
							(block Nil
								(setq Freightertype &scCorporateExplorer;)
								(setq Escorttype &scBritannia;)
								(setq cnt 5)
								)
						;add your faction here!
						<!--
						(eq (&YourSovereignUNIDHere; sovTesting))
							(block Nil
								(setq Freightertype &;)
								;freighter is the ship that is supposed to "carry" the station
								(setq Escorttype &;)
								;esctortype are the ships that are supposed to escort the freighter
								(setq cnt [number])
								;cnt is how many escorts there are
								)
						-->
						)
				; (sysVectorPolarOffset gSource (random 0 360) (random 800 1200))
				;  
				; test check
				;(setq pos (sysFindObject nil "GN") )
				;filter out Huaramarca
				(setq pos 
					(random 
						(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
						)
					)
				(if 
					pos
					;true=don't do anything
					Nil
					;false= choose random gate, record it in logs
					(block Nil
						(setq pos (random (sysFindObject nil "G")))
						(PrintTo 'log "Pos didn't work!")
						)
					)
				(setq sov (objGetSovereign aObjDestroyed))
			
				(if 
					(or
						(eq (objGetType aObjDestroyed) &stArcoVaughnHabitat; )
						(eq (objGetType aObjDestroyed) &stMakayevFactory; )
						(eq (objGetType aObjDestroyed) &stRasiermesserFactory; )
						(eq (objGetType aObjDestroyed) &stHereticStation; )
						(eq (objGetType aObjDestroyed) &stCommonwealthResearchHeretic; )
						(eq (objGetType aObjDestroyed) &stRingersResearchHeretic; )
						(eq (objGetType aObjDestroyed) &stSistersResearchHeretic; )
						(eq (objGetType aObjDestroyed) &stTVX1Outpost; )
						(eq (objGetType aObjDestroyed) &stAresResearchHeretic; )
						(eq (objGetType aObjDestroyed) &stMaryamsArchive; )
						(eq (objGetType aObjDestroyed) &stMRADSensor; )
						(eq (objGetType aObjDestroyed) &stLogBuoy; )
						(eq (objGetType aObjDestroyed) &stHereticControlCenter; )
						(eq (objGetType aObjDestroyed) &stStKatsArcology; )
						;turrets respawn in the wrong position
						(eq (objGetType aObjDestroyed) &stCommonwealthTurret;)
						(eq (objGetType aObjDestroyed) &stSungDefenseSat1;)
						<!--
						;(not (eq (objGetType aObjDestroyed) &stSungDefenseSat1;))
						-->
						(eq (objGetType aObjDestroyed) &stSungNWWall;)
						(eq (objGetType aObjDestroyed) &stSungNEWall;)
						(eq (objGetType aObjDestroyed) &stSungSEWall;)
						(eq (objGetType aObjDestroyed) &stSungSWWall;)
						)
						Nil
						(if 
							;and the station isn't the wreck of an already destroyed station
							(and
								(not (eq 100 (staGetStructuralHP aObjDestroyed)))
								(ObjIsAbandoned aObjDestroyed)
								Freightertype
								)
							;if freightertype is defined lets me prevent calling this event for factions that don't have a sov or don't have one defined, like the Xenophobes.
							(block Nil
								;gate in [beefed up!] Scarab w/ Britannia escort
								(setq theScarab (sysCreateShip Freightertype pos sov))
								(RPCCreateSovereignAtkFleet (ObjGetSovereign aObjDestroyed) 5 theScarab 'guard)
									<!--
									;add an event handler to spawn the station when the freighter gets close
									(objSetEventHandler theScarab &evRespawnerEventHandler;)
									(sysAddObjRecurringTimerEvent 30 theScarab "Reconstruction")
									
									;set the data the freighter needs for respawning the station
										;where it was-- "oldstationlocation"
										(objSetData theScarab "oldstationlocation" oldStationLocation)
										;what station is it-- "oldstationUNID"
										(objSetData theScarab "oldstationUNID" (ObjGetType aObjDestroyed))
										;the sovereign of the station-- "oldstationSov"
										(objSetData theScarab "oldstationSov" (objGetSov aObjDestroyed))
										;store data that tells the freighter where the newStation is!
										(setq test (objSetData theScarab "newstationlocation" (objGetPos newStation)))
										;the old station itself:
										(objSetData theScarab "TheRealOldeStation" (objGetID aObjDestroyed))
									-->
									;create virtual station at new point
									(setq virtNewStation (sysCreateStation &stVirtualRespawnStation; (ObjGetPos oldStationLocation)))
									;tell the virtual station what the old station was
									(ObjSetData virtNewStation "oldstationUNID" (ObjGetType aObjDestroyed))
									;location
									(objSetData virtNewStation "newstationlocation" (objGetPos newStation))
									;the old stations wreck:
									(objSetData virtNewStation "TheRealOldeStation" (objGetID aObjDestroyed))
									;the freighter 
									(objSetData virtNewStation "IncomingFreighter" (objGetID theScarab))
									;and the sov
									(objSetData virtNewStation "oldstationSov" (objGetSovereign aObjDestroyed))
									;register the station and the freighter:
									(objRegisterForEvents virtNewStation theScarab)
									;fire the recreate event in X ticks
									(sysAddObjRecurringTimerEvent 90 virtNewStation "Respawn")
									;(sysAddObjTimerEvent (random 5000 10000) virtNewStation "Respawn")
									;(sysAddObjTimerEvent 200 virtNewStation "Respawn")
									
									(shpOrder theScarab 'wait 10)
						
									(if cnt
										(for i 1 cnt
											(block (ship)
												(setq ship (sysCreateShip Escorttype pos sov))
												(shpOrder ship 'escort Freightertype)
												(shpOrder ship 'gate)
												)
											)
										)
									(shpOrder theScarab "goto" GuardLocation)
									(shpOrder theScarab 'wait 10)
									;working on it
									(shpOrder theScarab 'hold)
									(shpOrder theScarab 'gate)
									
									
								)
							)
					)
					;objSetData "location" theScarab so it knows where to place the new station!
					;first create a basic station for the sov!
				)
		</RespawnStation>
		<Attack>
			(block (Atkstation sov targetstation created name AtkStationName targname)
				;find a random station within the list
				(setq Atkstation (random (filter (sysFindObject Nil "AT") station 
					(and
						(RPC-within (ObjGetSovereign station) (ObjGetData gSource "Sovlist"))
						(find (ObjGetData gSource "Sovlist") (ObjGetSovereign station))
						;no wrecks because then you get attacks on dead stations
						(not (ObjIsAbandoned station))
						(not (eq (objGetType station) &stRespawnstation;))
						(not (eq (objGetType station) &stCommonwealthTurret;))
						(not (eq (objGetType station) &stSungDefenseSat1;))
						(not (eq (objGetType station) &stSungNWWall;))
						(not (eq (objGetType station) &stSungNEWall;))
						(not (eq (objGetType station) &stSungSEWall;))
						(not (eq (objGetType station) &stSungSWWall;))
						
						(not (eq station &stRespawnstation;))
						(not (eq station &stCommonwealthTurret;))
						(not (eq station &stSungDefenseSat1;))
						(not (eq station &stSungNWWall;))
						(not (eq station &stSungNEWall;))
						(not (eq station &stSungSEWall;))
						(not (eq station &stSungSWWall;))
						))))
				
				;(PrintTo 'log (RPC-within (ObjGetSovereign Atkstation) (ObjGetData gSource "Sovlist")))
				(PrintTo 'log "START")
				(if
					(staIsReconned Atkstation)
						(block Nil
							(PrintTo 'log (ObjGetName Atkstation))
							(setq AtkStationName(ObjGetName Atkstation))
							)
						;(ObjGetName Atkstation)
						(block Nil
							(PrintTo 'log "Atkstation Not Reconned")
							(staSetShowMapLabel Atkstation true)
							(PrintTo 'log (ObjGetName Atkstation))
							(setq AtkStationName(ObjGetName Atkstation))
							;(staSetShowMapLabel Atkstation Nil)
							)
					)
				(setq targetstation  (Random (SysFindObject AtkStation "TAE")))
					(if 
						targetstation
						(block Nil
							(if
								(staIsReconned targetstation)
									(block Nil
										(PrintTo 'log (ObjGetName targetstation))
										;(ObjGetName targetstation)
										(setq targname(ObjGetName targetstation))
										)
									(block Nil
										(PrintTo 'log "targetstation Not Reconned")
										(staSetShowMapLabel targetstation true)
										(PrintTo 'log (setq targname (ObjGetName targetstation)))
										;(setq targname (ObjGetName targetstation))
										;(staSetShowMapLabel targetstation Nil)
										)
								)
							)
						)
				(if
					(and
						AtkStation
						targetstation
						)
						(block Nil
							(RPCCreateSovereignAtkFleet (ObjGetSovereign AtkStation) (random 0 15) targetstation 'attack AtkStationName targname)
							(PrintTo 'log "END")
							)
					)
				)
			
				<!--
			(block (Atkstation sov targetstation created)
				;find a random station within the list
				(setq Atkstation (random (filter (sysFindObject Nil "T") station 
					(and
						;(eq (RPC-within (ObjGetSovereign station) (ObjGetData gSource "Sovlist")) true)
						(find (ObjGetData gSource "Sovlist") (ObjGetSovereign station))
						;no wrecks because then you get attacks on dead stations
						(not (ObjIsAbandoned station))
						(not (eq station &stRespawnstation;))
						))))
					
				;(setq Atkstation (random (filter (sysFindObject Nil "T") station 
					;(eq (RPC-within (ObjGetSovereign station) (list &svCommonwealth;)) true))))
					;filter random to not have any dead stations as targs
					;(filter list variable function)
					;(Random (filter (SysFindObject AtkStation "TAE") station2 (not (ObjIsAbandoned station2))))
				(setq targetstation  (Random (SysFindObject AtkStation "TAE")))
					(if 
						targetstation
						(RPCCreateSovereignAtkFleet (ObjGetSovereign AtkStation) (random 0 15) targetstation 'attack)
						)
				)
				
				
			(block (Atkstation sov targetstation)
				
				(block (Var)
				(Setq Var (eq (RPC-within (ObjGetSovereign (ObjGetTarget gPlayership)) (ObjGetData gSource "Sovlist")) true))
				(plymessage gPlayer ""Var"")
				)
				;choose random station that in the list of sovs here
					;choose random station's enemy station
					;make an attack force
					
				
				;there exists an attack station
				(setq Atkstation (random (filter (sysFindObject Nil "T") station 
						(eq (RPC-within (ObjGetSovereign station) (ObjGetData gSource "Sovlist")) true))))
					;create an attack fleet to attack an enemy station
					;get the enemy station
					(setq targetstation(random (sysFindObject AtkStation "TE")))
					;(RPCCreateSovereignAtkFleet (ObjGetSovereign AtkStation) targetstation (random 1 15) 'attack)
					(RPCCreateSovereignAtkFleet &svCommonwealth; targetstation (random 1 15) 'attack)
					(Plymessage gPlayer "attack test")
				)
			(block (atksov target)
				;enum over stations
				(enum (sysFindObject Nil "T") station
					(block (sov)
						(setq Sov (ObjGetSovereign station))
						(if ;if it doesn't match with the current sov,
							(not(match (ObjGetData gSource "Sovereigns_in_System") Sovsregistered 
								(eq sovsregistered sov)))
								;lnkAppend it
								(block Nil
									(ObjGetData gSource "Sovereigns_in_System")
									(lnkAppend sov)
									(ObjSetData gSource "Sovereigns_in_System")
									)
							)
						)
					)
					;choose one station that has a sov already described here
					(setq Atksov(random (ObjGetData gSource "Sovereigns_in_System")))
					(setq target(random (SysFindObject )))
						;choose an enemy sov station and attack it
				)-->
		</Attack>
			<AttackAres>
				;have a variable called reinforcements!
				;reinforcements= 10 total, refills 3 after 2 min
				(block (target)
					;; XXX remember to declare block local variables

					;; Look for Ares stations in the system
					;; NOTE you don't need to set stationlist here... just pick a random
					(setq target (random (sysFindObject gSource "AT:aresMajor; ")))

					;; only do anything if we have a target--- and if the syslevel is high enough
					(if 
						(and
							target
							(geq (sysGetLevel) 5)
							)
						(block (level type cnt pos sov theLeader name)
							;; XXX again, declare block locals!

							(typIncData &stRetaliationController; (cat &svCommonwealth; "Retaliate") 3)

							(setq level (TypGetData &stRetaliationController; (cat &svCommonwealth; "Retaliate")))

							;; run the switch
							;; set both the type and the count at the same time
							(switch
								(leq level 5)
									(block nil
										(setq type &scBritannia;)
										(setq cnt 5)
										)
								(and (geq level 6) (leq level 9))
									(block nil
										(setq type &scAquilaCruiser;)
										(setq cnt 5)
										)
								(and (geq level 10) (leq level 17))
									(block nil
										(setq type &scDSAquilaCruiser;)
										(setq cnt 1)
										)
								;; else
									(block nil
										(setq type &scDSAquilaCruiser;)
										(setq cnt (divide level 5))
										)
								)

							) ;;end the switch

							;; decide where the reinforcements are coming from
							;; here we use the nearest gate
							;(setq pos (sysFindObject nil "GN"))
							;not anymore!
							;filter out Huaramarca
							(setq pos 
								(random 
									(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
									)
								)
							(if 
								pos
								;true=don't do anything
								Nil
								;false= choose random gate, record it in logs
								(block Nil
									(setq pos (random (sysFindObject nil "G")))
									(PrintTo 'log "Pos didn't work!")
									)
								)
							
							;; determine what soverign the ships will have,
							(setq sov &svCommonwealth;)

							;; create the theLeader
							(setq theLeader (sysCreateShip type pos sov))
							;here is the inserted code to get fleets
								;give retaliation ship this event
								(objSetEventHandler theLeader &evRetaliationEventHandler;)
								(sysAddObjRecurringTimerEvent 450 theLeader "SquadronTactics")
									;set the teamLeader status
									(objSetData theLeader "teamLeader" true)
									;get ShipOrders from previous leader
										;ObjSetData- what?
											;order
											(objsetdata theLeader "shipOrder" 'attack)
											;target
											(objSetData theLeader "orderTarget" (setq test (objGetID target)))
											
								;order the leader to wait so the squad forms up-- taken from evStdConvoyEncounterBehavior
								(shpOrder theLeader 'wait 10)

							;; order the theLeader to attack the destroyer then gate out
							(shpOrder theLeader 'attack target)
							(shpOrder theLeader 'gate)

							;; create the escorts
							(for i 0 cnt (block (shp)
								(setq shp (sysCreateShip type pos sov))
								(shpOrder shp 'escort theLeader)
								;here is the inserted code to get fleets
								(objSetEventHandler shp &evRetaliationEventHandler;)
								(shpOrder shp 'gate)
								))

							;; message the player
							;; XXX the difference here, is that this code is only run
							;;     if we actually have a target!
							(setq name (typGetDataField (objGetSovereign target) 'name))
							;Plymessage check!
							;(plyMessage gPlayer "The Commonwealth attack the " name "!")
						)
					)
				)
			</AttackAres>
		
			<!--Thanks Atarlost!-->
			<AttackCW>
				(block (target)
					;; XXX remember to declare block local variables

					;; Look for CW stations in the system
					;; NOTE you don't need to set stationlist here... just pick a random
					<!--changed "st +commonwealth" to "T + commonwealth"-->
					(setq target (random (sysFindObject gSource "T +commonwealth; ")))

					;; only do anything if we have a target--- and if the syslevel is high enough
					(if 
						(and
							target
							(geq (sysGetLevel) 8)
							)
						(block (level type cnt pos sov theLeader name)
							;; XXX again, declare block locals!

							(typIncData &stRetaliationController; (cat &svAres; "Retaliate") 3)

							;; get the current relatiation level
							(setq level (TypGetData &stRetaliationController; (cat &svAres; "Retaliate")))

							;; run the switch
							;; set both the type and the count at the same time
							(switch
							
								(leq level 9)
									(block nil
										(setq type &scTundra;)
										(setq cnt 6)
										)
								(and (geq level 10) (leq level 13))
									(block nil
										(setq type &scChasm;)
										(setq cnt 6)
										)
								(and (geq level 14) (leq level 20))
									(block nil
										(setq type &scTundra;)
										(setq cnt 9)
										)
								(and (geq level 21) (leq level 25))
									(block nil
										(setq type &scDeimos;)
										(setq cnt 3)
										)
								;; else
								(block nil
									(setq type &scPhobos;)
									(setq cnt 2)
									)

								) ;;end the switch

							;; decide where the reinforcements are coming from
							;; here we use the nearest gate
							;(setq pos (sysFindObject nil "GN"))
							;not anymore!
							;filter out Huaramarca
							(setq pos 
								(random 
									(filter (sysFindObject nil "G") gate (not (eq (ObjGetType gate) &stMajellenStargate;)))
									)
								)
							(if 
								pos
								;true=don't do anything
								Nil
								;false= choose random gate, record it in logs
								(block Nil
									(setq pos (random (sysFindObject nil "G")))
									(PrintTo 'log "Pos didn't work!")
									)
								)
							
							;; determine what soverign the ships will have,
							(setq sov &svAres;)

							;; create the theLeader
							(setq theLeader (sysCreateShip type pos sov))

							;here is the inserted code to get fleets
								;give retaliation ship this event
								(objSetEventHandler theLeader &evRetaliationEventHandler;)
								(sysAddObjRecurringTimerEvent 450 theLeader "SquadronTactics")
									;set the teamLeader status
									(objSetData theLeader "teamLeader" true)
									;get ShipOrders from previous leader
										;ObjSetData- what?
											;order
											(objsetdata theLeader "shipOrder" 'attack)
											;target
											(objSetData theLeader "orderTarget" (setq test (objGetID target)))
												
									;order the leader to wait so the squad forms up-- taken from evStdConvoyEncounterBehavior
									(shpOrder theLeader 'wait 10)
					
							;; order the theLeader to attack the destroyer then gate out
							(shpOrder theLeader 'attack target)
							(shpOrder theLeader 'gate)

							;; create the escorts
							(for i 1 cnt (block (shp)
								(setq shp (sysCreateShip type pos sov))
								(shpOrder shp 'escort theLeader)
								;here is the inserted code to get fleets
									(objSetEventHandler shp &evRetaliationEventHandler;)
								(shpOrder shp 'gate)
								))

							;; message the player
							;; XXX the difference here, is that this code is only run
							;;     if we actually have a target!
							(setq name (typGetDataField (objGetSovereign target) 'name))
							;Plymessage check!
							;(plyMessage gPlayer "The Ares attack the " name "!")
						)
					)
				)
			</AttackCW>

			<GetSlaves>
				(block 
					;get target [station or freighter]
					;attack guard ships
					;dock with station
					;
					)
			</GetSlaves>
	
    </Events>
</StationType>

<StationType UNID="&stPiracySupportController;"
    name=               "Baddies Hideout for DySys"
    scale=              "world"
    backgroundObject=   "true"
    sovereign=          "&svIndependent;"
    unique=             "inSystem"	
    >
    <ImageVariants>
        <Image          imageID="&rsWorlds2;" imageX="0" imageY="0" imageWidth="1" imageHeight="1" />
    </ImageVariants>
    <Events>
        <OnCreate>
		(block Nil
		 ;freighters should /always/ have loot! :D
			(sysAddObjRecurringTimerEvent 90 gSource "PiracyEncouragement")
			)
		</OnCreate>
		 <PiracyEncouragement>
            (block (OriginalList)
				;(plymessage gPlayer "PiracyEncouragement")
				;(PrintTo 'log "PiracyEncouragement")
                ;; loop over every active freighter in the system
				(setq OriginalList (sysFindObject nil "s +freighter; J:&svCommonwealth;"))
				(enum (sysFindObject nil "s +freighter; J:&svCorporate;") element (block Nil
					(setq OriginalList (lnkAppend OriginalList element))
					))
				<!--
				(enum OriginalList thingy (block Nil
					(PrintTo 'log "namecheck!")
					(PrintTo 'log (TypGetDataField (ObjGetType thingy) 'name))
					))
				-->
                (enum OriginalList freighter 
                    (if (not (objGetData freighter "registered"))
                        (block (chance chance2 TableList)
							;(PrintTo 'log "======")
							;(PrintTo 'log "freighter name!")
							;(PrintTo 'log (TypGetDataField (ObjGetType freighter) 'name))
                            ;; if the freighter isn't registered yet, do so now
                            (objRegisterForEvents gSource freighter)
                            ;; mark that we've registered this freighter
                            (objSetData freighter "Registered" True)
							;; add cool stuff to it
							;(objAddItem freighter (itmCreate &itKorolovShippingContainer; (random 1 5)))
							(setq chance (random 1 100))
							;(objGetCargoSpaceLeft spaceObject)							
							(setq chance2 (multiply (sysGetLevel) (random 1 20)))
							;(setq chance2 (random (multiply (sysGetLevel) (random 1 20)) (objGetCargoSpaceLeft freighter)))
							;trConsumables1
							;trConsumables2
							;trConsumables3
							;trConsumables4
							;trConsumables5
							;trConsumables6
							;trConsumables7
							;trConsumables8
							;trConsumables9
							;trConsumables10
							;trMajorItem1
							;trMajorItem2
							;trMajorItem3
							;trMajorItem4
							;trMajorItem5
							;trMajorItem6
							;trMajorItem7
							;trMajorItem8
							;trMajorItem9
							;trMajorItem10
							;trMinorItem1
							;trMinorItem2
							;trMinorItem3
							;trMinorItem4
							;trMinorItem5
							;trMinorItem6
							;trMinorItem7
							;trMinorItem8
							;trMinorItem9
							;trMinorItem10
							;trStationSupplies
							<!-- LEVEL I-II -->
							;trUsefulItems1
							;trMiscItems1
							<!-- LEVEL III-IV -->
							;trMiscItems2
							;trUsefulItems2
							<!-- LEVEL V-VI -->
							;trMiscItems3
							;trHaloGems
							<!-- Cargo Container Items -->
							;trCargoContainer
							
							<!-- Illegal items -->
							;trIllegalItems1
							;trIllegalItems2
							;trIllegalItems3
							<!-- Military items -->
							;the level is equal to the last number
							;trMilitaryItem4
							;trMilitaryItem5
							;trMilitaryItem6
							;trMilitaryItem7
							;trMilitaryItem8
							;trMilitaryItem9
							;trMilitaryItem10
							<!-- Miscellaneous -->
							;trMedicalItem
							;(objAddRandomItems obj table count)
							(switch
								(ls (SysGetLevel) 1)
									(setq TableList (list &trConsumables1; &trMajorItem1; &trMinorItem1; &trStationSupplies; &trUsefulItems1; &trMiscItems1; &trCargoContainer; &trIllegalItems1; &trMedicalItem;))
								(ls (SysGetLevel) 2)
									(setq TableList (list &trConsumables2; &trMajorItem2; &trMinorItem2; &trStationSupplies; &trUsefulItems1; &trMiscItems1; &trCargoContainer; &trIllegalItems2; &trMedicalItem;))
								(ls (SysGetLevel) 3)
									(setq TableList (list &trConsumables3; &trMajorItem3; &trMinorItem3; &trStationSupplies; &trMiscItems2; &trUsefulItems2; &trCargoContainer; &trIllegalItems3; &trMedicalItem;))
								(ls (SysGetLevel) 4)
									(setq TableList (list &trConsumables4; &trMajorItem4; &trMinorItem4; &trStationSupplies; &trMiscItems2; &trUsefulItems2; &trCargoContainer; &trMilitaryItem4; &trMedicalItem;))
								(ls (SysGetLevel) 5)
									(setq TableList (list &trConsumables5; &trMajorItem5; &trMinorItem5; &trStationSupplies; &trMiscItems3; &trHaloGems; &trCargoContainer; &trMilitaryItem5; &trMedicalItem;))
								(ls (SysGetLevel) 6)
									(setq TableList (list &trConsumables6; &trMajorItem6; &trMinorItem6; &trStationSupplies; &trMiscItems3; &trHaloGems; &trCargoContainer; &trMilitaryItem6; &trMedicalItem;))
								(ls (SysGetLevel) 7)
									(setq TableList (list &trConsumables7; &trMajorItem7; &trMinorItem7; &trStationSupplies; &trCargoContainer; &trMilitaryItem7; &trMedicalItem;))
								(ls (SysGetLevel) 8)
									(setq TableList (list &trConsumables8; &trMajorItem8; &trMinorItem8; &trStationSupplies; &trCargoContainer; &trMilitaryItem8; &trMedicalItem;))
								(ls (SysGetLevel) 9)
									(setq TableList (list &trConsumables9; &trMajorItem9; &trMinorItem9; &trStationSupplies; &trCargoContainer; &trMilitaryItem9; &trMedicalItem;))
								(ls (SysGetLevel) 10)
									(setq TableList (list &trConsumables10; &trMajorItem10; &trMinorItem10; &trStationSupplies; &trCargoContainer; &trMilitaryItem10; &trMedicalItem;))
								(ls (SysGetLevel) 11)
									(setq TableList (list &trConsumables10; &trMajorItem10; &trMinorItem10; &trStationSupplies; &trCargoContainer; &trMilitaryItem10; &trMedicalItem;))
								)
							(objAddRandomItems freighter (random TableList) (random 3 7))
							<!--
							itUraniumOre
							itHeliumRegolith
							itPlasteelOre
							itPalladiumOre
							itCobaltThoriumOre
							itGoldOre
							itDuralloyOre
							itPteracniumOre
							itOrthoSteelOre
							itIthaliumOre
							-->
							(switch
								(leq chance 10)
									(block Nil
										(objAddItem freighter (itmCreate &itUraniumOre; chance2))
										)
								(leq chance 20)
									(block Nil
										(objAddItem freighter (itmCreate &itHeliumRegolith; chance2))
										)
								(leq chance 30)
									(block Nil
										(objAddItem freighter (itmCreate &itPlasteelOre; chance2))
										)
								(leq chance 40)
									(block Nil
										(objAddItem freighter (itmCreate &itPalladiumOre; chance2))
										)
								(leq chance 50)
									(block Nil
										(objAddItem freighter (itmCreate &itCobaltThoriumOre; chance2))
										)
								(leq chance 60)
									(block Nil
										(objAddItem freighter (itmCreate &itGoldOre; chance2))
										)
								(leq chance 70)
									(block Nil
										(objAddItem freighter (itmCreate &itUraniumOre; chance2))
										)
								(leq chance 80)
									(block Nil
										(objAddItem freighter (itmCreate &itDuralloyOre; chance2))
										)
								(leq chance 89)
									(block Nil
										(objAddItem freighter (itmCreate &itOrthoSteelOre; chance2))
										)
								(geq chance 90)
									(block Nil
										(objAddItem freighter (itmCreate &itIthaliumOre; chance2))
										)
								
								)
							)
						)
					)
				)
        </PiracyEncouragement>
		<OnObjDestroyed>
			(block (destroyer)
				(setq destroyer "aDestroyer")
				;(plymessage gPlayer "the destroyer is "aDestroyer".")
				(if
					(eq aDestroyer gPlayership)
						(plymessage gPlayer "Pirate!")
					)
				(if 
					(and 
						aDestroyer
						(or 
							(not (eq (ObjGetSovereign aDestroyer) &svCommonwealthFleet;))
							(not (eq (ObjGetSovereign aDestroyer) &svCommonwealth;))
							(not (eq (ObjGetSovereign aDestroyer) &svCorporate;))
							(not (eq (ObjGetSovereign aDestroyer) &svFerianMiners;))
							(not (eq (ObjGetSovereign aDestroyer) &svRingers;))
							)
						 )
						(block Nil
							;(SovTest Retaliatelevel target shipOrder name Retaliationname)
							(RPCCreateSovereignAtkFleet &svIndependent; (random 0 20) aDestroyer 'attack 'Korolov (ObjGetName aDestroyer))
							)
					)
				(if
					;there is a wreck
					aWreckObj
						(block Nil
							(RPCCreateSovereignAtkFleet &svIndependent; (random 0 20) aWreckObj 'loot)
							;send the recovery squad
							;have a recurring timer that checks if the wreck is ok.
							;if there is aDestroyer, destroy it
							;dock with the freighter and loot it.
							)
					)
				)
		</OnObjDestroyed>
    </Events>
</Stationtype>

	<!-- Mammoth 25MW deflector 

	<ItemType UNID="&itMammoth25Deflector;"
			name=				"Mammoth 25MW deflector"
			level=				"6"
			value=				"16000"
			mass=				"3000"
			frequency=			"uncommon"
			attributes=			"MajorItem; Bushido"

			description=		"Mammoth deflector shields can absorb immense amounts of damage, but their regeneration rate is lower than competitors."

			sortName=			"Mammoth deflector, 025"
			>

		<Image imageID="&rsItemsBushido1;" imageX="0" imageY="96" imageWidth="96" imageHeight="96"/>

		<Shields
				hitPoints=		"270"
				regen=			"20"
				depletionDelay=	"480"
				powerUse=		"250"
				/>
		<Invoke>
			(block (gate1)
				;(Plymessage gPlayer (cat "Arena Skill is "(typGetGlobalData &stBattleArena; "arenaSkill") "!" ))
				
				;(sysAddStargateTopology [nodeID] gateID destNodeID destGateID) -> True/Nil
				;(sysCreateStargate unid pos gateID [destNodeID destGateID]) -> obj
				;<Stargate from="Hunfeld:Claerbout2" to="Claerbout:Hunfeld1"/>
				;<Stargate from="Hunfeld:Bustelli3" to="Bustelli:Hunfeld4"/>
				;<Stargate from="Claerbout:Hunfeld2" to="Hunfeld:Claerbout1"/>
				;<Stargate from="St. Katharine's Star:Charon2" to="Charon:St. Katharine's Star1"/>
				;<Stargate from="Babbage:St. Katharine's Star4" to="St. Katharine's Star:Babbage3"/>
				
				
				;hunfeld to SK
													;gateID is the ID of the gate that goes *to* the target system that SysGetNode gets
																		;destGateID is the gate ID of the stargate *in* the system
				;(sysAddStargateTopology (SysGetNode) gateID destNodeID destGateID)
				;(sysCreateStargate &stStargate; (ObjGetPos gSource) gateID [destNodeID destGateID])
				
				;(sysAddStargateTopology (SysGetNode) 'Hunfeld2 "St. Katharine's Star" 'Charon2)
				;(sysCreateStargate &stStargate; (ObjGetPos gSource) 'Hunfeld2 "St. Katharine's Star" 'Charon2)
				;SK to hunfeld
				(sysAddStargateTopology (SysGetNode) "St. Katharine's Star4" 'Hunfeld 'Claerbout2)
				(sysCreateStargate &stStargate; (ObjGetPos gSource) "St. Katharine's Star4" 'Hunfeld 'Claerbout2)
				)
		</Invoke>
	</ItemType>
-->
</TranscendenceExtension>